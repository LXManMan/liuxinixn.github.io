<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="多去尝试你从未尝试的。">
<meta property="og:type" content="website">
<meta property="og:title" content="雪晟">
<meta property="og:url" content="liuxinixn.github.io/page/8/index.html">
<meta property="og:site_name" content="雪晟">
<meta property="og:description" content="多去尝试你从未尝试的。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="雪晟">
<meta name="twitter:description" content="多去尝试你从未尝试的。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="liuxinixn.github.io/page/8/"/>





  <title>雪晟</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">雪晟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">十年饮冰，难凉热血。我是雪晟。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/09/10/iOS-在使用全屏返回手势与UIScrollview的冲突问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/10/iOS-在使用全屏返回手势与UIScrollview的冲突问题/" itemprop="url">iOS -在使用全屏返回手势与UIScrollview的冲突问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-10T20:19:35+08:00">
                2016-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在使用<code>UINavigationController+FDFullscreenPopGesture</code>全屏手势的时候与UIScrollview发生冲突。在官方的demo里 是这么写的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer &#123;</div><div class="line">    if (self.contentOffset.x &lt;= 0) &#123;</div><div class="line">        if ([otherGestureRecognizer.delegate isKindOfClass:NSClassFromString(@&quot;_FDFullscreenPopGestureRecognizerDelegate&quot;)]) &#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>所以我们只需要新建一个UIScrollview分类，把这个方法放进去即可。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/07/09/iOS-内存检测Instruments之Leaks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/09/iOS-内存检测Instruments之Leaks/" itemprop="url">iOS -内存检测Instruments之Leaks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-09T20:19:35+08:00">
                2016-07-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>动态检测内存工具Leaks，可以和静态分析工具Analyze配合使用。<br><code>cmd + I</code>进入 Leaks 主界面，</p>
<p>#######第一步：点击左上角的红色录制按钮，会重启模拟器或者手机，点击暂停可以进行测试。<br><img src="http://upload-images.jianshu.io/upload_images/1694376-92dcf784dd366981.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-6a8f6ff5ea01903d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p>
<p>#######第二步：然后 点击应用，进入界面，测试，如果出现红X，点击暂停按钮暂停，开始查找内存泄漏的地方。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-9206d4d535f67f4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p>
<p>#######第三步：点击Leak Checks按钮，选择要定位的区域，红色❌号标识前后。选择CallTree，会定位到具体的方法。右侧面板配置如图：<br><img src="http://upload-images.jianshu.io/upload_images/1694376-01354a2229ee2ec5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p>
<p>#######第四步：最后双击需要检测的地方跳转到Xcode，定位代码。</p>
<blockquote>
<p>最后简单使用Time Profiler检测耗时的代码.面板配置同Leaks。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-8f794c0c019ff50f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p>
<p>之前用Time Profiler 检测过UIImage 加载两种方式的区别。<a href="http://www.jianshu.com/p/a700dcf27b83" target="_blank" rel="noopener">UIImageview加载动画做内存与耗时</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/07/05/ios--UITableView三级展开/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/05/ios--UITableView三级展开/" itemprop="url">iOS --UITableView三级展开</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-05T20:19:35+08:00">
                2016-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有个多级展开的需求，但不是那种三层嵌套，是这个效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-75ffc45cfef9b56f.gif?imageMogr2/auto-orient/strip" alt="多级展开.gif"><br>这样 我们只需要给Tableview的总的header 以及分区header 增加一个展开即可：</p>
<blockquote>
<p>总的header 不会复用，所以给header 一个展开属性</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef void (^LXExpandBlock)(BOOL isExpand);</div><div class="line">@interface LXTableviewHeader : UIView</div><div class="line">@property(nonatomic, assign)BOOL isExpand;</div><div class="line">@property(nonatomic,copy)LXExpandBlock expandBlock;</div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>分区header 的复用把展开属性设置在对应的model里</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">@class LXSectionModel;</div><div class="line">typedef void (^LXHeaderViewExpandBlock)(BOOL isExpand);</div><div class="line">@interface LXHeadView : UITableViewHeaderFooterView</div><div class="line">@property(nonatomic,strong)LXSectionModel *model;</div><div class="line">@property(nonatomic,copy)LXHeaderViewExpandBlock enpandBlock;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface LXSectionModel : NSObject</div><div class="line">@property (nonatomic, copy) NSString *sectionTitle;</div><div class="line">// 是否是展开的</div><div class="line">@property (nonatomic, assign) BOOL isExpanded;</div><div class="line"></div><div class="line">@property (nonatomic, strong) NSMutableArray *cellModels;</div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>整体头部展开是这样的 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">LXTableviewHeader *header =[[LXTableviewHeader alloc]initWithFrame:CGRectMake(0, 0, self.view.frame.size.width, 40)];</div><div class="line">__weak ViewController *weakSelf = self;</div><div class="line">header.expandBlock = ^( BOOL isExpand)</div><div class="line">&#123;</div><div class="line">    [weakSelf.tableView reloadData];</div><div class="line">&#125;;</div><div class="line">self.tableView.tableHeaderView = header;</div><div class="line">self.headerView = header;</div></pre></td></tr></table></figure>
<blockquote>
<p>分区头部展开处理过程</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section</div><div class="line">&#123;</div><div class="line">    LXHeadView *view =[tableView dequeueReusableHeaderFooterViewWithIdentifier:kHeaderIdentifier];</div><div class="line">    LXSectionModel *sectionModel = self.sectionDataSources[section];</div><div class="line">    </div><div class="line">    view.model = sectionModel;</div><div class="line">    view.enpandBlock = ^(BOOL isExpanded)</div><div class="line">    &#123;</div><div class="line">        [tableView reloadSections:[NSIndexSet indexSetWithIndex:section] withRowAnimation:0];</div><div class="line">    &#125;;</div><div class="line">    return view;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>  返回分区与返回cell个数的处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView</div><div class="line">&#123;</div><div class="line">    return self.headerView.isExpand ?self.sectionDataSources.count:0;</div><div class="line">&#125;</div><div class="line">-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section</div><div class="line">&#123;</div><div class="line">      LXSectionModel *sectionModel = self.sectionDataSources[section];</div><div class="line">    return sectionModel.isExpanded ? sectionModel.cellModels.count:0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>#####所有的展开与收起  额外计算，只需要刷新整体或者刷新分区即可，改变分区个数与分区内对应cell 个数，不需要对cell 做insert 或者delete操作。</p>
<p>demo 地址：<a href="https://github.com/liuxinixn/Tableview-/tree/master" target="_blank" rel="noopener">UITableview三级展开</a><br>参考文章：<a href="http://www.jianshu.com/p/fc45624603f6" target="_blank" rel="noopener">UITableView分区展开与收起</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/06/03/Coregraphics切反向圆角/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/03/Coregraphics切反向圆角/" itemprop="url">CoreGraphices -切反向圆角</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-03T20:19:35+08:00">
                2016-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>效果图<br><img src="http://upload-images.jianshu.io/upload_images/1694376-efefdd1b6916140a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="E1819704-B84B-4741-BB28-4B87A1883EDF.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">    UIImageView *iamgeview =[[UIImageView alloc]initWithFrame:CGRectMake(20, 100, 200, 200)];</div><div class="line">    UIImage *image = [UIImage imageNamed:@&quot;gougou&quot;];</div><div class="line"></div><div class="line">//    iamgeview.image =</div><div class="line">    iamgeview.image = [self addClipWithImage:image];</div><div class="line"></div><div class="line">    [self.view addSubview:iamgeview];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">-(UIImage *)addClipWithImage:(UIImage *)image&#123;</div><div class="line">    </div><div class="line">    //1、开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">   </div><div class="line">    //2、设置裁剪区域</div><div class="line">    //    UIBezierPath * path = [UIBezierPath bezierPathWithOvalInRect:rect];</div><div class="line"> </div><div class="line">    </div><div class="line">    UIBezierPath * path = [UIBezierPath bezierPathWithRect:CGRectMake(0,0,image.size.width, image.size.height)];</div><div class="line">    </div><div class="line">    [path addArcWithCenter:CGPointMake(image.size.width, 0) radius:10 startAngle:- M_PI  endAngle:-M_2_PI clockwise:NO];</div><div class="line">    [path closePath];</div><div class="line">    [path addClip];</div><div class="line">    //3、绘制图片</div><div class="line">    [image drawAtPoint:CGPointZero];</div><div class="line">    //4、获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5、关闭上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //6、返回新图片</div><div class="line">    return newImage;</div><div class="line"></div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/06/03/ios--二维码生成（带图标）以及相册识别二维码跳转/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/03/ios--二维码生成（带图标）以及相册识别二维码跳转/" itemprop="url">iOS--二维码生成（带图标）以及相册识别二维码跳转</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-03T20:19:35+08:00">
                2016-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>关于二维码的生成，系统提供了API。</p>
</blockquote>
<p>######第一步根据内容生成CIImage<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//根据url 创建CIImage</div><div class="line">+(CIImage *)QRFromUrl:(NSString *)urlStr&#123;</div><div class="line">    // 1、创建滤镜对象</div><div class="line">    CIFilter *filter = [CIFilter filterWithName:@&quot;CIQRCodeGenerator&quot;];</div><div class="line">    </div><div class="line">    // 恢复滤镜的默认属性</div><div class="line">    [filter setDefaults];</div><div class="line">    </div><div class="line">    // 2、设置数据</div><div class="line">    NSString *info = urlStr;</div><div class="line">    // 将字符串转换成</div><div class="line">    NSData *infoData = [info dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">    </div><div class="line">    // 通过KVC设置滤镜inputMessage数据</div><div class="line">    [filter setValue:infoData forKeyPath:@&quot;inputMessage&quot;];</div><div class="line">    </div><div class="line">    // 3、获得滤镜输出的图像</div><div class="line">    CIImage *outputImage = [filter outputImage];</div><div class="line">    </div><div class="line">    return outputImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#####第二步根据CIImage生成UIImage</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/** 根据CIImage生成指定大小的UIImage */</div><div class="line">+ (UIImage *)createUIImageFormCIImage:(CIImage *)image withSize:(CGFloat)size &#123;</div><div class="line">    CGRect extent = CGRectIntegral(image.extent);</div><div class="line">    CGFloat scale = MIN(size/CGRectGetWidth(extent), size/CGRectGetHeight(extent));</div><div class="line">    </div><div class="line">    // 1.创建bitmap;</div><div class="line">    size_t width = CGRectGetWidth(extent) * scale;</div><div class="line">    size_t height = CGRectGetHeight(extent) * scale;</div><div class="line">    CGColorSpaceRef cs = CGColorSpaceCreateDeviceGray();</div><div class="line">    CGContextRef bitmapRef = CGBitmapContextCreate(nil, width, height, 8, 0, cs, (CGBitmapInfo)kCGImageAlphaNone);</div><div class="line">    CIContext *context = [CIContext contextWithOptions:nil];</div><div class="line">    CGImageRef bitmapImage = [context createCGImage:image fromRect:extent];</div><div class="line">    CGContextSetInterpolationQuality(bitmapRef, kCGInterpolationNone);</div><div class="line">    CGContextScaleCTM(bitmapRef, scale, scale);</div><div class="line">    CGContextDrawImage(bitmapRef, extent, bitmapImage);</div><div class="line">    </div><div class="line">    // 2.保存bitmap到图片</div><div class="line">    CGImageRef scaledImage = CGBitmapContextCreateImage(bitmapRef);</div><div class="line">    CGContextRelease(bitmapRef);</div><div class="line">    CGImageRelease(bitmapImage);</div><div class="line">    return [UIImage imageWithCGImage:scaledImage];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就可以生成简单的二维码。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-7b431ed9bb0ee43f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="普通的二维码.png"></p>
<blockquote>
<p>如果要在二维码中间加一个logo头像，我们需要给生成的二维码添加水印。</p>
<p>######假定已经生成了普通的二维码</p>
<p>######第一步:需要根据二维码图片设置生成水印图片<code>rect</code>：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//根据二维码图片设置生成水印图片rect 这里限制水印的图片为二维码的1/4</div><div class="line">    CGRect waterImageRect = [self getWaterImageRectFromOutputQRImage:orginQRImage];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+(CGRect)getWaterImageRectFromOutputQRImage:(UIImage *)orginQRImage&#123;</div><div class="line">    </div><div class="line">     CGSize linkSize = CGSizeMake(orginQRImage.size.width / 4, orginQRImage.size.height / 4); </div><div class="line">    </div><div class="line">    CGFloat linkX = (orginQRImage.size.width -linkSize.width)/2;</div><div class="line">    CGFloat linkY = (orginQRImage.size.height -linkSize.height)/2;</div><div class="line"></div><div class="line">    </div><div class="line">    return CGRectMake(linkX, linkY, linkSize.width, linkSize.height);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>######第二步：根据限制的rect重新生成logo图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UIImage *logoImage =[[UIImage imageNamed:logoName]scaleToSize:waterImageRect.size];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-(UIImage*)scaleToSize:(CGSize)size</div><div class="line">&#123;</div><div class="line">    size = CGSizeMake(size.width  , size.height );</div><div class="line">    // 创建一个bitmap的context</div><div class="line">    // 并把它设置成为当前正在使用的context</div><div class="line">    UIGraphicsBeginImageContext(size);</div><div class="line">    // 绘制改变大小的图片</div><div class="line">    [self drawInRect:CGRectMake(0, 0, size.width , size.height )];</div><div class="line">    // 从当前context中创建一个改变大小后的图片</div><div class="line">    UIImage* scaledImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    // 使当前的context出堆栈</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    // 返回新的改变大小后的图片</div><div class="line">    return scaledImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####第三步：为生成的二维码添加水印图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//添加水印图片</div><div class="line">   finalImage =[UIImage LX_WaterImageWithImage:orginQRImage waterImage:waterImage waterImageRect:waterImageRect];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//添加水印图片</div><div class="line">+ (UIImage *)LX_WaterImageWithImage:(UIImage *)image waterImage:(UIImage *)waterImage waterImageRect:(CGRect)rect&#123;</div><div class="line">    </div><div class="line">    //1.获取图片</div><div class="line">    </div><div class="line">    //2.开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    //3.绘制背景图片</div><div class="line">    [image drawInRect:CGRectMake(0, 0, image.size.width, image.size.height)];</div><div class="line">    //绘制水印图片到当前上下文</div><div class="line">    [waterImage drawInRect:rect];</div><div class="line">    </div><div class="line">    //4.从上下文中获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5.关闭图形上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //返回图片</div><div class="line">    return newImage;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后会生成如下的二维码<br><img src="http://upload-images.jianshu.io/upload_images/1694376-0d14832e33c8f20a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="logo二维码.png"></p>
<p>把方法封装在 分类里面,直接调用即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//普通的二维码</div><div class="line">+(UIImage *)LX_ImageOfQRFromURL:(NSString *)urlStr codeSize:(CGFloat)codeSize;</div><div class="line"></div><div class="line">//带logo 的二维码</div><div class="line">+(UIImage *)LX_ImageOfQRFromURL:(NSString *)urlStr codeSize:(CGFloat)codeSize logoName:(NSString *)logoName  radius: (CGFloat)radius borderWidth:(CGFloat)borderWidth borderColor:(UIColor *)borderColor;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>简单介绍一些图片裁剪处理的分类。</p>
</blockquote>
<p>1、裁剪图片自定义圆角<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (UIImage *)LX_ClipImageWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat) radious;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">+ (UIImage *)LX_ClipImageWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat) radious&#123;</div><div class="line">    //1、开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    //2、设置裁剪区域</div><div class="line">//    UIBezierPath * path = [UIBezierPath bezierPathWithOvalInRect:rect];</div><div class="line">    UIBezierPath * path = [UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:radious];</div><div class="line">    [path addClip];</div><div class="line">    //3、绘制图片</div><div class="line">    [image drawAtPoint:CGPointZero];</div><div class="line">    //4、获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5、关闭上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //6、返回新图片</div><div class="line">    return newImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-56387fab3d8917dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="圆形裁剪.png"></p>
<p>2、圆形裁剪带边框<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//裁剪带边框的圆形图片</div><div class="line">+ ( UIImage *)LX_ClipCircleImageWithImage:(UIImage *)image circleRect:(CGRect)rect borderWidth:(CGFloat)borderW borderColor:( UIColor *)borderColor;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//裁剪带边框的圆形图片</div><div class="line">+ (UIImage *)LX_ClipCircleImageWithImage:(UIImage *)image circleRect:(CGRect)rect borderWidth:(CGFloat)borderW borderColor:( UIColor *)borderColor&#123;</div><div class="line">    //1、开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    </div><div class="line">    //2、设置边框</div><div class="line">    UIBezierPath * path = [UIBezierPath bezierPathWithOvalInRect:rect];</div><div class="line">    [borderColor setFill];</div><div class="line">    [path fill];</div><div class="line">    </div><div class="line">    //3、设置裁剪区域</div><div class="line">    UIBezierPath * clipPath = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(rect.origin.x + borderW , rect.origin.x + borderW , rect.size.width - borderW * 2, rect.size.height - borderW *2)];</div><div class="line">    [clipPath addClip];</div><div class="line">    </div><div class="line">    //3、绘制图片</div><div class="line">    [image drawAtPoint:CGPointZero];</div><div class="line">    </div><div class="line">    //4、获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5、关闭上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //6、返回新图片</div><div class="line">    return newImage;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-46bfff18e8bd23fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="圆形裁剪边框.png"></p>
<p>3、自定义图片圆角</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//裁剪图片自定义圆角</div><div class="line">+ (UIImage *)LX_ClipImageWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat) radious;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">+ (UIImage *)LX_ClipImageWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat) radious&#123;</div><div class="line">    //1、开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    //2、设置裁剪区域</div><div class="line">//    UIBezierPath * path = [UIBezierPath bezierPathWithOvalInRect:rect];</div><div class="line">    UIBezierPath * path = [UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:radious];</div><div class="line">    [path addClip];</div><div class="line">    //3、绘制图片</div><div class="line">    [image drawAtPoint:CGPointZero];</div><div class="line">    //4、获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5、关闭上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //6、返回新图片</div><div class="line">    return newImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-03e2aa8fc0a1a419.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义图片裁剪圆角.png"></p>
<p>4、自定义图片边框圆角<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//裁剪带边框的图片 可设置圆角 边框颜色</div><div class="line">+(UIImage *)LX_ClipImageRadiousWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat)radious borderWith:(CGFloat)borderW borderColor:( UIColor *)borderColor;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//裁剪带边框的图片 可设置圆角 边框颜色</div><div class="line">+(UIImage *)LX_ClipImageRadiousWithImage:(UIImage *)image circleRect:(CGRect)rect radious:(CGFloat)radious borderWith:(CGFloat)borderW borderColor:( UIColor *)borderColor&#123;</div><div class="line">    </div><div class="line">   </div><div class="line">    //1、开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    </div><div class="line">    //2、设置边框</div><div class="line">    </div><div class="line">    UIBezierPath *path =[UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:radious];</div><div class="line">    </div><div class="line">    [borderColor setFill];</div><div class="line">    </div><div class="line">    [path fill];</div><div class="line">    </div><div class="line">    </div><div class="line">    //3、设置裁剪区域</div><div class="line">    </div><div class="line">    </div><div class="line">    UIBezierPath * clipPath = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(rect.origin.x + borderW , rect.origin.x + borderW , rect.size.width - borderW * 2, rect.size.height - borderW *2) cornerRadius:radious];</div><div class="line">    </div><div class="line">    [clipPath addClip];</div><div class="line">    </div><div class="line">    //3、绘制图片</div><div class="line">    [image drawAtPoint:CGPointZero];</div><div class="line">    </div><div class="line">    //4、获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5、关闭上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //6、返回新图片</div><div class="line">    return newImage;</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-9a99c31770c1feca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义图片边框圆角.png"></p>
<p>5、图片添加水印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//添加水印图片</div><div class="line">+ (UIImage *)LX_WaterImageWithImage:(UIImage *)image waterImage:(UIImage *)waterImage waterImageRect:(CGRect)rect;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//添加水印图片</div><div class="line">+ (UIImage *)LX_WaterImageWithImage:(UIImage *)image waterImage:(UIImage *)waterImage waterImageRect:(CGRect)rect&#123;</div><div class="line">    </div><div class="line">    //1.获取图片</div><div class="line">    </div><div class="line">    //2.开启上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(image.size, NO, 0);</div><div class="line">    //3.绘制背景图片</div><div class="line">    [image drawInRect:CGRectMake(0, 0, image.size.width, image.size.height)];</div><div class="line">    //绘制水印图片到当前上下文</div><div class="line">    [waterImage drawInRect:rect];</div><div class="line">    </div><div class="line">    //4.从上下文中获取新图片</div><div class="line">    UIImage * newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    //5.关闭图形上下文</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    //返回图片</div><div class="line">    return newImage;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-656f4be13e32f014.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片添加水印.png"></p>
<p>demo 里简单封装了下。效果图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-eebbae892a9596a5.gif?imageMogr2/auto-orient/strip" alt="二维码.gif"></p>
<blockquote>
<p>最后说明一下访问相册以及识别二维码进行跳转页面。这一块必须用真机测试。</p>
</blockquote>
<p>关于二维码扫描使用<a href="https://github.com/liuxinixn/SGQRCode" target="_blank" rel="noopener">SGQRCode</a>,<br>相册选择选择<a href="https://github.com/liuxinixn/TZImagePickerController" target="_blank" rel="noopener">TZImagePickerController</a></p>
<p>替换掉博主的选择相册。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">TZImagePickerController *pickerController = [[TZImagePickerController alloc]initWithMaxImagesCount:1 delegate:self];</div><div class="line">   </div><div class="line">   NCWS(weakSelf);</div><div class="line">   </div><div class="line">   [pickerController setDidFinishPickingPhotosHandle:^(NSArray&lt;UIImage *&gt; *photo, NSArray *assets, BOOL isSelectOriginalPhoto)&#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;,photo);</div><div class="line">       </div><div class="line">       UIImage *image = photo[0];</div><div class="line">              // CIDetector(CIDetector可用于人脸识别)进行图片解析，从而使我们可以便捷的从相册中获取到二维码</div><div class="line">       // 声明一个 CIDetector，并设定识别类型 CIDetectorTypeQRCode</div><div class="line">       CIDetector *detector = [CIDetector detectorOfType:CIDetectorTypeQRCode context:nil options:@&#123;CIDetectorAccuracy: CIDetectorAccuracyHigh&#125;];</div><div class="line">       </div><div class="line">       // 取得识别结果</div><div class="line">       NSArray *features = [detector featuresInImage:[CIImage imageWithCGImage:image.CGImage]];</div><div class="line">       </div><div class="line">       if (features.count == 0) &#123;</div><div class="line">           </div><div class="line">       &#125;else&#123;</div><div class="line">           for (int index = 0; index &lt; [features count]; index ++) &#123;</div><div class="line">               CIQRCodeFeature *feature = [features objectAtIndex:index];</div><div class="line">               NSString *resultStr = feature.messageString;</div><div class="line">               weakSelf.detectorString = resultStr;</div><div class="line">              </div><div class="line">           &#125;</div><div class="line">           NSString *result = weakSelf.detectorString;</div><div class="line">           </div><div class="line">               if ([result hasPrefix:@&quot;http&quot;]) &#123;</div><div class="line">                   ScanSuccessJumpVC *jumpVC = [[ScanSuccessJumpVC alloc] init];</div><div class="line">                   jumpVC.jump_URL = result;</div><div class="line">                   [self.navigationController pushViewController:jumpVC animated:YES];</div><div class="line">           </div><div class="line">               &#125; else &#123;</div><div class="line">                   ScanSuccessJumpVC *jumpVC = [[ScanSuccessJumpVC alloc] init];</div><div class="line">                   jumpVC.jump_bar_code = result;</div><div class="line">                   [self.navigationController pushViewController:jumpVC animated:YES];</div><div class="line">               &#125;</div><div class="line"></div><div class="line">           </div><div class="line">       &#125;</div><div class="line"></div><div class="line">   &#125;];</div><div class="line">   [self presentViewController:pickerController animated:YES completion:nil];</div></pre></td></tr></table></figure>
<p>demo地址:<a href="https://github.com/liuxinixn/LXQRCode/tree/master" target="_blank" rel="noopener">二维码制作与图片处理</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/06/02/CoreGraphics-压缩图片的正确姿势/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/02/CoreGraphics-压缩图片的正确姿势/" itemprop="url">CoreGraphices -压缩图片的正确姿势</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-02T20:19:35+08:00">
                2016-06-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#####压缩图片的几种方法，我们都知道如果在上传的图片过大，上传会很慢，所以客户端这边需要做图片压缩。当然紧紧是对于加载图片的UIImagview 进行等比例压缩是不正确的，要从根本上改变图片的大小。</p>
<blockquote>
<p> 1 、NSData *imageData = UIImageJPEGRepresentation(image, 0.5);<br>这个返回的是二进制的data值，可以通过打印知道大小确实减少了好多，通过此方法确实能优化性能，需要注意的是这个0.5，并不是说压缩到之前图片的二分之一<br>，应该是个系数之类的数值，这样的话图片压缩之后性能会好很多，但是不建议这个，因为解压缩的时候很耗费性能建议使用第二种方法</p>
<p>2、 使用CoreGraphics 重新绘制一张等比例的图片</p>
</blockquote>
<p>小小的测试一下： </p>
<p>原图<br><img src="http://upload-images.jianshu.io/upload_images/1694376-954d3694707bfc3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="原图.png"></p>
<p>经过下面代码压缩后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (UIImage *)imageWithImage:(UIImage*)image</div><div class="line">               scaledToSize:(CGSize)newSize;</div><div class="line">&#123;</div><div class="line">    UIGraphicsBeginImageContext(newSize);</div><div class="line">    [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];</div><div class="line">    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    </div><div class="line">    NSString * path = [NSString stringWithFormat:@&quot;%@/Documents/cutSome.jpg&quot;,NSHomeDirectory()];</div><div class="line">    NSData * imagedata = UIImageJPEGRepresentation(newImage, 1);</div><div class="line"></div><div class="line">    if( [imagedata writeToFile:path atomically:YES])&#123;</div><div class="line">        NSLog(@&quot;保存成功%@&quot;,path);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return newImage;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>压缩后 ：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-ec24497911240929.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="压缩后.png"></p>
<blockquote>
<p>如果只是单纯的使用第一种方法，图片确实会变小，分辨率也没有变化，但是在解压缩的过程中，会很耗性能，但是第二种方法 会按等比例的缩放像素，不会失真，对性能的耗损也比较小</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/06/01/CoreGraphics-练习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/01/CoreGraphics-练习/" itemprop="url">CoreGraphices -</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-01T20:19:35+08:00">
                2016-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>主要熟悉 一些 基本的API</p>
</blockquote>
<p>#####获取上下文的集中方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//创建图片类型的上下文</div><div class="line">UIGraphicsBeginImageContextWithOptions</div><div class="line">//UIView,在drawRect中，Cocoa会为你创建一个图形上下文</div><div class="line">- (void)drawRect:(CGRect)rect</div><div class="line">//CALayer</div><div class="line">- (void)drawInContext:(CGContextRef)ctx</div><div class="line">//delegate回调</div><div class="line">- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</div></pre></td></tr></table></figure></p>
<p>#####先从drawRect开始</p>
<p>先说 一些API的区别 与相同 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">UIBezierPath 可以 直接 stroke 或者fill ，不需要添加到上下文中，也不需要进行绘制。</div><div class="line"> [pathRect stroke];  //可是设置 添加路径然后进行喷绘 UIBezierPath 本身有stroke 方法</div><div class="line">    //添加路径</div><div class="line">//    CGContextAddPath(contextRef, pathRect.CGPath);</div><div class="line">//    CGContextStrokePath(contextRef);</div></pre></td></tr></table></figure></p>
<p>关于设置颜色： 描边与填充同样的道理，当然要选取最简单的代码来实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[UIColor blueColor]set]  等于setFill + setStroke</div><div class="line"> [[UIColor redColor]setFill]; //等同于   CGContextSetFillColorWithColor(contextRef, [UIColor redColor].CGColor);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//kCGPathFill填充非零绕数规则,</div><div class="line">kCGPathEOFill表示用奇偶规则,</div><div class="line">kCGPathStroke路径,</div><div class="line">kCGPathFillStroke路径填充,</div><div class="line">kCGPathEOFillStroke表示描线，不是填充</div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);//绘制路径 加填充</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//画笑脸弧线</div><div class="line">   //左</div><div class="line">   CGContextMoveToPoint(context, 140, 80);//开始坐标p1</div><div class="line">   //CGContextAddArcToPoint(CGContextRef c, CGFloat x1, CGFloat y1,CGFloat x2, CGFloat y2, CGFloat radius)</div><div class="line">   //x1,y1跟p1形成一条线的坐标p2，x2,y2结束坐标跟p3形成一条线的p3,radius半径,注意, 需要算好半径的长度,</div><div class="line">   CGContextAddArcToPoint(context, 148, 68, 156, 80, 10);//⚠️</div><div class="line">   CGContextStrokePath(context);</div></pre></td></tr></table></figure>
<blockquote>
<p>下面是一些简单的绘制</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-d73c30d1c781718d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="绘制.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    </div><div class="line">    CGContextRef contextRef = UIGraphicsGetCurrentContext();</div><div class="line">    </div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">    </div><div class="line">    </div><div class="line">    UIBezierPath *path =[UIBezierPath bezierPath];</div><div class="line">    [path moveToPoint:CGPointMake(10, 10)];</div><div class="line">    [path addLineToPoint:CGPointMake(100, 100)];</div><div class="line">    </div><div class="line">//    [[UIColor whiteColor]setStroke];</div><div class="line">    UIColor *color =[UIColor whiteColor];</div><div class="line">    CGContextSetStrokeColorWithColor(contextRef, color.CGColor);</div><div class="line">    CGContextAddPath(contextRef, path.CGPath);</div><div class="line">    CGContextStrokePath(contextRef);</div><div class="line">//    CGContextDrawPath(contextRef, kCGPathStroke);</div><div class="line">    </div><div class="line">    </div><div class="line">    //通过点 做矩形</div><div class="line">    </div><div class="line">    UIBezierPath *pathRect =[UIBezierPath bezierPath];</div><div class="line">    [pathRect moveToPoint:CGPointMake(10, 110)];</div><div class="line">    [pathRect addLineToPoint:CGPointMake(110, 110)];</div><div class="line">    [pathRect addLineToPoint:CGPointMake(110, 210)];</div><div class="line">    [pathRect addLineToPoint:CGPointMake(10, 210)];</div><div class="line">    //闭合路径</div><div class="line">    [pathRect closePath];</div><div class="line">    </div><div class="line">    //设置颜色</div><div class="line">    [[UIColor redColor]setStroke];</div><div class="line">    </div><div class="line">    [pathRect stroke];  //可是设置 添加路径然后进行喷绘 UIBezierPath 本身有stroke 方法</div><div class="line">    //添加路径</div><div class="line">//    CGContextAddPath(contextRef, pathRect.CGPath);</div><div class="line">    </div><div class="line">//    CGContextStrokePath(contextRef);</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    UIBezierPath *pathRect2 =[UIBezierPath bezierPathWithRect:CGRectMake(110, 10, 100, 100)];</div><div class="line">    CGContextSetFillColorWithColor(contextRef, [UIColor blueColor].CGColor);</div><div class="line">    [pathRect2 fill];</div><div class="line">    </div><div class="line">    </div><div class="line">    //设置颜色</div><div class="line">    [[UIColor brownColor]setStroke];</div><div class="line">    UIBezierPath *pathRect3 =[UIBezierPath bezierPathWithRect:CGRectMake(215, 10, 100, 100)];</div><div class="line"></div><div class="line">    [[UIColor redColor]setFill]; //等同于  [[UIColor redColor]set] CGContextSetFillColorWithColor(contextRef, [UIColor redColor].CGColor);</div><div class="line"></div><div class="line">    //添加路径   这两步等同于 [pathRect3 fill];</div><div class="line">    CGContextAddPath(contextRef, pathRect3.CGPath);</div><div class="line"></div><div class="line">    CGContextFillPath(contextRef);</div><div class="line"></div><div class="line">    </div><div class="line">    //画圆</div><div class="line">    //ArcCenter:中心点</div><div class="line">    //radius:半径</div><div class="line">    //startAngle：起始角度</div><div class="line">    //endAngle：结束角度</div><div class="line">    //clockwise：是否逆时针</div><div class="line">    UIBezierPath *pathCircle =[UIBezierPath bezierPathWithArcCenter:CGPointMake(170, 170) radius:50 startAngle:0 endAngle:M_PI *2 clockwise:NO];</div><div class="line">   </div><div class="line">//    [pathCircle fill];//填充</div><div class="line">    pathCircle.lineWidth = 5;</div><div class="line">    [pathCircle stroke];</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    //椭圆</div><div class="line">    UIBezierPath *pathOvar =[UIBezierPath bezierPathWithOvalInRect:CGRectMake(230, 120, 150, 100)];</div><div class="line">    </div><div class="line">    pathOvar.lineWidth = 5;</div><div class="line">    [pathOvar fill];</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    [[UIColor whiteColor]set];</div><div class="line">    //矩形</div><div class="line">    UIBezierPath *pathText =[UIBezierPath bezierPathWithRect:CGRectMake(10, 220, 100, 100)];</div><div class="line">    </div><div class="line">    pathText.lineWidth = 5;</div><div class="line">    [pathText fill];</div><div class="line">    //矩形中画字</div><div class="line">    NSString *str = @&quot;他大舅他二舅都是他舅&quot;;</div><div class="line">    NSMutableDictionary *dic =[NSMutableDictionary dictionary];</div><div class="line">    dic[NSForegroundColorAttributeName]= [UIColor purpleColor];</div><div class="line">    dic[NSFontAttributeName] = [UIFont systemFontOfSize:15];</div><div class="line">    dic[NSUnderlineStyleAttributeName] = @(NSUnderlineStyleSingle);</div><div class="line">    NSShadow *shadow =[[NSShadow alloc]init];</div><div class="line">    shadow.shadowOffset = CGSizeMake(2, 2);</div><div class="line">    shadow.shadowColor =[UIColor cyanColor];</div><div class="line">    dic[NSShadowAttributeName] = shadow;</div><div class="line">    </div><div class="line">    //字体间距</div><div class="line">    dic[NSKernAttributeName] = @5;</div><div class="line">    [str drawInRect:CGRectMake(10, 220, 100, 100) withAttributes:dic];</div><div class="line">    CGContextStrokePath(contextRef);</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    //椭圆 贝塞尔曲线</div><div class="line">    UIBezierPath *pathCurver =[UIBezierPath bezierPath];</div><div class="line"></div><div class="line">    [pathCurver moveToPoint:CGPointMake(120, 230)];</div><div class="line">    [pathCurver addQuadCurveToPoint:CGPointMake(200, 300) controlPoint:CGPointMake(150, 200)];</div><div class="line">    pathCurver.lineWidth = 5;</div><div class="line">    [pathCurver stroke];</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">    //绘制图片</div><div class="line">    UIImage *image =[UIImage imageNamed:@&quot;1&quot;];</div><div class="line">    </div><div class="line">    //设置绘制模式</div><div class="line">    [image drawInRect:CGRectMake(10, 330, 100, 100) blendMode:kCGBlendModeSoftLight alpha:1];</div><div class="line">    CGContextStrokePath(contextRef);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####不用贝塞尔曲线的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    </div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    //只描边</div><div class="line">    [[UIColor blueColor]setStroke];</div><div class="line">    [[UIColor redColor]setFill];</div><div class="line">   </div><div class="line">    CGContextSetLineWidth(context, 5.0);</div><div class="line">    CGContextStrokeRect(context, CGRectMake(100, 120, 100, 100));</div><div class="line"></div><div class="line">    CGContextFillRect(context, CGRectMake(100, 300, 100, 100));</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    CGContextDrawPath(context, kCGPathFillStroke);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p> 最后详细说明下 CGContextSaveGState CGContextRestoreGState   //保存当前上下文状态，如果做了裁剪就会在裁剪范围内 进行绘制，只有恢复到之前的上下文状态，才可以在裁剪区域之外进行绘制</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-6be7c39c780f2522.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上下文状态.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    </div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">    </div><div class="line">    //只描边</div><div class="line">    [[UIColor blueColor]setStroke];</div><div class="line">    [[UIColor redColor]setFill];</div><div class="line"></div><div class="line">    </div><div class="line">    //渐变色 采用layer</div><div class="line">    CAGradientLayer *gradient1 = [CAGradientLayer layer];</div><div class="line">    gradient1.frame = CGRectMake(100, 200, 60, 30);</div><div class="line">    gradient1.colors = [NSArray arrayWithObjects:(id)[UIColor whiteColor].CGColor,</div><div class="line">                        (id)[UIColor grayColor].CGColor,</div><div class="line">                        (id)[UIColor blackColor].CGColor,</div><div class="line">                        (id)[UIColor yellowColor].CGColor,</div><div class="line">                        (id)[UIColor blueColor].CGColor,</div><div class="line">                        (id)[UIColor redColor].CGColor,</div><div class="line">                        (id)[UIColor greenColor].CGColor,</div><div class="line">                        (id)[UIColor orangeColor].CGColor,</div><div class="line">                        (id)[UIColor brownColor].CGColor,nil];</div><div class="line">    [self.layer insertSublayer:gradient1 atIndex:0];</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    //保存当前上下文状态，如果做了裁剪就会在裁剪范围内 进行绘制，只有恢复到之前的上下文状态，才可以在裁剪区域之外进行绘制</div><div class="line">    CGContextSaveGState(context);</div><div class="line">    </div><div class="line">    CGContextMoveToPoint(context, 250, 300);</div><div class="line">    CGContextAddLineToPoint(context,350, 300);</div><div class="line">    CGContextAddLineToPoint(context, 350, 400);</div><div class="line">    CGContextAddLineToPoint(context, 250, 400);</div><div class="line">    CGContextClip(context);//context裁剪路径,后续操作的路径</div><div class="line"></div><div class="line">    //CGContextDrawLinearGradient(CGContextRef context,CGGradientRef gradient, CGPoint startPoint, CGPoint endPoint,CGGradientDrawingOptions options)</div><div class="line">    //gradient渐变颜色,startPoint开始渐变的起始位置,endPoint结束坐标,options开始坐标之前or开始之后开始渐变</div><div class="line">    CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB();</div><div class="line">    CGFloat colors[] =</div><div class="line">    &#123;</div><div class="line">        1,1,1, 1.00,</div><div class="line">        1,1,0, 1.00,</div><div class="line">        1,0,0, 1.00,</div><div class="line">        1,0,1, 1.00,</div><div class="line">        0,1,1, 1.00,</div><div class="line">        0,1,0, 1.00,</div><div class="line">        0,0,1, 1.00,</div><div class="line">        0,0,0, 1.00,</div><div class="line">    &#125;;</div><div class="line">    CGGradientRef gradient = CGGradientCreateWithColorComponents</div><div class="line">    (rgb, colors, NULL, sizeof(colors)/(sizeof(colors[0])*4));//形成梯形，渐变的效果</div><div class="line">    CGColorSpaceRelease(rgb);</div><div class="line">    </div><div class="line">    CGContextDrawLinearGradient(context, gradient, CGPointMake(250, 300), CGPointMake(350, 400), kCGGradientDrawsAfterEndLocation);</div><div class="line"></div><div class="line">    //恢复上下文状态</div><div class="line">    CGContextRestoreGState(context);</div><div class="line">    </div><div class="line">  //如果没有恢复上下文状态，下方的矩形是看不见的</div><div class="line">    CGContextFillRect(context, CGRectMake(100, 450, 100, 100));</div><div class="line">    CGContextDrawPath(context, kCGPathFill);</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/20/CoreGraphics-绘制聊天气泡（图片类型的cell）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/20/CoreGraphics-绘制聊天气泡（图片类型的cell）/" itemprop="url">CoreGraphics-绘制聊天气泡（图片类型的cell）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-20T20:19:35+08:00">
                2016-05-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看下效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-a6a2e3e20aea4647.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="效果图.png"></p>
<p>在聊天时，如果消息类型是纯图片类型，对于加载图片的bubble 气泡，就不太好处理了，需要将图片充满整个气泡。所以我们需要对图片做一下处理。</p>
<blockquote>
<p>首先我们自定义view里实现类似的效果： 就是裁剪好这么一个带凸起的区域，然后把图片绘制在限定区域内；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    // Drawing code</div><div class="line">    </div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">    CGContextSetLineWidth(context, 5);</div><div class="line">    CGContextSaveGState(context);</div><div class="line">    //先剪裁区域</div><div class="line">    UIBezierPath *path =[UIBezierPath bezierPathWithRoundedRect:CGRectMake(0, 0, 200 -10, 301) cornerRadius:6];</div><div class="line">    path.lineWidth = 5;</div><div class="line">    [path moveToPoint:CGPointMake(200-10, 0)];</div><div class="line">    [path addLineToPoint:CGPointMake(200-10, 13)];</div><div class="line">    [path addLineToPoint:CGPointMake(200-10+5, 16)];</div><div class="line">    [path addLineToPoint:CGPointMake(200-10, 19)];</div><div class="line">    [path closePath];</div><div class="line">    </div><div class="line"></div><div class="line">    [path fill];</div><div class="line">    [path addClip];</div><div class="line">    </div><div class="line">    //裁剪好区域后 然后把图片绘制上去</div><div class="line">    UIImage *iamge =[UIImage imageNamed:@&quot;cutSome&quot;];</div><div class="line">    [iamge drawInRect:path.bounds];</div><div class="line"></div><div class="line">        context = UIGraphicsGetCurrentContext();</div><div class="line">    CGContextStrokePath(context);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####可以实现类似效果</p>
<blockquote>
<p>上面的处理明显是不对的，我们可以对图片进行直接处理，然后用imageview 加载即可 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &quot;LXView.h&quot;</div><div class="line">#define APP_WIDTH ([UIScreen mainScreen].bounds.size.width)</div><div class="line">#define APP_HEIGHT ([UIScreen mainScreen].bounds.size.height)</div><div class="line">@interface ViewController ()</div><div class="line">@property(nonatomic,strong)UIImageView *imageview;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    UIImage *imagecon=[UIImage imageNamed:@&quot;1&quot;];</div><div class="line">    </div><div class="line">   imagecon =  [self imageWithImage:imagecon scaledToSize:CGSizeMake(200, 200 *775.0/515)];</div><div class="line">    </div><div class="line">    self.imageview =[[UIImageView alloc]initWithFrame:CGRectMake(50, 100, imagecon.size.width, imagecon.size.height)];</div><div class="line">//    self.imageview.image = imagecon;</div><div class="line">    self.imageview.image =[self makeArrow:imagecon imageSize:imagecon.size];</div><div class="line">    [self.view addSubview:self.imageview];</div><div class="line">    </div><div class="line">    self.imageview.backgroundColor =[UIColor redColor];</div><div class="line">//    LXView *view =[[LXView alloc]initWithFrame:CGRectMake(20, 100, 210,400)];</div><div class="line">//    view.backgroundColor =[UIColor redColor];</div><div class="line">//    [self.view addSubview:view];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//对图片进行压缩 </div><div class="line">- (UIImage *)imageWithImage:(UIImage*)image</div><div class="line">               scaledToSize:(CGSize)newSize;</div><div class="line">&#123;</div><div class="line">    UIGraphicsBeginImageContext(newSize);</div><div class="line">    [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];</div><div class="line">    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    </div><div class="line">//    NSString * path = [NSString stringWithFormat:@&quot;%@/Documents/cutSome.jpg&quot;,NSHomeDirectory()];</div><div class="line">//    NSData * imagedata = UIImageJPEGRepresentation(newImage, 1);</div><div class="line">//</div><div class="line">//    if( [imagedata writeToFile:path atomically:YES])&#123;</div><div class="line">//        NSLog(@&quot;保存成功%@&quot;,path);</div><div class="line">//    &#125;</div><div class="line"></div><div class="line">    return newImage;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line">//添加箭头，其实和第一种道理一样，也是绘制一个凸起的区域，然后把图片绘制上去达到效果，不过处理的是图形上下文；</div><div class="line">-(UIImage *)makeArrow:(UIImage *)image  imageSize:(CGSize )imageSize</div><div class="line"></div><div class="line">&#123;</div><div class="line">    </div><div class="line">    CGFloat arrowWidth = 6;</div><div class="line">    CGFloat marginTop = 13;</div><div class="line">    CGFloat arrowHeight = 10;</div><div class="line">    CGFloat imageW = imageSize.width;</div><div class="line"></div><div class="line">    </div><div class="line">    //开始上下文</div><div class="line">    UIGraphicsBeginImageContext(imageSize);</div><div class="line">    //获得上下文</div><div class="line">    CGContextRef context =UIGraphicsGetCurrentContext();</div><div class="line">        UIBezierPath *path =[UIBezierPath bezierPathWithRoundedRect:CGRectMake(0, 0, imageSize.width- arrowWidth, imageSize.height) cornerRadius:6];</div><div class="line">    [path moveToPoint:CGPointMake(imageW - arrowWidth, 0)];</div><div class="line">    [path addLineToPoint:CGPointMake(imageW - arrowWidth, marginTop)];</div><div class="line">    [path addLineToPoint:CGPointMake(imageW, marginTop + 0.5 * arrowHeight)];</div><div class="line">    [path addLineToPoint:CGPointMake(imageW - arrowWidth, marginTop + arrowHeight)];</div><div class="line">    [path closePath];</div><div class="line">    path.lineWidth = 3;</div><div class="line">    CGContextAddPath(context, path.CGPath);</div><div class="line">//    CGContextEOClip(context);</div><div class="line">    [path addClip];</div><div class="line">    [image drawInRect:CGRectMake(0, 0, imageSize.width, imageSize.height)];</div><div class="line">    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    return newImage;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/19/CoreAnimation之maskLayer使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/19/CoreAnimation之maskLayer使用/" itemprop="url">CoreAnimation之maskLayer使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-19T20:19:35+08:00">
                2016-05-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>demo 地址：<a href="https://github.com/liuxinixn/MaskLayer" target="_blank" rel="noopener">MaskLayer使用</a><br><img src="http://upload-images.jianshu.io/upload_images/1694376-979ecf2a4a198745.gif?imageMogr2/auto-orient/strip" alt="1.gif"><br>因为初学动画的缘故，对mask 蒙版理解不是很到位。</p>
<p> demo中的三个例子效果其实都是有<strong>前景和背景图视图，mask只是加在前景视图上</strong>，在使用mask的时候，会直接覆盖掉被遮盖图层（如果frame 与被覆盖层相同的话），然后我们可以通过改变mask layer 的一些属性做一些动画。</p>
<blockquote>
<p>首先看下 ❤️ 形的注水效果 </p>
</blockquote>
<p><strong>1</strong>. 要实现这样的效果，我们需要准备两张图片，比如<br>背景：<img src="http://upload-images.jianshu.io/upload_images/1694376-283a683670025357.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="心2.png"><br>前景：<br><img src="http://upload-images.jianshu.io/upload_images/1694376-c104e6bad2904e45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="心.png"><br>我们需要做的就是设置一个mask 蒙版加载前景视图上，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line"> self.maskLayer =[CAShapeLayer layer];</div><div class="line">//大小一样</div><div class="line"> self.maskLayer.frame = self.imageView.bounds;</div><div class="line"> CGPoint center  =  CGPointMake(self.bounds.size.width/2, self.bounds.size.height/2);</div><div class="line"> UIBezierPath *path =[UIBezierPath bezierPathWithArcCenter:center radius:100 startAngle:0 endAngle:2 *M_PI clockwise:YES];</div><div class="line"> self.maskLayer.path = path.CGPath;</div><div class="line"> self.imageView.layer.mask =  self.maskLayer;</div></pre></td></tr></table></figure></p>
<p><strong>2</strong>. 实现注水效果的第二步，我们要实现那样的动态效果，视图中能看到的是蒙版与前景共同作用的效果。当我们把蒙版从 下方移动到上方，就可以可以实现。<br> 首先在初始化maskLayer时需要设置maskLayer的位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.maskLayer.position =CGPointMake(self.bounds.size.width/2, self.bounds.size.height * 1.5);</div></pre></td></tr></table></figure></p>
<p>然后做一个基础动画即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CABasicAnimation *animation =[CABasicAnimation animation];</div><div class="line">    animation.keyPath = @&quot;position&quot;;</div><div class="line">    animation.duration = 2;</div><div class="line">    animation.repeatCount = HUGE;</div><div class="line">    animation.fromValue = [NSValue valueWithCGPoint:CGPointMake(self.bounds.size.width/2, self.bounds.size.height * 1.5)]; //因为蒙版大小和前景图大小一样，我们需要把中心点向下移动一倍的高度</div><div class="line">    animation.toValue = [NSValue valueWithCGPoint:CGPointMake(self.bounds.size.width/2, self.bounds.size.height/2)];</div><div class="line">    [self.maskLayer addAnimation:animation forKey:nil];</div><div class="line">    self.maskLayer.position = CGPointMake(self.bounds.size.width/2, self.bounds.size.height * 1.5);</div></pre></td></tr></table></figure></p>
<p>这样基本上 一个简单的动画就实现了，如果想实现两个方向的 注水，可以添加两个subLayer作为蒙版</p>
<blockquote>
<p>文字渐变</p>
</blockquote>
<p><a href="http://www.jianshu.com/p/6c8f645cb604" target="_blank" rel="noopener">参考文章</a><br>也是使用了两个视图 加一个蒙版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic,strong)UILabel *forelLabel;</div><div class="line">@property(nonatomic,strong)UILabel *backLabel;</div><div class="line">@property(nonatomic,strong)CAGradientLayer *maskLayer;</div></pre></td></tr></table></figure></p>
<p>动画代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">-(void)setType:(GradientType)type</div><div class="line">&#123;</div><div class="line">    _type = type;</div><div class="line">    switch (type) &#123;</div><div class="line">        case fadeOne:</div><div class="line">            self.maskLayer.colors = @[(id)[UIColor clearColor],(id)[UIColor redColor].CGColor,(id)[UIColor blackColor].CGColor,(id)[UIColor clearColor].CGColor];</div><div class="line">            self.maskLayer.locations = @[@(0.01),@(0.1),@(0.9),@(0.99)];</div><div class="line">            [self fadeString:(self.bounds.size.width)];</div><div class="line">            break;</div><div class="line">        case fadeTwo:</div><div class="line">             self.maskLayer.colors = @[(id)[UIColor clearColor].CGColor,(id)[UIColor redColor].CGColor,(id)[UIColor clearColor].CGColor];</div><div class="line">             self.maskLayer.locations = @[@(0.25),@(0.5),@(0.75)];</div><div class="line">             self.maskLayer.startPoint = CGPointMake(0, 0);</div><div class="line">             self.maskLayer.endPoint = CGPointMake(1, 0);</div><div class="line">           </div><div class="line">             self.maskLayer.position = CGPointMake(-self.bounds.size.width/2.0, self.bounds.size.height/2.0);</div><div class="line">           //默认中心点修改为左侧一半处。</div><div class="line">            [self iphoneFade: (self.bounds.size.width+self.bounds.size.width/2.0)];</div><div class="line">            break;</div><div class="line">        default:</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)fadeString:(CGFloat) toValue</div><div class="line">&#123;</div><div class="line">    CABasicAnimation *basicAnimation = [CABasicAnimation animation];</div><div class="line">    basicAnimation.keyPath = @&quot;transform.translation.x&quot;;</div><div class="line">    basicAnimation.fromValue = @(0);</div><div class="line">    basicAnimation.toValue = @(toValue);</div><div class="line">    basicAnimation.duration = 2;</div><div class="line">    basicAnimation.repeatCount = HUGE;</div><div class="line">    basicAnimation.removedOnCompletion = NO;</div><div class="line">    basicAnimation.fillMode = kCAFillModeForwards;</div><div class="line">    [self.maskLayer addAnimation:basicAnimation forKey:nil];</div><div class="line"></div><div class="line">&#125;</div><div class="line">-(void)iphoneFade:(CGFloat) toValue</div><div class="line">&#123;</div><div class="line">    CABasicAnimation *basicAnimation = [CABasicAnimation animation];</div><div class="line">    basicAnimation.keyPath = @&quot;transform.translation.x&quot;;</div><div class="line">    basicAnimation.fromValue = @(0);</div><div class="line">    basicAnimation.toValue = @(toValue);</div><div class="line">    basicAnimation.duration = 2;</div><div class="line">    basicAnimation.repeatCount = HUGE;</div><div class="line">    basicAnimation.removedOnCompletion = NO;</div><div class="line">    basicAnimation.fillMode = kCAFillModeForwards;</div><div class="line">    [self.maskLayer addAnimation:basicAnimation forKey:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/18/CoreAnimation之CAReplicatorLayer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="雪晟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪晟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/18/CoreAnimation之CAReplicatorLayer/" itemprop="url">CoreAnimation之CAReplicatorLayer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-18T20:19:35+08:00">
                2016-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CAReplicatorLayer 一般用来复制层或者反射。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-e6fd9c0497884002.gif?imageMogr2/auto-orient/strip" alt="3.gif"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line">@property(nonatomic,strong)UIView *containView;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line"></div><div class="line">    self.containView =[[UIView alloc]initWithFrame:CGRectMake(self.view.frame.size.width/2 -100, self.view.frame.size.height/2 - 100, 200, 200)];</div><div class="line">    self.containView.backgroundColor =[UIColor redColor];</div><div class="line">    [self.view addSubview:self.containView];</div><div class="line">    </div><div class="line"></div><div class="line">    CAReplicatorLayer *replayer =[CAReplicatorLayer layer];</div><div class="line">    replayer.frame = self.containView.bounds;</div><div class="line">    [self.containView.layer addSublayer:replayer];</div><div class="line">    CALayer *layer = [CALayer layer];</div><div class="line">    </div><div class="line"></div><div class="line">    layer.frame = CGRectMake(0, replayer.bounds.size.height -150, 10, 150);</div><div class="line"></div><div class="line">    layer.backgroundColor = [UIColor whiteColor].CGColor;</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    [replayer addSublayer:layer];</div><div class="line">    </div><div class="line">    CABasicAnimation *anim = [CABasicAnimation animation];</div><div class="line">    </div><div class="line">    anim.keyPath = @&quot;transform.scale.y&quot;;</div><div class="line">    </div><div class="line">    anim.toValue = @0.1;</div><div class="line">    </div><div class="line">    anim.duration = 0.5;</div><div class="line">    </div><div class="line">    anim.repeatCount = MAXFLOAT;</div><div class="line">    </div><div class="line">    // 设置动画反转</div><div class="line">    anim.autoreverses = YES;</div><div class="line">    </div><div class="line">    </div><div class="line">    [layer addAnimation:anim forKey:nil];</div><div class="line">    </div><div class="line">    </div><div class="line">//     复制层中子层总数</div><div class="line">//     instanceCount：表示复制层里面有多少个子层，包括原始层</div><div class="line">    replayer.instanceCount = 5;</div><div class="line">    </div><div class="line">    // 设置复制子层偏移量，不包括原始层,相对于原始层x偏移</div><div class="line">//    replayer.instanceTransform = CATransform3DIdentity;</div><div class="line"></div><div class="line">   </div><div class="line">    CATransform3D tranform = CATransform3DIdentity;</div><div class="line">    tranform = CATransform3DMakeTranslation(45, 0, 0);</div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">    replayer.instanceTransform =tranform;</div><div class="line">    </div><div class="line">    // 设置复制层动画延迟时间</div><div class="line">    replayer.instanceDelay = 0.1;</div><div class="line">    </div><div class="line">    // 如果设置了原始层背景色，就不需要设置这个属性</div><div class="line">    replayer.instanceColor = [UIColor greenColor].CGColor;</div><div class="line">    </div><div class="line">    replayer.instanceGreenOffset = -0.3;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg"
              alt="雪晟" />
          
            <p class="site-author-name" itemprop="name">雪晟</p>
            <p class="site-description motion-element" itemprop="description">多去尝试你从未尝试的。</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">100</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/liuxinixn" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/3d7c50f31b88" target="_blank" title="Jianshu">
                  
                    <i class="fa fa-fw fa-flag"></i>Jianshu</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">雪晟</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/three/three.min.js"></script>

  
  <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
