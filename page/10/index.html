<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="å¤šå»å°è¯•ä½ ä»æœªå°è¯•çš„ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="é›ªæ™Ÿ">
<meta property="og:url" content="liuxinixn.github.io/page/10/index.html">
<meta property="og:site_name" content="é›ªæ™Ÿ">
<meta property="og:description" content="å¤šå»å°è¯•ä½ ä»æœªå°è¯•çš„ã€‚">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="é›ªæ™Ÿ">
<meta name="twitter:description" content="å¤šå»å°è¯•ä½ ä»æœªå°è¯•çš„ã€‚">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="liuxinixn.github.io/page/10/"/>





  <title>é›ªæ™Ÿ</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">é›ªæ™Ÿ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">åå¹´é¥®å†°ï¼Œéš¾å‡‰çƒ­è¡€ã€‚æˆ‘æ˜¯é›ªæ™Ÿã€‚</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/06/CoreAnimationä¹‹è´å¡å°”æ›²çº¿ï¼ˆåŠ å…¥è´­ç‰©è½¦åŠ¨ç”»ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/06/CoreAnimationä¹‹è´å¡å°”æ›²çº¿ï¼ˆåŠ å…¥è´­ç‰©è½¦åŠ¨ç”»ï¼‰/" itemprop="url">CoreAnimationä¹‹è´å¡å°”æ›²çº¿</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-06T20:19:35+08:00">
                2016-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/1694376-c32df5200c40e600.gif?imageMogr2/auto-orient/strip" alt="12.gif"></p>
<blockquote>
<p><strong>åŠ å…¥è´­ç‰©è½¦è¿™ä¸ªåŠ¨ç”»å…³é”®æ˜¯è´å¡å°”æ›²çº¿çš„ç»˜åˆ¶ï¼Œç„¶åç»™è´­ç‰©è½¦åŠ ä¸Šä¸€ä¸ªå…³é”®å¸§åŠ¨ç”»å³å¯ã€‚</strong></p>
</blockquote>
<p>è´å¡å°”æ›²çº¿çš„èµ·ç‚¹ä»cell ä¸­buttonå¼€å§‹ï¼Œåˆ°è´­ç‰©è½¦ä½ç½®ç»“æŸï¼Œæ§åˆ¶ç‚¹å– èµ·ç‚¹çš„çºµåæ ‡ï¼Œç»ˆç‚¹çš„æ¨ªåæ ‡ã€‚<br>å› ä¸ºä¸åœ¨ä¸€ä¸ªåæ ‡ç³»å†…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è½¬æ¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (CGPoint)convertPoint:(CGPoint)point toView:(nullable UIView *)view;</div><div class="line">- (CGPoint)convertPoint:(CGPoint)point fromView:(nullable UIView *)view;</div><div class="line">- (CGRect)convertRect:(CGRect)rect toView:(nullable UIView *)view;</div><div class="line">- (CGRect)convertRect:(CGRect)rect fromView:(nullable UIView *)view;</div></pre></td></tr></table></figure></p>
<p><strong>åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠè´­ç‰©è½¦ä»¥åŠ cell ä¸Šçš„åŠ å…¥è´­ç‰©è½¦æŒ‰é’® å…¨éƒ¨è½¬æ¢åˆ°selv.viewä¸Šï¼ˆps:æœ¬æ¥æƒ³æŠŠè´­ç‰©è½¦çš„ä¸­å¿ƒç‚¹è½¬åŒ–åˆ°tableviewï¼Œä¸Šï¼ŒæŠŠåŠ¨ç”»å°è£…åœ¨cellçš„button ç‚¹å‡»äº‹ä»¶é‡Œï¼Œå¯æ˜¯å¤±è´¥äº†ï¼Œ ä»£ç†æ–¹æ³•ä¼šèµ°ï¼Œä½†æ˜¯æ²¡æœ‰åŠ¨ç”»æ•ˆæœğŸ˜¢ï¼‰</strong></p>
<blockquote>
<p>cell ä¸­çš„å›è°ƒå¤„ç†</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[self layoutIfNeeded];//xibåˆå§‹åŒ–ï¼Œéœ€è¦è·å¾—æ­£ç¡®çš„frame</div><div class="line">   </div><div class="line">   CGPoint carButtonCenter = sender.center;</div><div class="line">   </div><div class="line">   //æŠŠbuttonåœ¨cellåæ ‡è½¬åŒ–ä¸ºåœ¨tableViewä¸Šçš„åæ ‡</div><div class="line">   CGPoint point = [self convertPoint:carButtonCenter toView:self.superview.superview];</div><div class="line">   </div><div class="line">   //å›è°ƒ</div><div class="line">   if (_shoppingButtonBlock)</div><div class="line">   &#123;</div><div class="line">       _shoppingButtonBlock(point);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>viewcontrollerä¸­çš„å¤„ç†</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath</div><div class="line">&#123;</div><div class="line">    MyCell *cell =[tableView dequeueReusableCellWithIdentifier:cellId];</div><div class="line">    if (!cell) &#123;</div><div class="line">        cell =[[MyCell alloc]initWithStyle:UITableViewCellStyleDefault reuseIdentifier:cellId];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    __weak ViewController *weakSelf = self;</div><div class="line">    [cell setShoppingButtonBlock:^(CGPoint centerPoint) &#123;</div><div class="line">        //å…³é”®å¸§åŠ¨ç”»å¤„ç†</div><div class="line">        [weakSelf startAnimate:centerPoint];</div><div class="line">    &#125;];</div><div class="line">   </div><div class="line">    return cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¯ä»¥æŠŠCAShapeLayerå»æ‰ï¼Œåªæ˜¯ä¸ºäº†ç›´è§‚çš„çœ‹åˆ°åŠ¨ç”»æ•ˆæœ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">-(void)startAnimate:(CGPoint)centerPoint</div><div class="line">&#123;</div><div class="line">    //èµ·ç‚¹</div><div class="line">    CGPoint startPoint = [self.tableview convertPoint:centerPoint toView:self.view];;</div><div class="line">    CGPoint endpoint = self.shopView.center;</div><div class="line">    //æ§ç‚¹</div><div class="line">    CGPoint controlPoint = CGPointMake(endpoint.x, startPoint.y);</div><div class="line">    </div><div class="line">    UIBezierPath *path = [UIBezierPath bezierPath];</div><div class="line">    [path moveToPoint:startPoint];</div><div class="line">    [path addQuadCurveToPoint:endpoint controlPoint:controlPoint];</div><div class="line">    </div><div class="line">    CAShapeLayer *layer =[CAShapeLayer layer];</div><div class="line">    layer.path = path.CGPath;</div><div class="line">    layer.fillColor = [UIColor clearColor].CGColor;</div><div class="line">    layer.strokeColor = [UIColor redColor].CGColor;</div><div class="line">    layer.lineWidth = 3.0f;</div><div class="line">    layer.shouldRasterize = YES;//æŠ—é”¯é½¿</div><div class="line">    [self.view.layer addSublayer:layer];</div><div class="line">    </div><div class="line">    //åˆ›å»ºå…³é”®å¸§</div><div class="line">    CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</div><div class="line">    </div><div class="line">    //åŠ¨ç”»æ—¶é—´</div><div class="line">    animation.duration = 1;</div><div class="line">    animation.path = path.CGPath</div><div class="line">    ;</div><div class="line">    //å½“åŠ¨ç”»å®Œæˆï¼Œåœç•™åˆ°ç»“æŸä½ç½®</div><div class="line">    animation.removedOnCompletion = YES;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">    </div><div class="line">    [self.shopView.layer addAnimation:animation forKey:nil];</div><div class="line">    path = nil;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿˜æ˜¯å°†åŠ¨ç”»æŠ½å–å‡ºæ¥ï¼Œåªéœ€è¦èµ·ç‚¹å’Œç»ˆç‚¹ä»¥åŠåŠ¨ç”»å®¿ä¸»è§†å›¾,å®ç°è§£è€¦ã€‚</p>
</blockquote>
<p>å®šä¹‰ä¸€ä¸ªNSObjectç±»ï¼Œæ¥å£å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">@interface AddToShopAnimation : NSObject</div><div class="line">-(instancetype)initWithStartPoint:(CGPoint)startPoint entPoint:(CGPoint)endPoint ViewController:(UIViewController *)viewController HostView:(UIView *)shopView;</div><div class="line">-(void)startAnimation;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">-(void)startAnimation</div><div class="line">&#123;</div><div class="line">    //èµ·ç‚¹</div><div class="line">    </div><div class="line">    //æ§ç‚¹</div><div class="line">    CGPoint controlPoint = CGPointMake(_endPoint.x, _startPoint.y);</div><div class="line">    </div><div class="line">    UIBezierPath *path = [UIBezierPath bezierPath];</div><div class="line">    [path moveToPoint:_startPoint];</div><div class="line">    [path addQuadCurveToPoint:_endPoint controlPoint:controlPoint];</div><div class="line">    </div><div class="line">    CAShapeLayer *layer =[CAShapeLayer layer];</div><div class="line">    layer.path = path.CGPath;</div><div class="line">    layer.fillColor = [UIColor clearColor].CGColor;</div><div class="line">    layer.strokeColor = [UIColor redColor].CGColor;</div><div class="line">    layer.lineWidth = 3.0f;</div><div class="line">    layer.shouldRasterize = YES;//æŠ—é”¯é½¿</div><div class="line">    [_viewController.view.layer addSublayer:layer];</div><div class="line">    </div><div class="line">    //åˆ›å»ºå…³é”®å¸§</div><div class="line">    CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</div><div class="line">    </div><div class="line">    //åŠ¨ç”»æ—¶é—´</div><div class="line">    animation.duration = 1;</div><div class="line">    animation.path = path.CGPath</div><div class="line">    ;</div><div class="line">    //å½“åŠ¨ç”»å®Œæˆï¼Œåœç•™åˆ°ç»“æŸä½ç½®</div><div class="line">    animation.removedOnCompletion = YES;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">    [_shopView.layer addAnimation:animation forKey:nil];</div><div class="line">    path = nil;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>demoåœ°å€ï¼š<a href="https://github.com/liuxinixn/UIBezierPathAddtoShop" target="_blank" rel="noopener">è´å¡å°”æ›²çº¿ä¹‹åŠ å…¥è´­ç‰©è½¦</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/06/ios-ä¸¤ç§æ–¹å¼æ‰©å¤§buttonç‚¹å‡»èŒƒå›´/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/06/ios-ä¸¤ç§æ–¹å¼æ‰©å¤§buttonç‚¹å‡»èŒƒå›´/" itemprop="url">iOS -ä¸¤ç§æ–¹å¼æ‰©å¤§buttonçš„ç‚¹å‡»èŒƒå›´</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-06T20:19:35+08:00">
                2016-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>UIç»™çš„å›¾æœ‰æ—¶å€™å¾ˆå°ï¼Œæˆ–è€…æœ‰ä¸ªéœ€æ±‚éœ€è¦æˆ‘ä»¬æ‰©å¤§buttonçš„ç‚¹å‡»åŒºåŸŸï¼Œ æˆ‘ä»¬ä¸€èˆ¬çš„æ“ä½œæ˜¯åœ¨button ä¸Šæ·»åŠ ä¸€ä¸ªview å¢åŠ ç‚¹å‡»äº‹ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰å…¶ä»–æ›´æ–¹ä¾¿çš„æ–¹æ³•å»æ‰©å¤§button çš„ç‚¹å‡»åŒºåŸŸã€‚æœ‰éœ€è¦å¯ä»¥äº†è§£ä¸‹äº‹ä»¶çš„åˆ†å‘æœºåˆ¶ã€‚<br>æœ‰ä¸¤ç§æ–¹å¼æ‰©å¤§button çš„ç‚¹å‡»åŒºåŸŸï¼š</p>
<blockquote>
<p>ç¬¬ä¸€ç§ï¼šé‡å†™æ–¹æ³•     -(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent*)event</p>
</blockquote>
<p>ç»§æ‰¿ä¸UIButtonï¼Œå®ç°å¦‚ä¸‹æ•ˆæœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent*)event</div><div class="line">&#123;</div><div class="line">    CGRect bounds = self.bounds;</div><div class="line">    //æ‰©å¤§åŸçƒ­åŒºç›´å¾„è‡³26ï¼Œå¯ä»¥æš´éœ²ä¸ªæ¥å£ï¼Œç”¨æ¥è®¾ç½®éœ€è¦æ‰©å¤§çš„åŠå¾„ã€‚</div><div class="line">    CGFloat widthDelta = MAX(26, 0);</div><div class="line">    CGFloat heightDelta = MAX(26, 0);</div><div class="line">    bounds = CGRectInset(bounds, -0.5 * widthDelta, -0.5 * heightDelta);</div><div class="line">    return CGRectContainsPoint(bounds, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>ç¬¬äºŒç§ï¼š é‡å†™æ–¹æ³•  - (UIView <em>)hitTest:(CGPoint)point withEvent:(UIEvent </em>)event</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event</div><div class="line">&#123;</div><div class="line">    CGRect rectBig = CGRectInset(self.bounds, -(27.0/2), -(27.0/2));</div><div class="line">    </div><div class="line">    if (CGRectContainsPoint(rectBig, point)) &#123;</div><div class="line">        return self;</div><div class="line">    &#125;else&#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>######å…¶å®æˆ‘ä»¬ä¸Šé¢æ‰€åšçš„å˜åŒ–å…¶å®å¦‚æœä»”ç»†çœ‹ç‚¹å‡»åŒºåŸŸè¿˜æ˜¯ä¸ªçŸ©å½¢ï¼Œå¦‚æœéœ€è¦æˆ‘ä»¬å°†ç‚¹å‡»åŒºåŸŸè§„å®šåœ¨åœ†å½¢èŒƒå›´ å†…ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</div><div class="line">    [super hitTest:point withEvent:event];</div><div class="line">    </div><div class="line">    CGPoint center = CGPointMake(self.bounds.size.width/2, self.bounds.size.height/2);</div><div class="line">    </div><div class="line">    </div><div class="line">   //å½“ç„¶è¿™ä¸ªåŠå¾„ä¹Ÿå¯ä»¥æ‰©å¤§</div><div class="line">    CGFloat raidus = self.frame.size.height &gt;= self.frame.size.width ?self.frame.size.width/2 :self.frame.size.width/2;</div><div class="line">    </div><div class="line">   //ä¼ å…¥ä¸­å¿ƒç‚¹ å®æ—¶ç‚¹å‡»ç‚¹ ä¸åŠå¾„åˆ¤æ–­ ç‚¹å‡»ç‚¹æ˜¯å¦åœ¨åŠå¾„åŒºåŸŸå†…</div><div class="line">    BOOL pointInRound =[self touchPointInsideCircle:center radius:raidus targetPoint:point];</div><div class="line">    </div><div class="line">    if (pointInRound) &#123;</div><div class="line">        return self;</div><div class="line">    &#125;else</div><div class="line">    &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//ç”¨æ¥åˆ¤æ–­ åœ†å½¢ç‚¹å‡»åŒºåŸŸ</div><div class="line">- (BOOL)touchPointInsideCircle:(CGPoint)center radius:(CGFloat)radius targetPoint:(CGPoint)point</div><div class="line">&#123;</div><div class="line">    CGFloat dist = sqrtf((point.x - center.x) * (point.x - center.x) +</div><div class="line">                         (point.y - center.y) * (point.y - center.y));</div><div class="line">    return (dist &lt;= radius);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/05/CoreAnimationå›¾å±‚å‡ ä½•å­¦/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/05/CoreAnimationå›¾å±‚å‡ ä½•å­¦/" itemprop="url">CoreAnimationå›¾å±‚å‡ ä½•å­¦</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-05T20:19:35+08:00">
                2016-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨ç¬¬äºŒç« é‡Œé¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†å›¾å±‚èƒŒåçš„å›¾ç‰‡ï¼Œå’Œä¸€äº›æ§åˆ¶å›¾å±‚åæ ‡å’Œæ—‹è½¬çš„å±æ€§ã€‚åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è¦çœ‹ä¸€çœ‹å›¾å±‚å†…éƒ¨æ˜¯å¦‚ä½•æ ¹æ®çˆ¶å›¾å±‚å’Œå…„å¼Ÿå›¾å±‚æ¥æ§åˆ¶ä½ç½®å’Œå°ºå¯¸çš„ã€‚å¦å¤–æˆ‘ä»¬ä¹Ÿä¼šæ¶‰åŠå¦‚ä½•ç®¡ç†å›¾å±‚çš„å‡ ä½•ç»“æ„ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•è¢«è‡ªåŠ¨è°ƒæ•´å’Œè‡ªåŠ¨å¸ƒå±€å½±å“çš„ã€‚</p>
<ul>
<li>####<strong>å¸ƒå±€</strong></li>
</ul>
<p> UIViewæœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å¸ƒå±€å±æ€§ï¼šframeï¼Œboundså’Œcenterï¼ŒCALayerå¯¹åº”åœ°å«åšframeï¼Œboundså’Œpositionã€‚ä¸ºäº†èƒ½æ¸…æ¥šåŒºåˆ†ï¼Œå›¾å±‚ç”¨äº†â€œpositionâ€ï¼Œè§†å›¾ç”¨äº†â€œcenterâ€ï¼Œä½†æ˜¯ä»–ä»¬éƒ½ä»£è¡¨åŒæ ·çš„å€¼ã€‚</p>
<p>frameä»£è¡¨äº†å›¾å±‚çš„å¤–éƒ¨åæ ‡ï¼ˆä¹Ÿå°±æ˜¯åœ¨çˆ¶å›¾å±‚ä¸Šå æ®çš„ç©ºé—´ï¼‰ï¼Œboundsæ˜¯å†…éƒ¨åæ ‡ï¼ˆ{0, 0}é€šå¸¸æ˜¯å›¾å±‚çš„å·¦ä¸Šè§’ï¼‰ï¼Œcenterå’Œpositionéƒ½ä»£è¡¨äº†ç›¸å¯¹äºçˆ¶å›¾å±‚anchorPointæ‰€åœ¨çš„ä½ç½®ã€‚anchorPointçš„å±æ€§å°†ä¼šåœ¨åç»­ä»‹ç»åˆ°ï¼Œç°åœ¨æŠŠå®ƒæƒ³æˆå›¾å±‚çš„ä¸­å¿ƒç‚¹å°±å¥½äº†ã€‚å›¾3.1æ˜¾ç¤ºäº†è¿™äº›å±æ€§æ˜¯å¦‚ä½•ç›¸äº’ä¾èµ–çš„ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-60c2a6313ce9cad9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.1.png"></p>
<p>è§†å›¾çš„frameï¼Œboundså’Œcenterå±æ€§ä»…ä»…æ˜¯å­˜å–æ–¹æ³•ï¼Œå½“æ“çºµè§†å›¾çš„frameï¼Œå®é™…ä¸Šæ˜¯åœ¨æ”¹å˜ä½äºè§†å›¾ä¸‹æ–¹CALayerçš„frame<br>ï¼Œä¸èƒ½å¤Ÿç‹¬ç«‹äºå›¾å±‚ä¹‹å¤–æ”¹å˜è§†å›¾çš„frameã€‚</p>
<p>å¯¹äºè§†å›¾æˆ–è€…å›¾å±‚æ¥è¯´ï¼Œframeå¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸æ¸…æ™°çš„å±æ€§ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªè™šæ‹Ÿå±æ€§ï¼Œæ˜¯æ ¹æ®boundsï¼Œpositionå’Œtransform<br>è®¡ç®—è€Œæ¥ï¼Œæ‰€ä»¥å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªå€¼å‘ç”Ÿæ”¹å˜ï¼Œframeéƒ½ä¼šå˜åŒ–ã€‚ç›¸åï¼Œæ”¹å˜frameçš„å€¼åŒæ ·ä¼šå½±å“åˆ°ä»–ä»¬å½“ä¸­çš„å€¼</p>
<p>è®°ä½å½“å¯¹å›¾å±‚åšå˜æ¢çš„æ—¶å€™ï¼Œæ¯”å¦‚æ—‹è½¬æˆ–è€…ç¼©æ”¾ï¼Œframeå®é™…ä¸Šä»£è¡¨äº†è¦†ç›–åœ¨å›¾å±‚æ—‹è½¬ä¹‹åçš„æ•´ä¸ªè½´å¯¹é½çš„çŸ©å½¢åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯è¯´frameçš„å®½é«˜å¯èƒ½å’Œboundsçš„å®½é«˜ä¸å†ä¸€è‡´äº†ï¼ˆå›¾3.2ï¼‰</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-962d369cf221fcfb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.2.png"></p>
<ul>
<li>####<strong>é”šç‚¹</strong></li>
</ul>
<p>ä¹‹å‰æåˆ°è¿‡ï¼Œè§†å›¾çš„centerå±æ€§å’Œå›¾å±‚çš„positionå±æ€§éƒ½æŒ‡å®šäº†anchorPointç›¸å¯¹äºçˆ¶å›¾å±‚çš„ä½ç½®ã€‚å›¾å±‚çš„anchorPointé€šè¿‡positionæ¥æ§åˆ¶å®ƒçš„frameçš„ä½ç½®ï¼Œä½ å¯ä»¥è®¤ä¸ºanchorPointæ˜¯ç”¨æ¥ç§»åŠ¨å›¾å±‚çš„æŠŠæŸ„ã€‚</p>
<p>é»˜è®¤æ¥è¯´ï¼ŒanchorPointä½äºå›¾å±‚çš„ä¸­ç‚¹ï¼Œæ‰€ä»¥å›¾å±‚çš„å°†ä¼šä»¥è¿™ä¸ªç‚¹ä¸ºä¸­å¿ƒæ”¾ç½®ã€‚anchorPointå±æ€§å¹¶æ²¡æœ‰è¢«UIViewæ¥å£æš´éœ²å‡ºæ¥ï¼Œè¿™ä¹Ÿæ˜¯è§†å›¾çš„positionå±æ€§è¢«å«åšâ€œcenterâ€çš„åŸå› ã€‚ä½†æ˜¯å›¾å±‚çš„anchorPointå¯ä»¥è¢«ç§»åŠ¨ï¼Œæ¯”å¦‚ä½ å¯ä»¥æŠŠå®ƒç½®äºå›¾å±‚frameçš„å·¦ä¸Šè§’ï¼Œäºæ˜¯å›¾å±‚çš„å†…å®¹å°†ä¼šå‘å³ä¸‹è§’çš„positionæ–¹å‘ç§»åŠ¨ï¼ˆå›¾3.3ï¼‰ï¼Œè€Œä¸æ˜¯å±…ä¸­äº†ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/1694376-7827e0f4aceeba78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.3.png"></p>
<p>å’Œç¬¬äºŒç« æåˆ°çš„contentsRectå’ŒcontentsCenterå±æ€§ç±»ä¼¼ï¼ŒanchorPointç”¨å•ä½åæ ‡æ¥æè¿°ï¼Œä¹Ÿå°±æ˜¯å›¾å±‚çš„ç›¸å¯¹åæ ‡ï¼Œå›¾å±‚å·¦ä¸Šè§’æ˜¯{0, 0}ï¼Œå³ä¸‹è§’æ˜¯{1, 1}ï¼Œå› æ­¤é»˜è®¤åæ ‡æ˜¯{0.5, 0.5}ã€‚anchorPointå¯ä»¥é€šè¿‡æŒ‡å®šxå’Œyå€¼å°äº0æˆ–è€…å¤§äº1ï¼Œä½¿å®ƒæ”¾ç½®åœ¨å›¾å±‚èŒƒå›´ä¹‹å¤–ã€‚</p>
<p>æ³¨æ„åœ¨å›¾3.3ä¸­ï¼Œå½“æ”¹å˜äº†anchorPointï¼Œpositionå±æ€§ä¿æŒå›ºå®šçš„å€¼å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯frameå´ç§»åŠ¨äº†ã€‚</p>
<p>é‚£åœ¨ä»€ä¹ˆåœºåˆéœ€è¦æ”¹å˜anchorPointå‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬å¯ä»¥éšæ„æ”¹å˜å›¾å±‚ä½ç½®ï¼Œé‚£æ”¹å˜anchorPointä¸ä¼šé€ æˆå›°æƒ‘ä¹ˆï¼Ÿä¸ºäº†ä¸¾ä¾‹è¯´æ˜ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªå®ç”¨çš„ä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿé—¹é’Ÿçš„é¡¹ç›®ã€‚</p>
<p>é’Ÿé¢å’Œé’Ÿè¡¨ç”±å››å¼ å›¾ç‰‡ç»„æˆï¼ˆå›¾3.4ï¼‰ï¼Œä¸ºäº†ç®€å•è¯´æ˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¥è£…è½½å’ŒåŠ è½½å›¾ç‰‡ï¼Œä½¿ç”¨å››ä¸ªUIImageView<br>å®ä¾‹ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨æ­£å¸¸çš„è§†å›¾ï¼Œè®¾ç½®ä»–ä»¬å›¾å±‚çš„contents<br>å›¾ç‰‡ï¼‰ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/1694376-2e8b159f0f65cc54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.4.png"></p>
<p> é—¹é’Ÿçš„ç»„ä»¶é€šè¿‡IBæ¥æ’åˆ—ï¼ˆå›¾3.5ï¼‰ï¼Œè¿™äº›å›¾ç‰‡è§†å›¾åµŒå¥—åœ¨ä¸€ä¸ªå®¹å™¨è§†å›¾ä¹‹å†…ï¼Œå¹¶ä¸”è‡ªåŠ¨è°ƒæ•´å’Œè‡ªåŠ¨å¸ƒå±€éƒ½è¢«ç¦ç”¨äº†ã€‚è¿™æ˜¯å› ä¸ºè‡ªåŠ¨è°ƒæ•´ä¼šå½±å“åˆ°è§†å›¾çš„frameï¼Œè€Œæ ¹æ®å›¾3.2çš„æ¼”ç¤ºï¼Œå½“è§†å›¾æ—‹è½¬çš„æ—¶å€™ï¼Œframeæ˜¯ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œè¿™å°†ä¼šå¯¼è‡´ä¸€äº›å¸ƒå±€ä¸Šçš„å¤±çµã€‚</p>
<p>æˆ‘ä»¬ç”¨NSTimeræ¥æ›´æ–°é—¹é’Ÿï¼Œä½¿ç”¨è§†å›¾çš„transformå±æ€§æ¥æ—‹è½¬é’Ÿè¡¨ï¼ˆå¦‚æœä½ å¯¹è¿™ä¸ªå±æ€§ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ç¬¬5ç« â€œå˜æ¢â€å½“ä¸­è¯¦ç»†è¯´æ˜ï¼‰ï¼Œå…·ä½“ä»£ç è§æ¸…å•3.1</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-0a145b572f694e7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.5.png"></p>
<p>#####æ¸…å•3.1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@property (nonatomic, weak) IBOutlet UIImageView *hourHand;</div><div class="line">@property (nonatomic, weak) IBOutlet UIImageView *minuteHand;</div><div class="line">@property (nonatomic, weak) IBOutlet UIImageView *secondHand;</div><div class="line">@property (nonatomic, weak) NSTimer *timer;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //start timer</div><div class="line">    self.timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(tick) userInfo:nil repeats:YES];</div><div class="line">    ï¿¼</div><div class="line">    //set initial hand positions</div><div class="line">    [self tick];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)tick</div><div class="line">&#123;</div><div class="line">    //convert time to hours, minutes and seconds</div><div class="line">    NSCalendar *calendar = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];</div><div class="line">    NSUInteger units = NSHourCalendarUnit | NSMinuteCalendarUnit | NSSecondCalendarUnit;</div><div class="line">    NSDateComponents *components = [calendar components:units fromDate:[NSDate date]];</div><div class="line">    CGFloat hoursAngle = (components.hour / 12.0) * M_PI * 2.0;</div><div class="line">    //calculate hour hand angle //calculate minute hand angle</div><div class="line">    CGFloat minsAngle = (components.minute / 60.0) * M_PI * 2.0;</div><div class="line">    //calculate second hand angle</div><div class="line">    CGFloat secsAngle = (components.second / 60.0) * M_PI * 2.0;</div><div class="line">    //rotate hands</div><div class="line">    self.hourHand.transform = CGAffineTransformMakeRotation(hoursAngle);</div><div class="line">    self.minuteHand.transform = CGAffineTransformMakeRotation(minsAngle);</div><div class="line">    self.secondHand.transform = CGAffineTransformMakeRotation(secsAngle);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œé¡¹ç›®ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼ˆå›¾3.6ï¼‰ï¼Œå› ä¸ºé’Ÿè¡¨çš„å›¾ç‰‡åœ¨å›´ç»•ç€ä¸­å¿ƒæ—‹è½¬ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸå¾…çš„ä¸€ä¸ªæ”¯ç‚¹ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/1694376-63fdc55a5c4ba280.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.6.png"><br> ä½ ä¹Ÿè®¸ä¼šè®¤ä¸ºå¯ä»¥åœ¨Interface Builderå½“ä¸­è°ƒæ•´æŒ‡é’ˆå›¾ç‰‡çš„ä½ç½®æ¥è§£å†³ï¼Œä½†å…¶å®å¹¶ä¸èƒ½è¾¾åˆ°ç›®çš„ï¼Œå› ä¸ºå¦‚æœä¸æ”¾åœ¨é’Ÿé¢ä¸­é—´çš„è¯ï¼ŒåŒæ ·ä¸èƒ½æ­£ç¡®çš„æ—‹è½¬ã€‚</p>
<p>ä¹Ÿè®¸åœ¨å›¾ç‰‡æœ«å°¾æ·»åŠ ä¸€ä¸ªé€æ˜ç©ºé—´ä¹Ÿæ˜¯ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½†è¿™æ ·ä¼šè®©å›¾ç‰‡å˜å¤§ï¼Œä¹Ÿä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œè¿™æ ·å¹¶ä¸ä¼˜é›…ã€‚</p>
<p>æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨anchorPointå±æ€§ï¼Œæˆ‘ä»¬æ¥åœ¨-viewDidLoadæ–¹æ³•ä¸­æ·»åŠ å‡ è¡Œä»£ç æ¥ç»™æ¯ä¸ªé’ŸæŒ‡é’ˆçš„anchorPointåšä¸€äº›å¹³ç§»ï¼ˆæ¸…å•3.2ï¼‰ï¼Œå›¾3.7æ˜¾ç¤ºäº†æ­£ç¡®çš„ç»“æœã€‚</p>
<p>#####æ¸…å•3.2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad];</div><div class="line">       // adjust anchor points</div><div class="line">       </div><div class="line">       self.secondHand.layer.anchorPoint = CGPointMake(0.5f, 0.9f);</div><div class="line">       self.minuteHand.layer.anchorPoint = CGPointMake(0.5f, 0.9f);</div><div class="line">       self.hourHand.layer.anchorPoint = CGPointMake(0.5f, 0.9f);</div><div class="line">       </div><div class="line">       </div><div class="line">       // start timer</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-73c01bb8b7088a5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.7.png"></p>
<ul>
<li>####<strong>åæ ‡ç³»</strong><br>å’Œè§†å›¾ä¸€æ ·ï¼Œå›¾å±‚åœ¨å›¾å±‚æ ‘å½“ä¸­ä¹Ÿæ˜¯ç›¸å¯¹äºçˆ¶å›¾å±‚æŒ‰å±‚çº§å…³ç³»æ”¾ç½®ï¼Œä¸€ä¸ªå›¾å±‚çš„positionä¾èµ–äºå®ƒçˆ¶å›¾å±‚çš„bounds<br>ï¼Œå¦‚æœçˆ¶å›¾å±‚å‘ç”Ÿäº†ç§»åŠ¨ï¼Œå®ƒçš„æ‰€æœ‰å­å›¾å±‚ä¹Ÿä¼šè·Ÿç€ç§»åŠ¨ã€‚</li>
</ul>
<p>è¿™æ ·å¯¹äºæ”¾ç½®å›¾å±‚ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œå› ä¸ºä½ å¯ä»¥é€šè¿‡ç§»åŠ¨æ ¹å›¾å±‚æ¥å°†å®ƒçš„å­å›¾å±‚ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥ç§»åŠ¨ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä½ éœ€è¦çŸ¥é“ä¸€ä¸ªå›¾å±‚çš„ç»å¯¹ä½ç½®ï¼Œæˆ–è€…æ˜¯ç›¸å¯¹äºå¦ä¸€ä¸ªå›¾å±‚çš„ä½ç½®ï¼Œè€Œä¸æ˜¯å®ƒå½“å‰çˆ¶å›¾å±‚çš„ä½ç½®ã€‚<br>CALayerç»™ä¸åŒåæ ‡ç³»ä¹‹é—´çš„å›¾å±‚è½¬æ¢æä¾›äº†ä¸€äº›å·¥å…·ç±»æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (CGPoint)convertPoint:(CGPoint)point fromLayer:(CALayer *)layer; </div><div class="line">- (CGPoint)convertPoint:(CGPoint)point toLayer:(CALayer *)layer; </div><div class="line">- (CGRect)convertRect:(CGRect)rect fromLayer:(CALayer *)layer;</div><div class="line">- (CGRect)convertRect:(CGRect)rect toLayer:(CALayer *)layer;</div></pre></td></tr></table></figure>
<p>è¿™äº›æ–¹æ³•å¯ä»¥æŠŠå®šä¹‰åœ¨ä¸€ä¸ªå›¾å±‚åæ ‡ç³»ä¸‹çš„ç‚¹æˆ–è€…çŸ©å½¢è½¬æ¢æˆå¦ä¸€ä¸ªå›¾å±‚åæ ‡ç³»ä¸‹çš„ç‚¹æˆ–è€…çŸ©å½¢</p>
<ul>
<li>####<strong>ç¿»è½¬çš„å‡ ä½•ç»“æ„</strong></li>
</ul>
<p>å¸¸è§„è¯´æ¥ï¼Œåœ¨<a href="http://lib.csdn.net/base/1" target="_blank" rel="noopener">iOS</a>ä¸Šï¼Œä¸€ä¸ªå›¾å±‚çš„positionä½äºçˆ¶å›¾å±‚çš„å·¦ä¸Šè§’ï¼Œä½†æ˜¯åœ¨Mac OSä¸Šï¼Œé€šå¸¸æ˜¯ä½äºå·¦ä¸‹è§’ã€‚Core Animationå¯ä»¥é€šè¿‡geometryFlippedå±æ€§æ¥é€‚é…è¿™ä¸¤ç§æƒ…å†µï¼Œå®ƒå†³å®šäº†ä¸€ä¸ªå›¾å±‚çš„åæ ‡æ˜¯å¦ç›¸å¯¹äºçˆ¶å›¾å±‚å‚ç›´ç¿»è½¬ï¼Œæ˜¯ä¸€ä¸ªBOOLç±»å‹ã€‚åœ¨iOSä¸Šé€šè¿‡è®¾ç½®å®ƒä¸ºYES,æ„å‘³ç€å®ƒçš„å­å›¾å±‚å°†ä¼šè¢«å‚ç›´ç¿»è½¬ï¼Œä¹Ÿå°±æ˜¯å°†ä¼šæ²¿ç€åº•éƒ¨æ’ç‰ˆè€Œä¸æ˜¯é€šå¸¸çš„é¡¶éƒ¨ï¼ˆå®ƒçš„æ‰€æœ‰å­å›¾å±‚ä¹ŸåŒç†ï¼Œé™¤éæŠŠå®ƒä»¬geometryFlipped<br>å±æ€§ä¹Ÿè®¾ä¸ºYESï¼‰ã€‚</p>
<ul>
<li>####<strong>Zåæ ‡è½´</strong></li>
</ul>
<p>å’ŒUIViewä¸¥æ ¼çš„äºŒç»´åæ ‡ç³»ä¸åŒï¼ŒCALayerå­˜åœ¨äºä¸€ä¸ªä¸‰ç»´ç©ºé—´å½“ä¸­ã€‚é™¤äº†æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡çš„positionå’ŒanchorPointå±æ€§ä¹‹å¤–ï¼ŒCALayerè¿˜æœ‰å¦å¤–ä¸¤ä¸ªå±æ€§ï¼ŒzPositionå’ŒanchorPointZ<br>ï¼ŒäºŒè€…éƒ½æ˜¯åœ¨Zè½´ä¸Šæè¿°å›¾å±‚ä½ç½®çš„æµ®ç‚¹ç±»å‹ã€‚</p>
<p>æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰æ›´æ·±çš„å±æ€§æ¥æè¿°ç”±å®½å’Œé«˜åšæˆçš„bounds<br>äº†ï¼Œå›¾å±‚æ˜¯ä¸€ä¸ªå®Œå…¨æ‰å¹³çš„å¯¹è±¡ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆç±»ä¼¼äºä¸€é¡µäºŒç»´çš„åšç¡¬çš„çº¸ç‰‡ï¼Œç”¨èƒ¶æ°´ç²˜æˆä¸€ä¸ªç©ºæ´ï¼Œå°±åƒä¸‰ç»´ç»“æ„çš„æŠ˜çº¸ä¸€æ ·ã€‚</p>
<p>zPositionå±æ€§åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å…¶å®å¹¶ä¸å¸¸ç”¨ã€‚åœ¨ç¬¬äº”ç« ï¼Œæˆ‘ä»¬å°†ä¼šæ¶‰åŠCATransform3Dï¼Œä½ ä¼šçŸ¥é“å¦‚ä½•åœ¨ä¸‰ç»´ç©ºé—´ç§»åŠ¨å’Œæ—‹è½¬å›¾å±‚ï¼Œé™¤äº†åšå˜æ¢ä¹‹å¤–ï¼ŒzPositionæœ€å®ç”¨çš„åŠŸèƒ½å°±æ˜¯æ”¹å˜å›¾å±‚çš„æ˜¾ç¤ºé¡ºåºäº†ã€‚</p>
<p>é€šå¸¸ï¼Œå›¾å±‚æ˜¯æ ¹æ®å®ƒä»¬å­å›¾å±‚çš„sublayers<br>å‡ºç°çš„é¡ºåºæ¥ç±»ç»˜åˆ¶çš„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç”»å®¶çš„<a href="http://lib.csdn.net/base/31" target="_blank" rel="noopener">ç®—æ³•</a>â€“å°±åƒä¸€ä¸ªç”»å®¶åœ¨å¢™ä¸Šä½œç”»â€“åè¢«ç»˜åˆ¶ä¸Šçš„å›¾å±‚å°†ä¼šé®ç›–ä½ä¹‹å‰çš„å›¾å±‚ï¼Œä½†æ˜¯é€šè¿‡å¢åŠ å›¾å±‚çš„zPositionï¼Œå°±å¯ä»¥æŠŠå›¾å±‚å‘ç›¸æœºæ–¹å‘å‰ç½®ï¼Œäºæ˜¯å®ƒå°±åœ¨æ‰€æœ‰å…¶ä»–å›¾å±‚çš„å‰é¢äº†ï¼ˆæˆ–è€…è‡³å°‘æ˜¯å°äºå®ƒçš„zPositionå€¼çš„å›¾å±‚çš„å‰é¢ï¼‰ã€‚</p>
<p>è¿™é‡Œæ‰€è°“çš„â€œç›¸æœºâ€å®é™…ä¸Šæ˜¯ç›¸å¯¹äºç”¨æˆ·æ˜¯è§†è§’ï¼Œè¿™é‡Œå’ŒiPhoneèƒŒåçš„å†…ç½®ç›¸æœºæ²¡ä»»ä½•å…³ç³»ã€‚</p>
<p>å›¾3.8æ˜¾ç¤ºäº†åœ¨Interface Builderå†…çš„ä¸€å¯¹è§†å›¾ï¼Œæ­£å¦‚ä½ æ‰€è§ï¼Œé¦–å…ˆå‡ºç°åœ¨è§†å›¾å±‚çº§ç»¿è‰²çš„è§†å›¾è¢«ç»˜åˆ¶åœ¨çº¢è‰²è§†å›¾çš„åé¢ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-68e4281dd52477ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.8.png"><br>æˆ‘ä»¬å¸Œæœ›åœ¨çœŸå®çš„åº”ç”¨ä¸­ä¹Ÿèƒ½æ˜¾ç¤ºå‡ºç»˜å›¾çš„é¡ºåºï¼ŒåŒæ ·åœ°ï¼Œå¦‚æœæˆ‘ä»¬æé«˜ç»¿è‰²è§†å›¾çš„zPositionï¼ˆæ¸…å•3.3ï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°é¡ºåºå°±åäº†ï¼ˆå›¾3.9ï¼‰ã€‚å…¶å®å¹¶ä¸éœ€è¦å¢åŠ å¤ªå¤šï¼Œè§†å›¾éƒ½éå¸¸åœ°è–„ï¼Œæ‰€ä»¥ç»™zPositionæé«˜ä¸€ä¸ªåƒç´ å°±å¯ä»¥è®©ç»¿è‰²è§†å›¾å‰ç½®ï¼Œå½“ç„¶0.1æˆ–è€…0.0001ä¹Ÿèƒ½å¤Ÿåšåˆ°ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™æ ·ï¼Œå› ä¸ºæµ®ç‚¹ç±»å‹å››èˆäº”å…¥çš„è®¡ç®—å¯èƒ½ä¼šé€ æˆä¸€äº›ä¸ä¾¿çš„éº»çƒ¦ã€‚</p>
<p>#####æ¸…å•3.3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">   </div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *greenView;</div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *redView;</div><div class="line">   </div><div class="line">   @end</div><div class="line">   </div><div class="line">   @implementation ViewController</div><div class="line">   </div><div class="line">   - (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad];</div><div class="line">       ï¿¼</div><div class="line">       //move the green view zPosition nearer to the camera</div><div class="line">       self.greenView.layer.zPosition = 1.0f;</div><div class="line">   &#125;</div><div class="line">   @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-e7ea5f6f69f43a5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.9ç»¿è‰²è§†å›¾è¢«ç»˜åˆ¶åœ¨çº¢è‰²è§†å›¾çš„å‰é¢.png"></p>
<ul>
<li>####<strong>Hit Testing</strong></li>
</ul>
<p> ç¬¬ä¸€ç« â€œå›¾å±‚æ ‘â€è¯å®äº†æœ€å¥½ä½¿ç”¨å›¾å±‚ç›¸å…³è§†å›¾ï¼Œè€Œä¸æ˜¯åˆ›å»ºç‹¬ç«‹çš„å›¾å±‚å…³ç³»ã€‚å…¶ä¸­ä¸€ä¸ªåŸå› å°±æ˜¯è¦å¤„ç†é¢å¤–å¤æ‚çš„è§¦æ‘¸äº‹ä»¶ã€‚</p>
<p>CALayerå¹¶ä¸å…³å¿ƒä»»ä½•å“åº”é“¾äº‹ä»¶ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶æˆ–è€…æ‰‹åŠ¿ã€‚ä½†æ˜¯å®ƒæœ‰ä¸€ç³»åˆ—çš„æ–¹æ³•å¸®ä½ å¤„ç†äº‹ä»¶ï¼š-containsPoint:å’Œ-hitTest:ã€‚</p>
<p>-containsPoint:æ¥å—ä¸€ä¸ªåœ¨æœ¬å›¾å±‚åæ ‡ç³»ä¸‹çš„CGPointï¼Œå¦‚æœè¿™ä¸ªç‚¹åœ¨å›¾å±‚frameèŒƒå›´å†…å°±è¿”å›YESã€‚å¦‚æ¸…å•3.4æ‰€ç¤ºç¬¬ä¸€ç« çš„é¡¹ç›®çš„å¦ä¸€ä¸ªåˆé€‚çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨-containsPoint:æ–¹æ³•æ¥åˆ¤æ–­åˆ°åº•æ˜¯ç™½è‰²è¿˜æ˜¯è“è‰²çš„å›¾å±‚è¢«è§¦æ‘¸äº† ï¼ˆå›¾3.10ï¼‰ã€‚è¿™éœ€è¦æŠŠè§¦æ‘¸åæ ‡è½¬æ¢æˆæ¯ä¸ªå›¾å±‚åæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œç»“æœå¾ˆä¸æ–¹ä¾¿ã€‚</p>
<p>#####æ¸…å•3.4 ä½¿ç”¨containsPointåˆ¤æ–­è¢«ç‚¹å‡»çš„å›¾å±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">   </div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *layerView;</div><div class="line">   @property (nonatomic, weak) CALayer *blueLayer;</div><div class="line">   </div><div class="line">   @end</div><div class="line">   </div><div class="line">   @implementation ViewController</div><div class="line">   </div><div class="line">   - (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad];</div><div class="line">       //create sublayer</div><div class="line">       self.blueLayer = [CALayer layer];</div><div class="line">       self.blueLayer.frame = CGRectMake(50.0f, 50.0f, 100.0f, 100.0f);</div><div class="line">       self.blueLayer.backgroundColor = [UIColor blueColor].CGColor;</div><div class="line">       //add it to our view</div><div class="line">       [self.layerView.layer addSublayer:self.blueLayer];</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   - (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</div><div class="line">   &#123;</div><div class="line">       //get touch position relative to main view</div><div class="line">       CGPoint point = [[touches anyObject] locationInView:self.view];</div><div class="line">       //convert point to the white layer&apos;s coordinates</div><div class="line">       point = [self.layerView.layer convertPoint:point fromLayer:self.view.layer];</div><div class="line">       //get layer using containsPoint:</div><div class="line">       if ([self.layerView.layer containsPoint:point]) &#123;</div><div class="line">           //convert point to blueLayerâ€™s coordinates</div><div class="line">           point = [self.blueLayer convertPoint:point fromLayer:self.layerView.layer];</div><div class="line">           if ([self.blueLayer containsPoint:point]) &#123;</div><div class="line">               [[[UIAlertView alloc] initWithTitle:@&quot;Inside Blue Layer&quot;</div><div class="line">                                           message:nil</div><div class="line">                                          delegate:nil</div><div class="line">                                 cancelButtonTitle:@&quot;OK&quot;</div><div class="line">                                 otherButtonTitles:nil] show];</div><div class="line">           &#125; else &#123;</div><div class="line">               [[[UIAlertView alloc] initWithTitle:@&quot;Inside White Layer&quot;</div><div class="line">                                           message:nil</div><div class="line">                                          delegate:nil</div><div class="line">                                 cancelButtonTitle:@&quot;OK&quot;</div><div class="line">                                 otherButtonTitles:nil] show];</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-71820c2c4fb8faac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.10ç‚¹å‡»å›¾å±‚è¢«æ­£ç¡®æ ‡è¯†.png"></p>
<p>-hitTest:æ–¹æ³•åŒæ ·æ¥å—ä¸€ä¸ªCGPointç±»å‹å‚æ•°ï¼Œè€Œä¸æ˜¯BOOLç±»å‹ï¼Œå®ƒè¿”å›å›¾å±‚æœ¬èº«ï¼Œæˆ–è€…åŒ…å«è¿™ä¸ªåæ ‡ç‚¹çš„å¶å­èŠ‚ç‚¹å›¾å±‚ã€‚è¿™æ„å‘³ç€ä¸å†éœ€è¦åƒä½¿ç”¨-containsPoint:é‚£æ ·ï¼Œäººå·¥åœ°åœ¨æ¯ä¸ªå­å›¾å±‚å˜æ¢æˆ–è€…æµ‹è¯•ç‚¹å‡»çš„åæ ‡ã€‚å¦‚æœè¿™ä¸ªç‚¹åœ¨æœ€å¤–é¢å›¾å±‚çš„èŒƒå›´ä¹‹å¤–ï¼Œåˆ™è¿”å›nilã€‚å…·ä½“ä½¿ç”¨-hitTest:æ–¹æ³•è¢«ç‚¹å‡»å›¾å±‚çš„ä»£ç å¦‚æ¸…å•3.5æ‰€ç¤ºã€‚</p>
<p>#####ä½¿ç”¨hitTeståˆ¤æ–­è¢«ç‚¹å‡»çš„å›¾å±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</div><div class="line">&#123;</div><div class="line">    //get touch position</div><div class="line">    CGPoint point = [[touches anyObject] locationInView:self.view];</div><div class="line">    //get touched layer</div><div class="line">    CALayer *layer = [self.layerView.layer hitTest:point];</div><div class="line">    //get layer using hitTest</div><div class="line">    if (layer == self.blueLayer) &#123;</div><div class="line">        [[[UIAlertView alloc] initWithTitle:@&quot;Inside Blue Layer&quot;</div><div class="line">                                    message:nil</div><div class="line">                                   delegate:nil</div><div class="line">                          cancelButtonTitle:@&quot;OK&quot;</div><div class="line">                          otherButtonTitles:nil] show];</div><div class="line">    &#125; else if (layer == self.layerView.layer) &#123;</div><div class="line">        [[[UIAlertView alloc] initWithTitle:@&quot;Inside White Layer&quot;</div><div class="line">                                    message:nil</div><div class="line">                                   delegate:nil</div><div class="line">                          cancelButtonTitle:@&quot;OK&quot;</div><div class="line">                          otherButtonTitles:nil] show];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> æ³¨æ„å½“è°ƒç”¨å›¾å±‚çš„-hitTest:æ–¹æ³•æ—¶ï¼Œæµ‹ç®—çš„é¡ºåºä¸¥æ ¼ä¾èµ–äºå›¾å±‚æ ‘å½“ä¸­çš„å›¾å±‚é¡ºåºï¼ˆå’ŒUIViewå¤„ç†äº‹ä»¶ç±»ä¼¼ï¼‰ã€‚ä¹‹å‰æåˆ°çš„zPositionå±æ€§å¯ä»¥æ˜æ˜¾æ”¹å˜å±å¹•ä¸Šå›¾å±‚çš„é¡ºåºï¼Œä½†ä¸èƒ½æ”¹å˜äº‹ä»¶ä¼ é€’çš„é¡ºåºã€‚</p>
<p>è¿™æ„å‘³ç€å¦‚æœæ”¹å˜äº†å›¾å±‚çš„zè½´é¡ºåºï¼Œä½ ä¼šå‘ç°å°†ä¸èƒ½å¤Ÿæ£€æµ‹åˆ°æœ€å‰æ–¹çš„è§†å›¾ç‚¹å‡»äº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºè¢«å¦ä¸€ä¸ªå›¾å±‚é®ç›–ä½äº†ï¼Œè™½ç„¶å®ƒçš„zPositionå€¼è¾ƒå°ï¼Œä½†æ˜¯åœ¨å›¾å±‚æ ‘ä¸­çš„é¡ºåºé å‰ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬äº”ç« è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p>
<ul>
<li>####<strong>è‡ªåŠ¨å¸ƒå±€å±æ€§</strong></li>
</ul>
<p>ä½ å¯èƒ½ç”¨è¿‡UIViewAutoresizingMaskç±»å‹çš„ä¸€äº›å¸¸é‡ï¼Œåº”ç”¨äºå½“çˆ¶è§†å›¾æ”¹å˜å°ºå¯¸çš„æ—¶å€™ï¼Œç›¸åº”UIViewçš„frameä¹Ÿè·Ÿç€æ›´æ–°çš„åœºæ™¯ï¼ˆé€šå¸¸ç”¨äºæ¨ªç«–å±åˆ‡æ¢ï¼‰ã€‚</p>
<p>åœ¨iOS6ä¸­ï¼Œè‹¹æœä»‹ç»äº†è‡ªåŠ¨æ’ç‰ˆæœºåˆ¶ï¼Œå®ƒå’Œè‡ªåŠ¨è°ƒæ•´ä¸åŒï¼Œå¹¶ä¸”æ›´åŠ å¤æ‚ã€‚åœ¨Mac OSå¹³å°ï¼ŒCALayeræœ‰ä¸€ä¸ªå«åšlayoutManagerçš„å±æ€§å¯ä»¥é€šè¿‡CALayoutManageråè®®å’ŒCAConstraintLayoutManagerç±»æ¥å®ç°è‡ªåŠ¨æ’ç‰ˆçš„æœºåˆ¶ã€‚ä½†ç”±äºæŸäº›åŸå› ï¼Œè¿™åœ¨iOSä¸Šå¹¶ä¸é€‚ç”¨ã€‚</p>
<p>å½“ä½¿ç”¨è§†å›¾çš„æ—¶å€™ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨UIViewç±»æ¥å£æš´éœ²å‡ºæ¥çš„UIViewAutoresizingMaskå’ŒNSLayoutConstraintAPIï¼Œä½†å¦‚æœæƒ³éšæ„æ§åˆ¶CALayerçš„å¸ƒå±€ï¼Œå°±éœ€è¦æ‰‹å·¥æ“ä½œã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨CALayerDelegateå¦‚ä¸‹å‡½æ•°ï¼š<br><code>- (void)layoutSublayersOfLayer:(CALayer *)layer;</code></p>
<p>#####æ€»ç»“<br> æœ¬ç« æ¶‰åŠäº†CALayerçš„é›†åˆç»“æ„ï¼ŒåŒ…æ‹¬å®ƒçš„frameï¼Œpositionå’Œboundsï¼Œä»‹ç»äº†ä¸‰ç»´ç©ºé—´å†…å›¾å±‚çš„æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•åœ¨ç‹¬ç«‹çš„å›¾å±‚å†…å“åº”äº‹ä»¶ï¼Œæœ€åç®€å•è¯´æ˜äº†åœ¨iOSå¹³å°ï¼ŒCore Animationå¯¹è‡ªåŠ¨è°ƒæ•´å’Œè‡ªåŠ¨å¸ƒå±€æ”¯æŒçš„ç¼ºä¹ã€‚</p>
<p>åœ¨ç¬¬å››ç« â€œè§†è§‰æ•ˆæœâ€å½“ä¸­ï¼Œæˆ‘ä»¬æ¥ç€ä»‹ç»ä¸€äº›å›¾å±‚å¤–è¡¨çš„ç‰¹æ€§ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/04/CoreAnimationè§†è§‰æ•ˆæœ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/04/CoreAnimationè§†è§‰æ•ˆæœ/" itemprop="url">CoreAnimationè§†è§‰æ•ˆæœ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-04T20:19:35+08:00">
                2016-05-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>å—¯ï¼Œåœ†å’Œæ¤­åœ†è¿˜ä¸é”™ï¼Œä½†å¦‚æœæ˜¯å¸¦åœ†è§’çš„çŸ©å½¢å‘¢<br>æˆ‘ä»¬ç°åœ¨èƒ½åšåˆ°é‚£æ ·äº†ä¹ˆï¼Ÿ<br>å²è’‚èŠ¬Â·ä¹”å¸ƒæ–¯</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ç¬¬ä¸‰ç« ã€å›¾å±‚å‡ ä½•å­¦ã€ä¸­è®¨è®ºäº†å›¾å±‚çš„frameï¼Œç¬¬äºŒç« ã€å¯„å®¿å›¾ã€åˆ™è®¨è®ºäº†å›¾å±‚çš„å¯„å®¿å›¾ã€‚ä½†æ˜¯å›¾å±‚ä¸ä»…ä»…å¯ä»¥æ˜¯å›¾ç‰‡æˆ–æ˜¯é¢œè‰²çš„å®¹å™¨ï¼›è¿˜æœ‰ä¸€ç³»åˆ—å†…å»ºçš„ç‰¹æ€§ä½¿å¾—åˆ›é€ ç¾ä¸½ä¼˜é›…çš„ä»¤äººæ·±åˆ»çš„ç•Œé¢å…ƒç´ æˆä¸ºå¯èƒ½ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¼šæ¢ç´¢ä¸€äº›èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨CALayerå±æ€§å®ç°çš„è§†è§‰æ•ˆæœã€‚</p>
<ul>
<li>####<strong>åœ†è§’</strong></li>
</ul>
<p>åœ†è§’çŸ©å½¢æ˜¯<a href="http://lib.csdn.net/base/1" target="_blank" rel="noopener">iOS</a>çš„ä¸€ä¸ªæ ‡å¿—æ€§å®¡ç¾ç‰¹æ€§ã€‚è¿™åœ¨iOSçš„æ¯ä¸€ä¸ªåœ°æ–¹éƒ½å¾—åˆ°äº†ä½“ç°ï¼Œä¸è®ºæ˜¯ä¸»å±å¹•å›¾æ ‡ï¼Œè¿˜æ˜¯è­¦å‘Šå¼¹æ¡†ï¼Œç”šè‡³æ˜¯æ–‡æœ¬æ¡†ã€‚æŒ‰ç…§è¿™æµè¡Œç¨‹åº¦ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºä¸€å®šæœ‰ä¸å€ŸåŠ©Photoshopå°±èƒ½è½»æ˜“åˆ›å»ºåœ†è§’ä¸¾è¡Œçš„æ–¹æ³•ã€‚æ­å–œä½ ï¼ŒçŒœå¯¹äº†ã€‚<br>CALayeræœ‰ä¸€ä¸ªå«åšconrnerRadiusçš„å±æ€§æ§åˆ¶ç€å›¾å±‚è§’çš„æ›²ç‡ã€‚å®ƒæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¸º0ï¼ˆä¸º0çš„æ—¶å€™å°±æ˜¯ç›´è§’ï¼‰ï¼Œä½†æ˜¯ä½ å¯ä»¥æŠŠå®ƒè®¾ç½®æˆä»»æ„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ›²ç‡å€¼åªå½±å“èƒŒæ™¯é¢œè‰²è€Œä¸å½±å“èƒŒæ™¯å›¾ç‰‡æˆ–æ˜¯å­å›¾å±‚ã€‚ä¸è¿‡ï¼Œå¦‚æœæŠŠmasksToBoundsè®¾ç½®æˆYESçš„è¯ï¼Œå›¾å±‚é‡Œé¢çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè¢«æˆªå–ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¥æ¼”ç¤ºè¿™ä¸ªæ•ˆæœã€‚åœ¨Interface Builderä¸­ï¼Œæˆ‘ä»¬æ”¾ç½®ä¸€äº›è§†å›¾ï¼Œä»–ä»¬æœ‰ä¸€äº›å­è§†å›¾ã€‚è€Œä¸”è¿™äº›å­è§†å›¾æœ‰ä¸€äº›è¶…å‡ºäº†è¾¹ç•Œï¼ˆå¦‚å›¾4.1ï¼‰ã€‚ä½ å¯èƒ½æ— æ³•çœ‹åˆ°ä»–ä»¬è¶…å‡ºäº†è¾¹ç•Œï¼Œå› ä¸ºåœ¨ç¼–è¾‘ç•Œé¢çš„æ—¶å€™ï¼Œè¶…å‡ºçš„éƒ¨åˆ†æ€»æ˜¯è¢«Interface Builderè£åˆ‡æ‰äº†ã€‚ä¸è¿‡ï¼Œä½ ç›¸ä¿¡æˆ‘å°±å¥½äº† :)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-07f645d5d7004552.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.1.png"></p>
<p>ç„¶ååœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®è§’çš„åŠå¾„ä¸º20ä¸ªç‚¹ï¼Œå¹¶è£å‰ªæ‰ç¬¬ä¸€ä¸ªè§†å›¾çš„è¶…å‡ºéƒ¨åˆ†ï¼ˆè§æ¸…å•4.1ï¼‰ã€‚æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œè¿™äº›å±æ€§éƒ½å¯ä»¥åœ¨Interface Builderçš„æ¢æµ‹æ¿ä¸­åˆ†åˆ«é€šè¿‡ã€ç”¨æˆ·å®šä¹‰è¿è¡Œæ—¶å±æ€§ã€å’Œå‹¾é€‰ã€è£å‰ªå­è§†å›¾ã€(Clip Subviews)é€‰æ‹©æ¡†æ¥ç›´æ¥è®¾ç½®å±æ€§çš„å€¼ã€‚ä¸è¿‡ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä»£ç èƒ½å¤Ÿè¡¨ç¤ºå¾—æ›´æ¸…æ¥šã€‚å›¾4.2æ˜¯è¿è¡Œä»£ç çš„ç»“æœ</p>
<p>#####æ¸…å•4.1 è®¾ç½®cornerRadiuså’ŒmasksToBounds<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">    </div><div class="line">    @property (nonatomic, weak) IBOutlet UIView *layerView1;</div><div class="line">    @property (nonatomic, weak) IBOutlet UIView *layerView2;</div><div class="line">    </div><div class="line">    @end</div><div class="line">    </div><div class="line">    @implementation ViewController</div><div class="line">    - (void)viewDidLoad</div><div class="line">    &#123;ï¿¼ï¿¼ï¿¼</div><div class="line">        [super viewDidLoad];</div><div class="line">        </div><div class="line">        //set the corner radius on our layers</div><div class="line">        self.layerView1.layer.cornerRadius = 20.0f;</div><div class="line">        self.layerView2.layer.cornerRadius = 20.0f;</div><div class="line">        </div><div class="line">        //enable clipping on the second layer</div><div class="line">        self.layerView2.layer.masksToBounds = YES;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-3a0579b2db95b743.png" alt="4.2.png"><br>å¦‚ä½ æ‰€è§ï¼Œå³è¾¹çš„å­è§†å›¾æ²¿è¾¹ç•Œè¢«è£å‰ªäº†ã€‚<br>å•ç‹¬æ§åˆ¶æ¯ä¸ªå±‚çš„åœ†è§’æ›²ç‡ä¹Ÿä¸æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœæƒ³åˆ›å»ºæœ‰äº›åœ†è§’æœ‰äº›ç›´è§’çš„å›¾å±‚æˆ–è§†å›¾æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸€äº›ä¸åŒçš„æ–¹æ³•ã€‚æ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªå›¾å±‚è’™æ¿ï¼ˆæœ¬ç« ç¨åä¼šè®²åˆ°ï¼‰æˆ–è€…CAShapeLayerï¼ˆè§ç¬¬å…­ç« ã€ä¸“ç”¨å›¾å±‚ã€ï¼‰ã€‚</p>
<ul>
<li>####<strong>å›¾å±‚è¾¹æ¡†</strong></li>
</ul>
<p> CALayerå¦å¤–ä¸¤ä¸ªéå¸¸æœ‰ç”¨å±æ€§å°±æ˜¯borderWidthå’ŒborderColorã€‚äºŒè€…å…±åŒå®šä¹‰äº†å›¾å±‚è¾¹çš„ç»˜åˆ¶æ ·å¼ã€‚è¿™æ¡çº¿ï¼ˆä¹Ÿè¢«ç§°ä½œstrokeï¼‰æ²¿ç€å›¾å±‚çš„boundsç»˜åˆ¶ï¼ŒåŒæ—¶ä¹ŸåŒ…å«å›¾å±‚çš„è§’ã€‚</p>
<p>borderWidthæ˜¯ä»¥ç‚¹ä¸ºå•ä½çš„å®šä¹‰è¾¹æ¡†ç²—ç»†çš„æµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¸º0.borderColorå®šä¹‰äº†è¾¹æ¡†çš„é¢œè‰²ï¼Œé»˜è®¤ä¸ºé»‘è‰²ã€‚</p>
<p>borderColoræ˜¯CGColorRefç±»å‹ï¼Œè€Œä¸æ˜¯UIColorï¼Œæ‰€ä»¥å®ƒä¸æ˜¯Cocoaçš„å†…ç½®å¯¹è±¡ã€‚ä¸è¿‡å‘¢ï¼Œä½ è‚¯å®šä¹Ÿæ¸…æ¥šå›¾å±‚å¼•ç”¨äº†borderColorï¼Œè™½ç„¶å±æ€§å£°æ˜å¹¶ä¸èƒ½è¯æ˜è¿™ä¸€ç‚¹ã€‚CGColorRefåœ¨å¼•ç”¨/é‡Šæ”¾æ—¶å€™çš„è¡Œä¸ºè¡¨ç°å¾—ä¸NSObjectæå…¶ç›¸ä¼¼ã€‚ä½†æ˜¯Objective-Cè¯­æ³•å¹¶ä¸æ”¯æŒè¿™ä¸€åšæ³•ï¼Œæ‰€ä»¥CGColorRefå±æ€§å³ä¾¿æ˜¯å¼ºå¼•ç”¨ä¹Ÿåªèƒ½é€šè¿‡assignå…³é”®å­—æ¥å£°æ˜ã€‚</p>
<p>è¾¹æ¡†æ˜¯ç»˜åˆ¶åœ¨å›¾å±‚è¾¹ç•Œé‡Œé¢çš„ï¼Œè€Œä¸”åœ¨æ‰€æœ‰å­å†…å®¹ä¹‹å‰ï¼Œä¹Ÿåœ¨å­å›¾å±‚ä¹‹å‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼ˆæ¸…å•4.2ï¼‰åŠ å…¥å›¾å±‚çš„è¾¹æ¡†ï¼Œä½ å°±èƒ½çœ‹åˆ°åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹äº†ï¼ˆå¦‚å›¾4.3ï¼‰.</p>
<p>#####æ¸…å•4.2 åŠ ä¸Šè¾¹æ¡†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line">   </div><div class="line">   - (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad];</div><div class="line">       </div><div class="line">       //set the corner radius on our layers</div><div class="line">       self.layerView1.layer.cornerRadius = 20.0f;</div><div class="line">       self.layerView2.layer.cornerRadius = 20.0f;</div><div class="line">       </div><div class="line">       //add a border to our layers</div><div class="line">       self.layerView1.layer.borderWidth = 5.0f;</div><div class="line">       self.layerView2.layer.borderWidth = 5.0f;</div><div class="line">       </div><div class="line">       //enable clipping on the second layer</div><div class="line">       self.layerView2.layer.masksToBounds = YES;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-c76368bfcc883724.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.3.png"><br>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°è¾¹æ¡†å¹¶ä¸ä¼šæŠŠå¯„å®¿å›¾æˆ–å­å›¾å±‚çš„å½¢çŠ¶è®¡ç®—è¿›æ¥ï¼Œå¦‚æœå›¾å±‚çš„å­å›¾å±‚è¶…è¿‡äº†è¾¹ç•Œï¼Œæˆ–è€…æ˜¯å¯„å®¿å›¾åœ¨é€æ˜åŒºåŸŸæœ‰ä¸€ä¸ªé€æ˜è’™æ¿ï¼Œè¾¹æ¡†ä»ç„¶ä¼šæ²¿ç€å›¾å±‚çš„è¾¹ç•Œç»˜åˆ¶å‡ºæ¥ï¼ˆå¦‚å›¾4.4ï¼‰.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-767f323d4a8bcdb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.4.png"></p>
<ul>
<li>####<strong>contentsScaleå±æ€§</strong></li>
</ul>
<p> iOSçš„å¦ä¸€ä¸ªå¸¸è§ç‰¹æ€§å‘¢ï¼Œå°±æ˜¯é˜´å½±ã€‚é˜´å½±å¾€å¾€å¯ä»¥è¾¾åˆ°å›¾å±‚æ·±åº¦æš—ç¤ºçš„æ•ˆæœã€‚ä¹Ÿèƒ½å¤Ÿç”¨æ¥å¼ºè°ƒæ­£åœ¨æ˜¾ç¤ºçš„å›¾å±‚å’Œä¼˜å…ˆçº§ï¼ˆæ¯”å¦‚è¯´ä¸€ä¸ªåœ¨å…¶ä»–è§†å›¾ä¹‹å‰çš„å¼¹å‡ºæ¡†ï¼‰ï¼Œä¸è¿‡æœ‰æ—¶å€™ä»–ä»¬åªæ˜¯å•çº¯çš„è£…é¥°ç›®çš„ã€‚</p>
<p>ç»™shadowOpacityå±æ€§ä¸€ä¸ªå¤§äºé»˜è®¤å€¼ï¼ˆä¹Ÿå°±æ˜¯0ï¼‰çš„å€¼ï¼Œé˜´å½±å°±å¯ä»¥æ˜¾ç¤ºåœ¨ä»»æ„å›¾å±‚ä¹‹ä¸‹ã€‚shadowOpacityæ˜¯ä¸€ä¸ªå¿…é¡»åœ¨0.0ï¼ˆä¸å¯è§ï¼‰å’Œ1.0ï¼ˆå®Œå…¨ä¸é€æ˜ï¼‰ä¹‹é—´çš„æµ®ç‚¹æ•°ã€‚å¦‚æœè®¾ç½®ä¸º1.0ï¼Œå°†ä¼šæ˜¾ç¤ºä¸€ä¸ªæœ‰è½»å¾®æ¨¡ç³Šçš„é»‘è‰²é˜´å½±ç¨å¾®åœ¨å›¾å±‚ä¹‹ä¸Šã€‚è‹¥è¦æ”¹åŠ¨é˜´å½±çš„è¡¨ç°ï¼Œä½ å¯ä»¥ä½¿ç”¨CALayerçš„å¦å¤–ä¸‰ä¸ªå±æ€§ï¼šshadowColorï¼ŒshadowOffsetå’ŒshadowRadiusã€‚</p>
<p>æ˜¾è€Œæ˜“è§ï¼ŒshadowColorå±æ€§æ§åˆ¶ç€é˜´å½±çš„é¢œè‰²ï¼Œå’ŒborderColorå’ŒbackgroundColorä¸€æ ·ï¼Œå®ƒçš„ç±»å‹ä¹Ÿæ˜¯CGColorRefã€‚é˜´å½±é»˜è®¤æ˜¯é»‘è‰²ï¼Œå¤§å¤šæ•°æ—¶å€™ä½ éœ€è¦çš„é˜´å½±ä¹Ÿæ˜¯é»‘è‰²çš„ï¼ˆå…¶ä»–é¢œè‰²çš„é˜´å½±çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ä¸€ç‚¹ç‚¹å¥‡æ€ªã€‚ã€‚ï¼‰ã€‚</p>
<p>shadowOffsetå±æ€§æ§åˆ¶ç€é˜´å½±çš„æ–¹å‘å’Œè·ç¦»ã€‚å®ƒæ˜¯ä¸€ä¸ªCGSizeçš„å€¼ï¼Œå®½åº¦æ§åˆ¶è¿™é˜´å½±æ¨ªå‘çš„ä½ç§»ï¼Œé«˜åº¦æ§åˆ¶ç€çºµå‘çš„ä½ç§»ã€‚shadowOffsetçš„é»˜è®¤å€¼æ˜¯ {0, -3}ï¼Œæ„å³é˜´å½±ç›¸å¯¹äºYè½´æœ‰3ä¸ªç‚¹çš„å‘ä¸Šä½ç§»ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦é»˜è®¤å‘ä¸Šçš„é˜´å½±å‘¢ï¼Ÿå°½ç®¡Core Animationæ˜¯ä»å›¾å±‚å¥—è£…æ¼”å˜è€Œæ¥ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ä¸ºiOSåˆ›å»ºçš„ç§æœ‰åŠ¨ç”»æ¡†æ¶ï¼‰ï¼Œä½†æ˜¯å‘¢ï¼Œå®ƒå´æ˜¯åœ¨Mac OSä¸Šé¢ä¸–çš„ï¼Œå‰é¢æœ‰æåˆ°ï¼ŒäºŒè€…çš„Yè½´æ˜¯é¢ å€’çš„ã€‚è¿™å°±å¯¼è‡´äº†é»˜è®¤çš„3ä¸ªç‚¹ä½ç§»çš„é˜´å½±æ˜¯å‘ä¸Šçš„ã€‚åœ¨Macä¸Šï¼ŒshadowOffsetçš„é»˜è®¤å€¼æ˜¯é˜´å½±å‘ä¸‹çš„ï¼Œè¿™æ ·ä½ å°±èƒ½ç†è§£ä¸ºä»€ä¹ˆiOSä¸Šçš„é˜´å½±æ–¹å‘æ˜¯å‘ä¸Šçš„äº†ï¼ˆå¦‚å›¾4.5ï¼‰.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-209274f1478b34a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.5.png"></p>
<p>è‹¹æœæ›´å€¾å‘äºç”¨æˆ·ç•Œé¢çš„é˜´å½±åº”è¯¥æ˜¯å‚ç›´å‘ä¸‹çš„ï¼Œæ‰€ä»¥åœ¨iOSæŠŠé˜´å½±å®½åº¦è®¾ä¸º0ï¼Œç„¶åé«˜åº¦è®¾ä¸ºä¸€ä¸ªæ­£å€¼ä¸å¤±ä¸ºä¸€ä¸ªåšæ³•ã€‚</p>
<p>shadowRadiuså±æ€§æ§åˆ¶ç€é˜´å½±çš„æ¨¡ç³Šåº¦ï¼Œå½“å®ƒçš„å€¼æ˜¯0çš„æ—¶å€™ï¼Œé˜´å½±å°±å’Œè§†å›¾ä¸€æ ·æœ‰ä¸€ä¸ªéå¸¸ç¡®å®šçš„è¾¹ç•Œçº¿ã€‚å½“å€¼è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œè¾¹ç•Œçº¿çœ‹ä¸Šå»å°±ä¼šè¶Šæ¥è¶Šæ¨¡ç³Šå’Œè‡ªç„¶ã€‚è‹¹æœè‡ªå®¶çš„åº”ç”¨è®¾è®¡æ›´åå‘äºè‡ªç„¶çš„é˜´å½±ï¼Œæ‰€ä»¥ä¸€ä¸ªéé›¶å€¼å†åˆé€‚ä¸è¿‡äº†ã€‚</p>
<p>é€šå¸¸æ¥è®²ï¼Œå¦‚æœä½ æƒ³è®©è§†å›¾æˆ–æ§ä»¶éå¸¸é†’ç›®ç‹¬ç«‹äºèƒŒæ™¯ä¹‹å¤–ï¼ˆæ¯”å¦‚å¼¹å‡ºæ¡†é®ç½©å±‚ï¼‰ï¼Œä½ å°±åº”è¯¥ç»™shadowRadius<br>è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ã€‚é˜´å½±è¶Šæ¨¡ç³Šï¼Œå›¾å±‚çš„æ·±åº¦çœ‹ä¸Šå»å°±ä¼šæ›´æ˜æ˜¾ï¼ˆå¦‚å›¾4.6ï¼‰.<br><img src="http://upload-images.jianshu.io/upload_images/1694376-be8052dd45ee1287.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.6.png"></p>
<ul>
<li>####<strong>é˜´å½±è£å‰ª</strong></li>
</ul>
<p>å’Œå›¾å±‚è¾¹æ¡†ä¸åŒï¼Œå›¾å±‚çš„é˜´å½±ç»§æ‰¿è‡ªå†…å®¹çš„å¤–å½¢ï¼Œè€Œä¸æ˜¯æ ¹æ®è¾¹ç•Œå’Œè§’åŠå¾„æ¥ç¡®å®šã€‚ä¸ºäº†è®¡ç®—å‡ºé˜´å½±çš„å½¢çŠ¶ï¼ŒCore Animationä¼šå°†å¯„å®¿å›¾ï¼ˆåŒ…æ‹¬å­è§†å›¾ï¼Œå¦‚æœæœ‰çš„è¯ï¼‰è€ƒè™‘åœ¨å†…ï¼Œç„¶åé€šè¿‡è¿™äº›æ¥å®Œç¾æ­é…å›¾å±‚å½¢çŠ¶ä»è€Œåˆ›å»ºä¸€ä¸ªé˜´å½±ï¼ˆè§å›¾4.7ï¼‰ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-55db4a5ddd630e6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.7.png"></p>
<p>å½“é˜´å½±å’Œè£å‰ªæ‰¯ä¸Šå…³ç³»çš„æ—¶å€™å°±æœ‰ä¸€ä¸ªå¤´ç–¼çš„é™åˆ¶ï¼šé˜´å½±é€šå¸¸å°±æ˜¯åœ¨Layerçš„è¾¹ç•Œä¹‹å¤–ï¼Œå¦‚æœä½ å¼€å¯äº†masksToBoundså±æ€§ï¼Œæ‰€æœ‰ä»å›¾å±‚ä¸­çªå‡ºæ¥çš„å†…å®¹éƒ½ä¼šè¢«æ‰å‰ªæ‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨æˆ‘ä»¬ä¹‹å‰çš„è¾¹æ¡†ç¤ºä¾‹é¡¹ç›®ä¸­å¢åŠ å›¾å±‚çš„é˜´å½±å±æ€§æ—¶ï¼Œä½ å°±ä¼šå‘ç°é—®é¢˜æ‰€åœ¨ï¼ˆè§å›¾4.8ï¼‰.<br><img src="http://upload-images.jianshu.io/upload_images/1694376-d6faa3736b29968d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.8.png"></p>
<p> ä»æŠ€æœ¯è§’åº¦æ¥è¯´ï¼Œè¿™ä¸ªç»“æœæ˜¯å¯ä»¥æ˜¯å¯ä»¥ç†è§£çš„ï¼Œä½†ç¡®å®åˆä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚å¦‚æœä½ æƒ³æ²¿ç€å†…å®¹è£åˆ‡ï¼Œä½ éœ€è¦ç”¨åˆ°ä¸¤ä¸ªå›¾å±‚ï¼šä¸€ä¸ªåªç”»é˜´å½±çš„ç©ºçš„å¤–å›¾å±‚ï¼Œå’Œä¸€ä¸ªç”¨masksToBoundsè£å‰ªå†…å®¹çš„å†…å›¾å±‚ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠä¹‹å‰é¡¹ç›®çš„å³è¾¹ç”¨å•ç‹¬çš„è§†å›¾æŠŠè£å‰ªçš„è§†å›¾åŒ…èµ·æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆå¦‚å›¾4.9ï¼‰.<br><img src="http://upload-images.jianshu.io/upload_images/1694376-4c8e77c6cf05751f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.9.png"></p>
<p>æˆ‘ä»¬åªæŠŠé˜´å½±ç”¨åœ¨æœ€å¤–å±‚çš„è§†å›¾ä¸Šï¼Œå†…å±‚è§†å›¾è¿›è¡Œè£å‰ªã€‚æ¸…å•4.3æ˜¯ä»£ç å®ç°ï¼Œå›¾4.10æ˜¯è¿è¡Œç»“æœã€‚</p>
<p>#####æ¸…å•4.3 ç”¨ä¸€ä¸ªé¢å¤–çš„è§†å›¾æ¥è§£å†³é˜´å½±è£åˆ‡çš„é—®é¢˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">   </div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *layerView1;</div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *layerView2;</div><div class="line">   @property (nonatomic, weak) IBOutlet UIView *shadowView;</div><div class="line">   </div><div class="line">   @end</div><div class="line">   </div><div class="line">   @implementation ViewController</div><div class="line">   ï¿¼</div><div class="line">   - (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad];</div><div class="line">       </div><div class="line">       //set the corner radius on our layers</div><div class="line">       self.layerView1.layer.cornerRadius = 20.0f;</div><div class="line">       self.layerView2.layer.cornerRadius = 20.0f;</div><div class="line">       </div><div class="line">       //add a border to our layers</div><div class="line">       self.layerView1.layer.borderWidth = 5.0f;</div><div class="line">       self.layerView2.layer.borderWidth = 5.0f;</div><div class="line">       </div><div class="line">       //add a shadow to layerView1</div><div class="line">       self.layerView1.layer.shadowOpacity = 0.5f;</div><div class="line">       self.layerView1.layer.shadowOffset = CGSizeMake(0.0f, 5.0f);</div><div class="line">       self.layerView1.layer.shadowRadius = 5.0f;</div><div class="line">       </div><div class="line">       //add same shadow to shadowView (not layerView2)</div><div class="line">       self.shadowView.layer.shadowOpacity = 0.5f;</div><div class="line">       self.shadowView.layer.shadowOffset = CGSizeMake(0.0f, 5.0f);</div><div class="line">       self.shadowView.layer.shadowRadius = 5.0f;</div><div class="line">       </div><div class="line">       //enable clipping on the second layer</div><div class="line">       self.layerView2.layer.masksToBounds = YES;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-fd2670824eb2870b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.10.png"></p>
<ul>
<li><p>####<strong>shadowPathå±æ€§</strong></p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“å›¾å±‚é˜´å½±å¹¶ä¸æ€»æ˜¯æ–¹çš„ï¼Œè€Œæ˜¯ä»å›¾å±‚å†…å®¹çš„å½¢çŠ¶ç»§æ‰¿è€Œæ¥ã€‚è¿™çœ‹ä¸Šå»ä¸é”™ï¼Œä½†æ˜¯å®æ—¶è®¡ç®—é˜´å½±ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—èµ„æºçš„ï¼Œå°¤å…¶æ˜¯å›¾å±‚æœ‰å¤šä¸ªå­å›¾å±‚ï¼Œæ¯ä¸ªå›¾å±‚è¿˜æœ‰ä¸€ä¸ªæœ‰é€æ˜æ•ˆæœçš„å¯„å®¿å›¾çš„æ—¶å€™ã€‚</p>
</li>
</ul>
<p>å¦‚æœä½ äº‹å…ˆçŸ¥é“ä½ çš„é˜´å½±å½¢çŠ¶ä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªshadowPathæ¥æé«˜æ€§èƒ½ã€‚shadowPathæ˜¯ä¸€ä¸ªCGPathRefç±»å‹ï¼ˆä¸€ä¸ªæŒ‡å‘CGPathçš„æŒ‡é’ˆï¼‰ã€‚CGPathæ˜¯ä¸€ä¸ªCore Graphicså¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä»»æ„çš„ä¸€ä¸ªçŸ¢é‡å›¾å½¢ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§å•ç‹¬äºå›¾å±‚å½¢çŠ¶ä¹‹å¤–æŒ‡å®šé˜´å½±çš„å½¢çŠ¶ã€‚</p>
<p>å›¾4.11 å±•ç¤ºäº†åŒä¸€å¯„å®¿å›¾çš„ä¸åŒé˜´å½±è®¾å®šã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å›¾å½¢å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒçš„é˜´å½±å¯ä»¥æ˜¯ä½ æƒ³è¦çš„ä»»ä½•å½¢çŠ¶ã€‚æ¸…å•4.4æ˜¯ä»£ç å®ç°ã€‚</p>
<p>#####æ¸…å•4.4 åˆ›å»ºç®€å•çš„é˜´å½±å½¢çŠ¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@property (nonatomic, weak) IBOutlet UIView *layerView1;</div><div class="line">@property (nonatomic, weak) IBOutlet UIView *layerView2;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    //enable layer shadows</div><div class="line">    self.layerView1.layer.shadowOpacity = 0.5f;</div><div class="line">    self.layerView2.layer.shadowOpacity = 0.5f;</div><div class="line">    </div><div class="line">    //create a square shadow</div><div class="line">    CGMutablePathRef squarePath = CGPathCreateMutable();</div><div class="line">    CGPathAddRect(squarePath, NULL, self.layerView1.bounds);</div><div class="line">    self.layerView1.layer.shadowPath = squarePath; CGPathRelease(squarePath);</div><div class="line">    </div><div class="line">    ï¿¼//create a circular shadow</div><div class="line">    CGMutablePathRef circlePath = CGPathCreateMutable();</div><div class="line">    CGPathAddEllipseInRect(circlePath, NULL, self.layerView2.bounds);</div><div class="line">    self.layerView2.layer.shadowPath = circlePath; CGPathRelease(circlePath);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-eb06f611b0a94d9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.11.png"></p>
<p>å¦‚æœæ˜¯ä¸€ä¸ªçŸ©å½¢æˆ–è€…æ˜¯åœ†ï¼Œç”¨CGPathä¼šç›¸å½“ç®€å•æ˜äº†ã€‚ä½†æ˜¯å¦‚æœæ˜¯æ›´åŠ å¤æ‚ä¸€ç‚¹çš„å›¾å½¢ï¼ŒUIBezierPathç±»ä¼šæ›´åˆé€‚ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”±UIKitæä¾›çš„åœ¨CGPathåŸºç¡€ä¸Šçš„Objective-CåŒ…è£…ç±»ã€‚</p>
<ul>
<li>####<strong>å›¾å±‚è’™æ¿</strong></li>
</ul>
<p> é€šè¿‡masksToBoundså±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ²¿è¾¹ç•Œè£å‰ªå›¾å½¢ï¼›é€šè¿‡cornerRadiuså±æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾å®šä¸€ä¸ªåœ†è§’ã€‚ä½†æ˜¯æœ‰æ—¶å€™ä½ å¸Œæœ›å±•ç°çš„å†…å®¹ä¸æ˜¯åœ¨ä¸€ä¸ªçŸ©å½¢æˆ–åœ†è§’çŸ©å½¢ã€‚æ¯”å¦‚ï¼Œä½ æƒ³å±•ç¤ºä¸€ä¸ªæœ‰æ˜Ÿå½¢æ¡†æ¶çš„å›¾ç‰‡ï¼Œåˆæˆ–è€…æƒ³è®©ä¸€äº›å¤å·æ–‡å­—æ…¢æ…¢æ¸å˜æˆèƒŒæ™¯è‰²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçªå…€çš„è¾¹ç•Œã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ª32ä½æœ‰alphaé€šé“çš„pngå›¾ç‰‡é€šå¸¸æ˜¯åˆ›å»ºä¸€ä¸ªæ— çŸ©å½¢è§†å›¾æœ€æ–¹ä¾¿çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç»™å®ƒæŒ‡å®šä¸€ä¸ªé€æ˜è’™æ¿æ¥å®ç°ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½è®©ä½ ä»¥ç¼–ç çš„æ–¹å¼åŠ¨æ€åœ°ç”Ÿæˆè’™æ¿ï¼Œä¹Ÿä¸èƒ½è®©å­å›¾å±‚æˆ–å­è§†å›¾è£å‰ªæˆåŒæ ·çš„å½¢çŠ¶ã€‚</p>
<p>CALayeræœ‰ä¸€ä¸ªå±æ€§å«åšmaskå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªå±æ€§æœ¬èº«å°±æ˜¯ä¸ªCALayerç±»å‹ï¼Œæœ‰å’Œå…¶ä»–å›¾å±‚ä¸€æ ·çš„ç»˜åˆ¶å’Œå¸ƒå±€å±æ€§ã€‚å®ƒç±»ä¼¼äºä¸€ä¸ªå­å›¾å±‚ï¼Œç›¸å¯¹äºçˆ¶å›¾å±‚ï¼ˆå³æ‹¥æœ‰è¯¥å±æ€§çš„å›¾å±‚ï¼‰å¸ƒå±€ï¼Œä½†æ˜¯å®ƒå´ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å­å›¾å±‚ã€‚ä¸åŒäºé‚£äº›ç»˜åˆ¶åœ¨çˆ¶å›¾å±‚ä¸­çš„å­å›¾å±‚ï¼Œmaskå›¾å±‚å®šä¹‰äº†çˆ¶å›¾å±‚çš„éƒ¨åˆ†å¯è§åŒºåŸŸã€‚</p>
<p>maskå›¾å±‚çš„Colorå±æ€§æ˜¯æ— å…³ç´§è¦çš„ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯å›¾å±‚çš„è½®å»“ã€‚maskå±æ€§å°±åƒæ˜¯ä¸€ä¸ªé¥¼å¹²åˆ‡å‰²æœºï¼Œmaskå›¾å±‚å®å¿ƒçš„éƒ¨åˆ†ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œå…¶ä»–çš„åˆ™ä¼šè¢«æŠ›å¼ƒã€‚ï¼ˆå¦‚å›¾4.12ï¼‰</p>
<p>å¦‚æœmaskå›¾å±‚æ¯”çˆ¶å›¾å±‚è¦å°ï¼Œåªæœ‰åœ¨maskå›¾å±‚é‡Œé¢çš„å†…å®¹æ‰æ˜¯å®ƒå…³å¿ƒçš„ï¼Œé™¤æ­¤ä»¥å¤–çš„ä¸€åˆ‡éƒ½ä¼šè¢«éšè—èµ·æ¥ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-15fab782b87c7c86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.12.png"><br>æˆ‘ä»¬å°†ä»£ç æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œé€šè¿‡å›¾å±‚çš„maskå±æ€§æ¥ä½œç”¨äºå›¾ç‰‡ä¹‹ä¸Šã€‚ä¸ºäº†ç®€ä¾¿ä¸€äº›ï¼Œæˆ‘ä»¬ç”¨Interface Builderæ¥åˆ›å»ºä¸€ä¸ªåŒ…å«UIImageViewçš„å›¾ç‰‡å›¾å±‚ã€‚è¿™æ ·æˆ‘ä»¬å°±åªè¦ä»£ç å®ç°è’™æ¿å›¾å±‚äº†ã€‚æ¸…å•4.5æ˜¯æœ€ç»ˆçš„ä»£ç ï¼Œå›¾4.13æ˜¯è¿è¡Œåçš„ç»“æœã€‚</p>
<p>#####æ¸…å•4.5 åº”ç”¨è’™æ¿å›¾å±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@property (nonatomic, weak) IBOutlet UIImageView *imageView;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    //create mask layer</div><div class="line">    CALayer *maskLayer = [CALayer layer];</div><div class="line">    maskLayer.frame = self.layerView.bounds;</div><div class="line">    UIImage *maskImage = [UIImage imageNamed:@&quot;Cone.png&quot;];</div><div class="line">    maskLayer.contents = (__bridge id)maskImage.CGImage;</div><div class="line">    </div><div class="line">    //apply mask to image layerï¿¼</div><div class="line">    self.imageView.layer.mask = maskLayer;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-260195fb443dc625.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.13.png"><br>CALayerè’™æ¿å›¾å±‚çœŸæ­£å‰å®³çš„åœ°æ–¹åœ¨äºè’™æ¿å›¾ä¸å±€é™äºé™æ€å›¾ã€‚ä»»ä½•æœ‰å›¾å±‚æ„æˆçš„éƒ½å¯ä»¥ä½œä¸ºmaskå±æ€§ï¼Œè¿™æ„å‘³ç€ä½ çš„è’™æ¿å¯ä»¥é€šè¿‡ä»£ç ç”šè‡³æ˜¯åŠ¨ç”»å®æ—¶ç”Ÿæˆã€‚</p>
<ul>
<li>####<strong>æ‹‰ä¼¸è¿‡æ»¤</strong></li>
</ul>
<p>æœ€åæˆ‘ä»¬å†æ¥è°ˆè°ˆminificationFilterå’ŒmagnificationFilter<br>å±æ€§ã€‚æ€»å¾—æ¥è®²ï¼Œå½“æˆ‘ä»¬è§†å›¾æ˜¾ç¤ºä¸€ä¸ªå›¾ç‰‡çš„æ—¶å€™ï¼Œéƒ½åº”è¯¥æ­£ç¡®åœ°æ˜¾ç¤ºè¿™ä¸ªå›¾ç‰‡ï¼ˆæ„å³ï¼šä»¥æ­£ç¡®çš„æ¯”ä¾‹å’Œæ­£ç¡®çš„1ï¼š1åƒç´ æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰ã€‚åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>èƒ½å¤Ÿæ˜¾ç¤ºæœ€å¥½çš„ç”»è´¨ï¼Œåƒç´ æ—¢æ²¡æœ‰è¢«å‹ç¼©ä¹Ÿæ²¡æœ‰è¢«æ‹‰ä¼¸ã€‚</li>
<li>èƒ½æ›´å¥½çš„ä½¿ç”¨å†…å­˜ï¼Œå› ä¸ºè¿™å°±æ˜¯æ‰€æœ‰ä½ è¦å­˜å‚¨çš„ä¸œè¥¿ã€‚</li>
<li>æœ€å¥½çš„æ€§èƒ½è¡¨ç°ï¼ŒCPUä¸éœ€è¦ä¸ºæ­¤é¢å¤–çš„è®¡ç®—ã€‚</li>
</ul>
<p>ä¸è¿‡æœ‰æ—¶å€™ï¼Œæ˜¾ç¤ºä¸€ä¸ªéçœŸå®å¤§å°çš„å›¾ç‰‡ç¡®å®æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚æ¯”å¦‚è¯´ä¸€ä¸ªå¤´åƒæˆ–æ˜¯å›¾ç‰‡çš„ç¼©ç•¥å›¾ï¼Œå†æ¯”å¦‚è¯´ä¸€ä¸ªå¯ä»¥è¢«æ‹–æ‹½å’Œä¼¸ç¼©çš„å¤§å›¾ã€‚è¿™äº›æƒ…å†µä¸‹ï¼Œä¸ºåŒä¸€å›¾ç‰‡çš„ä¸åŒå¤§å°å­˜å‚¨ä¸åŒçš„å›¾ç‰‡æ˜¾å¾—åˆä¸åˆ‡å®é™…ã€‚<br>å½“å›¾ç‰‡éœ€è¦æ˜¾ç¤ºä¸åŒçš„å¤§å°çš„æ—¶å€™ï¼Œæœ‰ä¸€ç§å«åšæ‹‰ä¼¸è¿‡æ»¤çš„<a href="http://lib.csdn.net/base/31" target="_blank" rel="noopener">ç®—æ³•</a>å°±èµ·åˆ°ä½œç”¨äº†ã€‚å®ƒä½œç”¨äºåŸå›¾çš„åƒç´ ä¸Šå¹¶æ ¹æ®éœ€è¦ç”Ÿæˆæ–°çš„åƒç´ æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚<br>äº‹å®ä¸Šï¼Œé‡ç»˜å›¾ç‰‡å¤§å°ä¹Ÿæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„é€šç”¨ç®—æ³•ã€‚è¿™å–å†³äºéœ€è¦æ‹‰ä¼¸çš„å†…å®¹ï¼Œæ”¾å¤§æˆ–æ˜¯ç¼©å°çš„éœ€æ±‚ç­‰è¿™äº›å› ç´ ã€‚CALayerä¸ºæ­¤æä¾›äº†ä¸‰ç§æ‹‰ä¼¸è¿‡æ»¤æ–¹æ³•ï¼Œä»–ä»¬æ˜¯ï¼š</p>
<ul>
<li>kCAFilterLinear</li>
<li>kCAFilterNearest</li>
<li>kCAFilterTrilinear</li>
</ul>
<p>minificationï¼ˆç¼©å°å›¾ç‰‡ï¼‰å’Œmagnificationï¼ˆæ”¾å¤§å›¾ç‰‡ï¼‰é»˜è®¤çš„è¿‡æ»¤å™¨éƒ½æ˜¯kCAFilterLinearï¼Œè¿™ä¸ªè¿‡æ»¤å™¨é‡‡ç”¨åŒçº¿æ€§æ»¤æ³¢ç®—æ³•ï¼Œå®ƒåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½è¡¨ç°è‰¯å¥½ã€‚åŒçº¿æ€§æ»¤æ³¢ç®—æ³•é€šè¿‡å¯¹å¤šä¸ªåƒç´ å–æ ·æœ€ç»ˆç”Ÿæˆæ–°çš„å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³æ»‘çš„è¡¨ç°ä¸é”™çš„æ‹‰ä¼¸ã€‚ä½†æ˜¯å½“æ”¾å¤§å€æ•°æ¯”è¾ƒå¤§çš„æ—¶å€™å›¾ç‰‡å°±æ¨¡ç³Šä¸æ¸…äº†ã€‚<br>kCAFilterTrilinearå’ŒkCAFilterLinearéå¸¸ç›¸ä¼¼ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹äºŒè€…éƒ½çœ‹ä¸å‡ºæ¥æœ‰ä»€ä¹ˆå·®åˆ«ã€‚ä½†æ˜¯ï¼Œè¾ƒåŒçº¿æ€§æ»¤æ³¢ç®—æ³•è€Œè¨€ï¼Œä¸‰çº¿æ€§æ»¤æ³¢ç®—æ³•å­˜å‚¨äº†å¤šä¸ªå¤§å°æƒ…å†µä¸‹çš„å›¾ç‰‡ï¼ˆä¹Ÿå«å¤šé‡è´´å›¾ï¼‰ï¼Œå¹¶ä¸‰ç»´å–æ ·ï¼ŒåŒæ—¶ç»“åˆå¤§å›¾å’Œå°å›¾çš„å­˜å‚¨è¿›è€Œå¾—åˆ°æœ€åçš„ç»“æœã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„åœ¨äºç®—æ³•èƒ½å¤Ÿä»ä¸€ç³»åˆ—å·²ç»æ¥è¿‘äºæœ€ç»ˆå¤§å°çš„å›¾ç‰‡ä¸­å¾—åˆ°æƒ³è¦çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´ä¸è¦å¯¹å¾ˆå¤šåƒç´ åŒæ­¥å–æ ·ã€‚è¿™ä¸ä»…æé«˜äº†æ€§èƒ½ï¼Œä¹Ÿé¿å…äº†å°æ¦‚ç‡å› èˆå…¥é”™è¯¯å¼•èµ·çš„å–æ ·å¤±çµçš„é—®é¢˜</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-627fcecfb98c98cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.14.png"></p>
<p>kCAFilterNearestæ˜¯ä¸€ç§æ¯”è¾ƒæ­¦æ–­çš„æ–¹æ³•ã€‚ä»åå­—ä¸éš¾çœ‹å‡ºï¼Œè¿™ä¸ªç®—æ³•ï¼ˆä¹Ÿå«æœ€è¿‘è¿‡æ»¤ï¼‰å°±æ˜¯å–æ ·æœ€è¿‘çš„å•åƒç´ ç‚¹è€Œä¸ç®¡å…¶ä»–çš„é¢œè‰²ã€‚è¿™æ ·åšéå¸¸å¿«ï¼Œä¹Ÿä¸ä¼šä½¿å›¾ç‰‡æ¨¡ç³Šã€‚ä½†æ˜¯ï¼Œæœ€æ˜æ˜¾çš„æ•ˆæœå°±æ˜¯ï¼Œä¼šä½¿å¾—å‹ç¼©å›¾ç‰‡æ›´ç³Ÿï¼Œå›¾ç‰‡æ”¾å¤§ä¹‹åä¹Ÿæ˜¾å¾—å—çŠ¶æˆ–æ˜¯é©¬èµ›å…‹ä¸¥é‡<br><img src="http://upload-images.jianshu.io/upload_images/1694376-14ccad89e4e169b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.15.png"></p>
<pre><code>å›¾4.15 å¯¹äºæ²¡æœ‰æ–œçº¿çš„å°å›¾æ¥è¯´ï¼Œæœ€è¿‘è¿‡æ»¤ç®—æ³•è¦å¥½å¾ˆå¤š
</code></pre><p> æ€»çš„æ¥è¯´ï¼Œå¯¹äºæ¯”è¾ƒå°çš„å›¾æˆ–è€…æ˜¯å·®å¼‚ç‰¹åˆ«æ˜æ˜¾ï¼Œæå°‘æ–œçº¿çš„å¤§å›¾ï¼Œæœ€è¿‘è¿‡æ»¤ç®—æ³•ä¼šä¿ç•™è¿™ç§å·®å¼‚æ˜æ˜¾çš„ç‰¹è´¨ä»¥å‘ˆç°æ›´å¥½çš„ç»“æœã€‚ä½†æ˜¯å¯¹äºå¤§å¤šæ•°çš„å›¾å°¤å…¶æ˜¯æœ‰å¾ˆå¤šæ–œçº¿æˆ–æ˜¯æ›²çº¿è½®å»“çš„å›¾ç‰‡æ¥è¯´ï¼Œæœ€è¿‘è¿‡æ»¤ç®—æ³•ä¼šå¯¼è‡´æ›´å·®çš„ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œçº¿æ€§è¿‡æ»¤ä¿ç•™äº†å½¢çŠ¶ï¼Œæœ€è¿‘è¿‡æ»¤åˆ™ä¿ç•™äº†åƒç´ çš„å·®å¼‚ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥å®éªŒä¸€ä¸‹ã€‚æˆ‘ä»¬å¯¹ç¬¬ä¸‰ç« çš„æ—¶é’Ÿé¡¹ç›®æ”¹åŠ¨ä¸€ä¸‹ï¼Œç”¨LCDé£æ ¼çš„æ•°å­—æ–¹å¼æ˜¾ç¤ºã€‚æˆ‘ä»¬ç”¨ç®€å•çš„åƒç´ å­—ä½“ï¼ˆä¸€ç§ç”¨åƒç´ æ„æˆå­—ç¬¦çš„å­—ä½“ï¼Œè€ŒéçŸ¢é‡å›¾å½¢ï¼‰åˆ›é€ æ•°å­—æ˜¾ç¤ºæ–¹å¼ï¼Œç”¨å›¾ç‰‡å­˜å‚¨èµ·æ¥ï¼Œè€Œä¸”ç”¨ç¬¬äºŒç« ä»‹ç»è¿‡çš„æ‹¼åˆæŠ€æœ¯æ¥æ˜¾ç¤ºï¼ˆå¦‚å›¾4.16ï¼‰ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-abd590ea7cc36114.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.16.png"></p>
<p>æˆ‘ä»¬åœ¨Interface Builderä¸­æ”¾ç½®äº†å…­ä¸ªè§†å›¾ï¼Œå°æ—¶ã€åˆ†é’Ÿã€ç§’é’Ÿå„ä¸¤ä¸ªï¼Œå›¾4.17æ˜¾ç¤ºäº†è¿™å…­ä¸ªè§†å›¾æ˜¯å¦‚ä½•åœ¨Interface Builderä¸­æ”¾ç½®çš„ã€‚å¦‚æœæ¯ä¸ªéƒ½ç”¨ä¸€ä¸ªæ·¡å‡ºçš„outletså¯¹è±¡å°±ä¼šæ˜¾å¾—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨äº†ä¸€ä¸ªIBOutletCollectionå¯¹è±¡æŠŠä»–ä»¬å’Œæ§åˆ¶å™¨è”ç³»èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»¥æ•°ç»„çš„æ–¹å¼è®¿é—®è§†å›¾äº†ã€‚æ¸…å•4.6æ˜¯ä»£ç å®ç°ã€‚</p>
<p>####æ¸…å•4.6 æ˜¾ç¤ºä¸€ä¸ªLCDé£æ ¼çš„æ—¶é’Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">   </div><div class="line">   @property (nonatomic, strong) IBOutletCollection(UIView) NSArray *digitViews;</div><div class="line">   @property (nonatomic, weak) NSTimer *timer;</div><div class="line">   ï¿¼ï¿¼</div><div class="line">   @end</div><div class="line">   </div><div class="line">   @implementation ViewController</div><div class="line">   </div><div class="line">   - (void)viewDidLoad</div><div class="line">   &#123;</div><div class="line">       [super viewDidLoad]; //get spritesheet image</div><div class="line">       UIImage *digits = [UIImage imageNamed:@&quot;Digits.png&quot;];</div><div class="line">       </div><div class="line">       //set up digit views</div><div class="line">       for (UIView *view in self.digitViews) &#123;</div><div class="line">           //set contents</div><div class="line">           view.layer.contents = (__bridge id)digits.CGImage;</div><div class="line">           view.layer.contentsRect = CGRectMake(0, 0, 0.1, 1.0);</div><div class="line">           view.layer.contentsGravity = kCAGravityResizeAspect;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       //start timer</div><div class="line">       self.timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(tick) userInfo:nil repeats:YES];</div><div class="line">       </div><div class="line">       //set initial clock time</div><div class="line">       [self tick];</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   - (void)setDigit:(NSInteger)digit forView:(UIView *)view</div><div class="line">   &#123;</div><div class="line">       //adjust contentsRect to select correct digit</div><div class="line">       view.layer.contentsRect = CGRectMake(digit * 0.1, 0, 0.1, 1.0);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   - (void)tick</div><div class="line">   &#123;</div><div class="line">       //convert time to hours, minutes and seconds</div><div class="line">       NSCalendar *calendar = [[NSCalendar alloc] initWithCalendarIdentifier: NSGregorianCalendar];</div><div class="line">       NSUInteger units = NSHourCalendarUnit | NSMinuteCalendarUnit | NSSecondCalendarUnit;</div><div class="line">       ï¿¼</div><div class="line">       NSDateComponents *components = [calendar components:units fromDate:[NSDate date]];</div><div class="line">       </div><div class="line">       //set hours</div><div class="line">       [self setDigit:components.hour / 10 forView:self.digitViews[0]];</div><div class="line">       [self setDigit:components.hour % 10 forView:self.digitViews[1]];</div><div class="line">       </div><div class="line">       //set minutes</div><div class="line">       [self setDigit:components.minute / 10 forView:self.digitViews[2]];</div><div class="line">       [self setDigit:components.minute % 10 forView:self.digitViews[3]];</div><div class="line">       </div><div class="line">       //set seconds</div><div class="line">       [self setDigit:components.second / 10 forView:self.digitViews[4]];</div><div class="line">       [self setDigit:components.second % 10 forView:self.digitViews[5]];</div><div class="line">   &#125;</div><div class="line">   @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-7dbef1a2760e625b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.18.png"></p>
<p>ä¸ºäº†èƒ½åƒå›¾4.19ä¸­é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦åœ¨forå¾ªç¯ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š<br><code>view.layer.magnificationFilter = kCAFilterNearest;</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-43f21dbace80a1a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.19.png"></p>
<ul>
<li>####<strong>ç»„é€æ˜</strong></li>
</ul>
<p> UIViewæœ‰ä¸€ä¸ªå«åšalphaçš„å±æ€§æ¥ç¡®å®šè§†å›¾çš„é€æ˜åº¦ã€‚CALayeræœ‰ä¸€ä¸ªç­‰åŒçš„å±æ€§å«åšopacityï¼Œè¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯å½±å“å­å±‚çº§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ç»™ä¸€ä¸ªå›¾å±‚è®¾ç½®äº†opacityå±æ€§ï¼Œé‚£å®ƒçš„å­å›¾å±‚éƒ½ä¼šå—æ­¤å½±å“ã€‚</p>
<p>iOSå¸¸è§çš„åšæ³•æ˜¯æŠŠä¸€ä¸ªç©ºé—´çš„alphaå€¼è®¾ç½®ä¸º0.5ï¼ˆ50%ï¼‰ä»¥ä½¿å…¶çœ‹ä¸Šå»å‘ˆç°ä¸ºä¸å¯ç”¨çŠ¶æ€ã€‚å¯¹äºç‹¬ç«‹çš„è§†å›¾æ¥è¯´è¿˜ä¸é”™ï¼Œä½†æ˜¯å½“ä¸€ä¸ªæ§ä»¶æœ‰å­è§†å›¾çš„æ—¶å€™å°±æœ‰ç‚¹å¥‡æ€ªäº†ï¼Œå›¾4.20å±•ç¤ºäº†ä¸€ä¸ªå†…åµŒäº†UILabelçš„è‡ªå®šä¹‰UIButtonï¼›å·¦è¾¹æ˜¯ä¸€ä¸ªä¸é€æ˜çš„æŒ‰é’®ï¼Œå³è¾¹æ˜¯50%é€æ˜åº¦çš„ç›¸åŒæŒ‰é’®ã€‚æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œé‡Œé¢çš„æ ‡ç­¾çš„è½®å»“è·ŸæŒ‰é’®çš„èƒŒæ™¯å¾ˆä¸æ­è°ƒã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-8828828bb87444dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.20.png"></p>
<p> è¿™æ˜¯ç”±é€æ˜åº¦çš„æ··åˆå åŠ é€ æˆçš„ï¼Œå½“ä½ æ˜¾ç¤ºä¸€ä¸ª50%é€æ˜åº¦çš„å›¾å±‚æ—¶ï¼Œå›¾å±‚çš„æ¯ä¸ªåƒç´ éƒ½ä¼šä¸€èˆ¬æ˜¾ç¤ºè‡ªå·±çš„é¢œè‰²ï¼Œå¦ä¸€åŠæ˜¾ç¤ºå›¾å±‚ä¸‹é¢çš„é¢œè‰²ã€‚è¿™æ˜¯æ­£å¸¸çš„é€æ˜åº¦çš„è¡¨ç°ã€‚ä½†æ˜¯å¦‚æœå›¾å±‚åŒ…å«ä¸€ä¸ªåŒæ ·æ˜¾ç¤º50%é€æ˜çš„å­å›¾å±‚æ—¶ï¼Œä½ æ‰€çœ‹åˆ°çš„è§†å›¾ï¼Œ50%æ¥è‡ªå­è§†å›¾ï¼Œ25%æ¥äº†å›¾å±‚æœ¬èº«çš„é¢œè‰²ï¼Œå¦å¤–çš„25%åˆ™æ¥è‡ªèƒŒæ™¯è‰²ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒæŒ‰é’®å’Œè¡¨æƒ…éƒ½æ˜¯ç™½è‰²èƒŒæ™¯ã€‚è™½ç„¶ä»–ä»¬éƒ½æ˜¯50%çš„å¯è§åº¦ï¼Œä½†æ˜¯åˆèµ·æ¥çš„å¯è§åº¦æ˜¯75%ï¼Œæ‰€ä»¥æ ‡ç­¾æ‰€åœ¨çš„åŒºåŸŸçœ‹ä¸Šå»å°±æ²¡æœ‰å‘¨å›´çš„éƒ¨åˆ†é‚£ä¹ˆé€æ˜ã€‚æ‰€ä»¥çœ‹ä¸Šå»å­è§†å›¾å°±é«˜äº®äº†ï¼Œä½¿å¾—è¿™ä¸ªæ˜¾ç¤ºæ•ˆæœéƒ½ç³Ÿé€äº†ã€‚</p>
<p>ç†æƒ³çŠ¶å†µä¸‹ï¼Œå½“ä½ è®¾ç½®äº†ä¸€ä¸ªå›¾å±‚çš„é€æ˜åº¦ï¼Œä½ å¸Œæœ›å®ƒåŒ…å«çš„æ•´ä¸ªå›¾å±‚æ ‘åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·çš„é€æ˜æ•ˆæœã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®Info.plistæ–‡ä»¶ä¸­çš„UIViewGroupOpacityä¸ºYESæ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œä½†æ˜¯è¿™ä¸ªè®¾ç½®ä¼šå½±å“åˆ°è¿™ä¸ªåº”ç”¨ï¼Œæ•´ä¸ªappå¯èƒ½ä¼šå—åˆ°ä¸è‰¯å½±å“ã€‚å¦‚æœUIViewGroupOpacityå¹¶æœªè®¾ç½®ï¼ŒiOS 6å’Œä»¥å‰çš„ç‰ˆæœ¬ä¼šé»˜è®¤ä¸ºNOï¼ˆä¹Ÿè®¸ä»¥åçš„ç‰ˆæœ¬ä¼šæœ‰ä¸€äº›æ”¹å˜ï¼‰ã€‚</p>
<p>å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ï¼Œä½ å¯ä»¥è®¾ç½®CALayerçš„ä¸€ä¸ªå«åšshouldRasterizeå±æ€§ï¼ˆè§æ¸…å•4.7ï¼‰æ¥å®ç°ç»„é€æ˜çš„æ•ˆæœï¼Œå¦‚æœå®ƒè¢«è®¾ç½®ä¸ºYESï¼Œåœ¨åº”ç”¨é€æ˜åº¦ä¹‹å‰ï¼Œå›¾å±‚åŠå…¶å­å›¾å±‚éƒ½ä¼šè¢«æ•´åˆæˆä¸€ä¸ªæ•´ä½“çš„å›¾ç‰‡ï¼Œè¿™æ ·å°±æ²¡æœ‰é€æ˜åº¦æ··åˆçš„é—®é¢˜äº†ï¼ˆå¦‚å›¾4.21ï¼‰ã€‚</p>
<p>ä¸ºäº†å¯ç”¨shouldRasterizeå±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®äº†å›¾å±‚çš„rasterizationScaleå±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å›¾å±‚æ‹‰ä¼¸éƒ½æ˜¯1.0ï¼Œ æ‰€ä»¥å¦‚æœä½ ä½¿ç”¨äº†shouldRasterizeå±æ€§ï¼Œä½ å°±è¦ç¡®ä¿ä½ è®¾ç½®äº†rasterizationScaleå±æ€§å»åŒ¹é…å±å¹•ï¼Œä»¥é˜²æ­¢å‡ºç°Retinaå±å¹•åƒç´ åŒ–çš„é—®é¢˜ã€‚</p>
<p>å½“shouldRasterizeå’ŒUIViewGroupOpacityä¸€èµ·çš„æ—¶å€™ï¼Œæ€§èƒ½é—®é¢˜å°±å‡ºç°äº†ï¼ˆæˆ‘ä»¬åœ¨ç¬¬12ç« ã€é€Ÿåº¦ã€å’Œç¬¬15ç« ã€å›¾å±‚æ€§èƒ½ã€å°†åšå‡ºä»‹ç»ï¼‰ï¼Œä½†æ˜¯æ€§èƒ½ç¢°æ’éƒ½æœ¬åœ°åŒ–äº†ï¼ˆè¯‘è€…æ³¨ï¼šè¿™å¥è¯éœ€è¦å†ç¿»è¯‘ï¼‰ã€‚</p>
<p>#####æ¸…å•4.7 ä½¿ç”¨shouldRasterizeå±æ€§è§£å†³ç»„é€æ˜é—®é¢˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">    @interface ViewController ()</div><div class="line">    @property (nonatomic, weak) IBOutlet UIView *containerView;</div><div class="line">    @end</div><div class="line">    </div><div class="line">    @implementation ViewController</div><div class="line">    </div><div class="line">    - (UIButton *)customButton</div><div class="line">    &#123;</div><div class="line">        //create button</div><div class="line">        CGRect frame = CGRectMake(0, 0, 150, 50);</div><div class="line">        UIButton *button = [[UIButton alloc] initWithFrame:frame];</div><div class="line">        button.backgroundColor = [UIColor whiteColor];</div><div class="line">        button.layer.cornerRadius = 10;</div><div class="line">        </div><div class="line">        //add label</div><div class="line">        frame = CGRectMake(20, 10, 110, 30);</div><div class="line">        UILabel *label = [[UILabel alloc] initWithFrame:frame];</div><div class="line">        label.text = @&quot;Hello World&quot;;</div><div class="line">        label.textAlignment = NSTextAlignmentCenter;</div><div class="line">        [button addSubview:label];</div><div class="line">        return button;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    - (void)viewDidLoad</div><div class="line">    &#123;</div><div class="line">        [super viewDidLoad];</div><div class="line">        </div><div class="line">        //create opaque button</div><div class="line">        UIButton *button1 = [self customButton];</div><div class="line">        button1.center = CGPointMake(50, 150);</div><div class="line">        [self.containerView addSubview:button1];</div><div class="line">        </div><div class="line">        //create translucent button</div><div class="line">        UIButton *button2 = [self customButton];</div><div class="line">        ï¿¼</div><div class="line">        button2.center = CGPointMake(250, 150);</div><div class="line">        button2.alpha = 0.5;</div><div class="line">        [self.containerView addSubview:button2];</div><div class="line">        </div><div class="line">        //enable rasterization for the translucent button</div><div class="line">        button2.layer.shouldRasterize = YES;</div><div class="line">        button2.layer.rasterizationScale = [UIScreen mainScreen].scale;</div><div class="line">    &#125;</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-006797526c30dcd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.21.png"></p>
<p>#####æ€»ç»“<br> è¿™ä¸€ç« ä»‹ç»äº†ä¸€äº›å¯ä»¥é€šè¿‡ä»£ç åº”ç”¨åˆ°å›¾å±‚ä¸Šçš„è§†è§‰æ•ˆæœï¼Œæ¯”å¦‚åœ†è§’ï¼Œé˜´å½±å’Œè’™æ¿ã€‚æˆ‘ä»¬ä¹Ÿäº†è§£äº†æ‹‰ä¼¸è¿‡æ»¤å™¨å’Œç»„é€æ˜ã€‚</p>
<p>åœ¨ç¬¬äº”ç« ï¼Œã€å˜æ¢ã€ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šç ”ç©¶å›¾å±‚å˜åŒ–å’Œ3Dè½¬æ¢ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/03/CoreAnimationæ¡†æ¶ç›®å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/03/CoreAnimationæ¡†æ¶ç›®å½•/" itemprop="url">CoreAnimationæ¡†æ¶ç›®å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-03T20:19:35+08:00">
                2016-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ç›®å½•çºµè§ˆ"><a href="#ç›®å½•çºµè§ˆ" class="headerlink" title="ç›®å½•çºµè§ˆ"></a>ç›®å½•çºµè§ˆ</h1><h4 id="ç¬¬ä¸€ç« ï¼šå›¾å±‚æ ‘"><a href="#ç¬¬ä¸€ç« ï¼šå›¾å±‚æ ‘" class="headerlink" title="ç¬¬ä¸€ç« ï¼šå›¾å±‚æ ‘"></a>ç¬¬ä¸€ç« ï¼šå›¾å±‚æ ‘</h4><ul>
<li>å›¾å±‚ä¸è§†å›¾</li>
<li>å›¾å±‚çš„èƒ½åŠ›</li>
<li>ä½¿ç”¨å›¾å±‚<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/8447e0c24df1" target="_blank" rel="noopener">å›¾å±‚æ ‘</a><h4 id="ç¬¬äºŒç« ï¼šå¯„å®¿å›¾"><a href="#ç¬¬äºŒç« ï¼šå¯„å®¿å›¾" class="headerlink" title="ç¬¬äºŒç« ï¼šå¯„å®¿å›¾"></a>ç¬¬äºŒç« ï¼šå¯„å®¿å›¾</h4></li>
<li>contentså±æ€§</li>
<li>Custom Drawing ï¼ˆè‡ªå®šä¹‰ç»˜åˆ¶ï¼‰<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/fea670e92e9e" target="_blank" rel="noopener">å¯„å®¿å›¾</a><h4 id="ç¬¬ä¸‰ç« ï¼šå›¾å±‚å‡ ä½•å­¦"><a href="#ç¬¬ä¸‰ç« ï¼šå›¾å±‚å‡ ä½•å­¦" class="headerlink" title="ç¬¬ä¸‰ç« ï¼šå›¾å±‚å‡ ä½•å­¦"></a>ç¬¬ä¸‰ç« ï¼šå›¾å±‚å‡ ä½•å­¦</h4></li>
<li>å¸ƒå±€</li>
<li><a href="http://www.jianshu.com/p/52dfc061ff7f" target="_blank" rel="noopener">é”šç‚¹</a></li>
<li>åæ ‡ç³»</li>
<li>Hit Testing</li>
<li>è‡ªåŠ¨å¸ƒå±€<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/ffee86d98d58" target="_blank" rel="noopener">å›¾å±‚å‡ ä½•å­¦</a><h4 id="ç¬¬äº”ç« ï¼šè§†è§‰æ•ˆæœ"><a href="#ç¬¬äº”ç« ï¼šè§†è§‰æ•ˆæœ" class="headerlink" title="ç¬¬äº”ç« ï¼šè§†è§‰æ•ˆæœ"></a>ç¬¬äº”ç« ï¼šè§†è§‰æ•ˆæœ</h4></li>
<li>åœ†è§’</li>
<li>å›¾å±‚è¾¹æ¡†</li>
<li>é˜´å½±</li>
<li><a href="http://www.jianshu.com/p/26e7803f057b" target="_blank" rel="noopener">å›¾å±‚è’™ç‰ˆ</a></li>
<li>æ‹‰ä¼¸è¿‡æ»¤</li>
<li>ç»„é€æ˜<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/b556af4a3c7d" target="_blank" rel="noopener">è§†è§‰æ•ˆæœ</a></li>
</ul>
<h4 id="ç¬¬äº”ç« ï¼šå˜æ¢"><a href="#ç¬¬äº”ç« ï¼šå˜æ¢" class="headerlink" title="ç¬¬äº”ç« ï¼šå˜æ¢"></a>ç¬¬äº”ç« ï¼šå˜æ¢</h4><ul>
<li>ä»¿å°„å˜æ¢</li>
<li>å›¾å±‚è¾¹æ¡†</li>
<li>3Då¯¹è±¡</li>
<li>å›ºä½“å¯¹è±¡<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/ff380a2658fa" target="_blank" rel="noopener">å˜æ¢</a><h4 id="ç¬¬å…­ç« ï¼šä¸“ç”¨å›¾å±‚"><a href="#ç¬¬å…­ç« ï¼šä¸“ç”¨å›¾å±‚" class="headerlink" title="ç¬¬å…­ç« ï¼šä¸“ç”¨å›¾å±‚"></a>ç¬¬å…­ç« ï¼šä¸“ç”¨å›¾å±‚</h4></li>
<li><a href="http://www.jianshu.com/p/16fd028ee636" target="_blank" rel="noopener">CAShapeLayer</a></li>
<li>CATextLayer</li>
<li>CATransformLayer</li>
<li><a href="http://www.jianshu.com/p/0e0ff206f110" target="_blank" rel="noopener">CAReplicatorLayer</a></li>
<li>CAScrollLayer</li>
<li><a href="http://www.jianshu.com/p/03095391e301" target="_blank" rel="noopener">CAEmitterLayer</a></li>
<li>CAEAGLLayer</li>
<li>AVPlayerLayer<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/826e593d82b6" target="_blank" rel="noopener">ä¸“ç”¨å›¾å±‚</a><h4 id="ç¬¬ä¸ƒç« ï¼šéšå¼åŠ¨ç”»"><a href="#ç¬¬ä¸ƒç« ï¼šéšå¼åŠ¨ç”»" class="headerlink" title="ç¬¬ä¸ƒç« ï¼šéšå¼åŠ¨ç”»"></a>ç¬¬ä¸ƒç« ï¼šéšå¼åŠ¨ç”»</h4></li>
<li>äº‹åŠ¡</li>
<li>å®Œæˆå—</li>
<li>å›¾å±‚è¡Œä¸º</li>
<li>å‘ˆç°ä¸æ¨¡å‹<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/0e082382a612" target="_blank" rel="noopener">éšå¼åŠ¨ç”»</a><h4 id="ç¬¬å…«ç« ï¼šæ˜¾å¼åŠ¨ç”»"><a href="#ç¬¬å…«ç« ï¼šæ˜¾å¼åŠ¨ç”»" class="headerlink" title="ç¬¬å…«ç« ï¼šæ˜¾å¼åŠ¨ç”»"></a>ç¬¬å…«ç« ï¼šæ˜¾å¼åŠ¨ç”»</h4></li>
<li><a href="http://www.jianshu.com/p/73f87913c18d" target="_blank" rel="noopener">å±æ€§åŠ¨ç”»</a></li>
<li>åŠ¨ç”»ç»„</li>
<li>è¿‡æ¸¡</li>
<li>åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­å–æ¶ˆåŠ¨ç”»<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/1e1364839b20" target="_blank" rel="noopener">æ˜¾å¼åŠ¨ç”»</a><h4 id="ç¬¬ä¹ç« ï¼šå›¾å±‚æ—¶é—´"><a href="#ç¬¬ä¹ç« ï¼šå›¾å±‚æ—¶é—´" class="headerlink" title="ç¬¬ä¹ç« ï¼šå›¾å±‚æ—¶é—´"></a>ç¬¬ä¹ç« ï¼šå›¾å±‚æ—¶é—´</h4></li>
<li>CAMediaTiming åè®®</li>
<li>å±‚çº§å…³ç³»æ—¶é—´</li>
<li>æ‰‹åŠ¨åŠ¨ç”»<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/7bfe1ef1fb5b" target="_blank" rel="noopener">å›¾å±‚æ—¶é—´</a><h4 id="ç¬¬åç« ï¼šç¼“å†²"><a href="#ç¬¬åç« ï¼šç¼“å†²" class="headerlink" title="ç¬¬åç« ï¼šç¼“å†²"></a>ç¬¬åç« ï¼šç¼“å†²</h4></li>
<li>åŠ¨ç”»é€Ÿåº¦</li>
<li>è‡ªå®šä¹‰ç¼“å†²å‡½æ•°<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/39d1f739e2c9" target="_blank" rel="noopener">ç¼“å†²</a><h4 id="ç¬¬åä¸€ç« ï¼šåŸºäºå®šæ—¶å™¨çš„åŠ¨ç”»"><a href="#ç¬¬åä¸€ç« ï¼šåŸºäºå®šæ—¶å™¨çš„åŠ¨ç”»" class="headerlink" title="ç¬¬åä¸€ç« ï¼šåŸºäºå®šæ—¶å™¨çš„åŠ¨ç”»"></a>ç¬¬åä¸€ç« ï¼šåŸºäºå®šæ—¶å™¨çš„åŠ¨ç”»</h4></li>
<li>å®šæ—¶å¸§</li>
<li>ç‰©ç†æ¨¡æ‹Ÿ<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/761bece1c5a6" target="_blank" rel="noopener">åŸºäºå®šæ—¶å™¨çš„åŠ¨ç”»</a><h4 id="ç¬¬åäºŒç« ï¼šæ€§èƒ½è°ƒä¼˜"><a href="#ç¬¬åäºŒç« ï¼šæ€§èƒ½è°ƒä¼˜" class="headerlink" title="ç¬¬åäºŒç« ï¼šæ€§èƒ½è°ƒä¼˜"></a>ç¬¬åäºŒç« ï¼šæ€§èƒ½è°ƒä¼˜</h4></li>
<li>CPU VS GPU</li>
<li>æµ‹é‡ï¼Œè€Œä¸æ˜¯çŒœæµ‹</li>
<li>Instruments<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/8874ec25c302" target="_blank" rel="noopener">æ€§èƒ½è°ƒä¼˜</a><h4 id="ç¬¬åä¸‰ç« ï¼šé«˜æ•ˆç»˜å›¾"><a href="#ç¬¬åä¸‰ç« ï¼šé«˜æ•ˆç»˜å›¾" class="headerlink" title="ç¬¬åä¸‰ç« ï¼šé«˜æ•ˆç»˜å›¾"></a>ç¬¬åä¸‰ç« ï¼šé«˜æ•ˆç»˜å›¾</h4></li>
<li>è½¯ä»¶ç»˜å›¾</li>
<li>çŸ¢é‡å›¾å½¢</li>
<li>è„çŸ©å½¢</li>
<li>å¼‚æ­¥ç»˜åˆ¶<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/974eb333020a" target="_blank" rel="noopener">é«˜æ•ˆç»˜å›¾</a><h4 id="ç¬¬åå››ç« ï¼šå›¾åƒIO"><a href="#ç¬¬åå››ç« ï¼šå›¾åƒIO" class="headerlink" title="ç¬¬åå››ç« ï¼šå›¾åƒIO"></a>ç¬¬åå››ç« ï¼šå›¾åƒIO</h4></li>
<li>åŠ è½½å’Œæ½œä¼</li>
<li>ç¼“å­˜</li>
<li>æ–‡ä»¶æ ¼å¼<br>æ€»ç»“ é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/1cb402c1bbba" target="_blank" rel="noopener">å›¾åƒIO</a><h4 id="ç¬¬åäº”ç« ï¼šå›¾å±‚æ€§èƒ½"><a href="#ç¬¬åäº”ç« ï¼šå›¾å±‚æ€§èƒ½" class="headerlink" title="ç¬¬åäº”ç« ï¼šå›¾å±‚æ€§èƒ½"></a>ç¬¬åäº”ç« ï¼šå›¾å±‚æ€§èƒ½</h4></li>
<li>éšå¼ç»˜åˆ¶</li>
<li>ç¦»å±æ¸²æŸ“</li>
<li>æ··åˆå’Œè¿‡æ¸¡ç»˜åˆ¶</li>
<li>å‡å°‘å’Œè¿‡æ¸¡ç»˜åˆ¶<br>æ€»ç»“</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/02/CoreAnimationå¯„å®¿å›¾/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/02/CoreAnimationå¯„å®¿å›¾/" itemprop="url">CoreAnimationå¯„å®¿å›¾</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-02T20:19:35+08:00">
                2016-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>###å¯„å®¿å›¾</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ã€å›¾å±‚æ ‘ã€ä¸­ä»‹ç»äº†CALayerç±»å¹¶åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœ‰è“è‰²èƒŒæ™¯çš„å›¾å±‚ã€‚èƒŒæ™¯é¢œè‰²è¿˜å¥½å•¦ï¼Œä½†æ˜¯å¦‚æœå®ƒä»…ä»…æ˜¯å±•ç°äº†ä¸€ä¸ªå•è°ƒçš„é¢œè‰²æœªå…ä¹Ÿå¤ªæ— èŠäº†ã€‚äº‹å®ä¸ŠCALayerç±»èƒ½å¤ŸåŒ…å«ä¸€å¼ ä½ å–œæ¬¢çš„å›¾ç‰‡ï¼Œè¿™ä¸€ç« èŠ‚æˆ‘ä»¬å°†æ¥æ¢ç´¢CALayerçš„å¯„å®¿å›¾ï¼ˆå³å›¾å±‚ä¸­åŒ…å«çš„å›¾ï¼‰ã€‚</p>
<ul>
<li>####<strong>contentså±æ€§</strong></li>
</ul>
<p>CALayer æœ‰ä¸€ä¸ªå±æ€§å«åšcontentsï¼Œè¿™ä¸ªå±æ€§çš„ç±»å‹è¢«å®šä¹‰ä¸ºidï¼Œæ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç»™contentså±æ€§èµ‹ä»»ä½•å€¼ï¼Œä½ çš„appä»ç„¶èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ã€‚ä½†æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¦‚æœä½ ç»™contentsèµ‹çš„ä¸æ˜¯CGImageï¼Œé‚£ä¹ˆä½ å¾—åˆ°çš„å›¾å±‚å°†æ˜¯ç©ºç™½çš„ã€‚<br>contentsè¿™ä¸ªå¥‡æ€ªçš„è¡¨ç°æ˜¯ç”±Mac OSçš„å†å²åŸå› é€ æˆçš„ã€‚å®ƒä¹‹æ‰€ä»¥è¢«å®šä¹‰ä¸ºidç±»å‹ï¼Œæ˜¯å› ä¸ºåœ¨Mac OSç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå±æ€§å¯¹CGImageå’ŒNSImageç±»å‹çš„å€¼éƒ½èµ·ä½œç”¨ã€‚å¦‚æœä½ è¯•å›¾åœ¨<a href="http://lib.csdn.net/base/1" target="_blank" rel="noopener">iOS</a>å¹³å°ä¸Šå°†UIImageçš„å€¼èµ‹ç»™å®ƒï¼Œåªèƒ½å¾—åˆ°ä¸€ä¸ªç©ºç™½çš„å›¾å±‚ã€‚ä¸€äº›åˆè¯†Core Animationçš„iOSå¼€å‘è€…å¯èƒ½ä¼šå¯¹è¿™ä¸ªæ„Ÿåˆ°å›°æƒ‘ã€‚<br>å¤´ç–¼çš„ä¸ä»…ä»…æ˜¯æˆ‘ä»¬åˆšæ‰æåˆ°çš„è¿™ä¸ªé—®é¢˜ã€‚äº‹å®ä¸Šï¼Œä½ çœŸæ­£è¦èµ‹å€¼çš„ç±»å‹åº”è¯¥æ˜¯CGImageRefï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘CGImageç»“æ„çš„æŒ‡é’ˆã€‚UIImageæœ‰ä¸€ä¸ªCGImageå±æ€§ï¼Œå®ƒè¿”å›ä¸€ä¸ªâ€CGImageRefâ€,å¦‚æœä½ æƒ³æŠŠè¿™ä¸ªå€¼ç›´æ¥èµ‹å€¼ç»™CALayerçš„contentsï¼Œé‚£ä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºCGImageRefå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„Cocoaå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªCore Foundationç±»å‹ã€‚<br>å°½ç®¡Core Foundationç±»å‹è·ŸCocoaå¯¹è±¡åœ¨è¿è¡Œæ—¶è²Œä¼¼å¾ˆåƒï¼ˆè¢«ç§°ä½œtoll-free bridgingï¼‰ï¼Œä»–ä»¬å¹¶ä¸æ˜¯ç±»å‹å…¼å®¹çš„ï¼Œä¸è¿‡ä½ å¯ä»¥é€šè¿‡bridgedå…³é”®å­—è½¬æ¢ã€‚å¦‚æœè¦ç»™å›¾å±‚çš„å¯„å®¿å›¾èµ‹å€¼ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š<br><code>layer.contents = (__bridge id)image.CGImage;</code><br> å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ï¼Œä½ å°±ä¸éœ€è¦__bridgeè¿™éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œä½ å¹²å˜›ä¸ç”¨ARCï¼Ÿï¼</p>
<p>è®©æˆ‘ä»¬æ¥ç»§ç»­ä¿®æ”¹æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« æ–°å»ºçš„å·¥ç¨‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿå±•ç¤ºä¸€å¼ å›¾ç‰‡è€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªèƒŒæ™¯è‰²ã€‚æˆ‘ä»¬å·²ç»ç”¨ä»£ç çš„æ–¹å¼å»ºç«‹ä¸€ä¸ªå›¾å±‚ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦é¢å¤–çš„å›¾å±‚äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥æŠŠlayerViewçš„å®¿ä¸»å›¾å±‚çš„contentså±æ€§è®¾ç½®æˆå›¾ç‰‡ã€‚</p>
<p>#####æ¸…å•2.1 æ›´æ–°åçš„ä»£ç ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line">    </div><div class="line">    - (void)viewDidLoad</div><div class="line">    &#123;</div><div class="line">        [super viewDidLoad]; //load an image</div><div class="line">        UIImage *image = [UIImage imageNamed:@&quot;Snowman&quot;];</div><div class="line">        //add it directly to our view&apos;s layer</div><div class="line">        self.layerView.layer.contents = (__bridge id)image.CGImage;</div><div class="line">    &#125;</div><div class="line">    @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-693d5c2da9328e26.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾.png"></p>
<pre><code>åœ¨UIViewçš„å®¿ä¸»å›¾å±‚ä¸­æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡
</code></pre><p>æˆ‘ä»¬ç”¨è¿™äº›ç®€å•çš„ä»£ç åšäº†ä¸€ä»¶å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼šæˆ‘ä»¬åˆ©ç”¨CALayeråœ¨ä¸€ä¸ªæ™®é€šçš„UIViewä¸­æ˜¾ç¤ºäº†ä¸€å¼ å›¾ç‰‡ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªUIImageViewï¼Œå®ƒä¸æ˜¯æˆ‘ä»¬é€šå¸¸ç”¨æ¥å±•ç¤ºå›¾ç‰‡çš„æ–¹æ³•ã€‚é€šè¿‡ç›´æ¥æ“ä½œå›¾å±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›æ–°çš„å‡½æ•°ï¼Œä½¿å¾—UIViewæ›´åŠ æœ‰è¶£äº†ã€‚</p>
<ul>
<li>####<strong>contentGravityå±æ€§</strong></li>
</ul>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†æˆ‘ä»¬çš„é›ªäººçœ‹èµ·æ¥æœ‰ç‚¹ã€‚ã€‚ã€‚èƒ– ï¼ï¼ï¼ æˆ‘ä»¬åŠ è½½çš„å›¾ç‰‡å¹¶ä¸åˆšå¥½æ˜¯ä¸€ä¸ªæ–¹çš„ï¼Œä¸ºäº†é€‚åº”è¿™ä¸ªè§†å›¾ï¼Œå®ƒæœ‰ä¸€ç‚¹ç‚¹è¢«æ‹‰ä¼¸äº†ã€‚åœ¨ä½¿ç”¨UIImageViewçš„æ—¶å€™é‡åˆ°è¿‡åŒæ ·çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æŠŠcontentModeå±æ€§è®¾ç½®æˆæ›´åˆé€‚çš„å€¼ï¼Œåƒè¿™æ ·ï¼š<br><code>view.contentMode = UIViewContentModeScaleAspectFit;</code></p>
<p>è¿™ä¸ªæ–¹æ³•åŸºæœ¬å’Œæˆ‘ä»¬é‡åˆ°çš„æƒ…å†µçš„è§£å†³æ–¹æ³•å·²ç»æ¥è¿‘äº†ï¼ˆä½ å¯ä»¥è¯•ä¸€ä¸‹ :) ï¼‰ï¼Œä¸è¿‡UIViewå¤§å¤šæ•°è§†è§‰ç›¸å…³çš„å±æ€§æ¯”å¦‚contentModeï¼Œå¯¹è¿™äº›å±æ€§çš„æ“ä½œå…¶å®æ˜¯å¯¹å¯¹åº”å›¾å±‚çš„æ“ä½œã€‚</p>
<p>CALayerä¸contentModeå¯¹åº”çš„å±æ€§å«åšcontentsGravityï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªNSStringç±»å‹ï¼Œè€Œä¸æ˜¯åƒå¯¹åº”çš„UIKitéƒ¨åˆ†ï¼Œé‚£é‡Œé¢çš„å€¼æ˜¯æšä¸¾ã€‚contentsGravityå¯é€‰çš„å¸¸é‡å€¼æœ‰ä»¥ä¸‹ä¸€äº›ï¼š</p>
<ul>
<li>kCAGravityCenter</li>
<li>kCAGravityTop</li>
<li>kCAGravityBottom</li>
<li>kCAGravityLeft</li>
<li>kCAGravityRight</li>
<li>kCAGravityTopLeft</li>
<li>kCAGravityTopRight</li>
<li>kCAGravityBottomLeft</li>
<li>kCAGravityBottomRight</li>
<li>kCAGravityResize</li>
<li>kCAGravityResizeAspect</li>
<li>kCAGravityResizeAspectFill</li>
</ul>
<p>å’ŒcotentModeä¸€æ ·ï¼ŒcontentsGravityçš„ç›®çš„æ˜¯ä¸ºäº†å†³å®šå†…å®¹åœ¨å›¾å±‚çš„è¾¹ç•Œä¸­æ€ä¹ˆå¯¹é½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨kCAGravityResizeAspectï¼Œå®ƒçš„æ•ˆæœç­‰åŒäºUIViewContentModeScaleAspectFitï¼Œ åŒæ—¶å®ƒè¿˜èƒ½åœ¨å›¾å±‚ä¸­ç­‰æ¯”ä¾‹æ‹‰ä¼¸ä»¥é€‚åº”å›¾å±‚çš„è¾¹ç•Œã€‚</p>
<p><code>self.layerView.layer.contentsGravity = kCAGravityResizeAspect;</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-6c0ffcad9d3f428c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p>
<ul>
<li>####<strong>contentsScaleå±æ€§</strong></li>
</ul>
<p>contentsScaleå±æ€§å®šä¹‰äº†å¯„å®¿å›¾çš„åƒç´ å°ºå¯¸å’Œè§†å›¾å¤§å°çš„æ¯”ä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯ä¸€ä¸ªå€¼ä¸º1.0çš„æµ®ç‚¹æ•°ã€‚</p>
<p>contentsScaleçš„ç›®çš„å¹¶ä¸æ˜¯é‚£ä¹ˆæ˜æ˜¾ã€‚å®ƒå¹¶ä¸æ˜¯æ€»ä¼šå¯¹å±å¹•ä¸Šçš„å¯„å®¿å›¾æœ‰å½±å“ã€‚å¦‚æœä½ å°è¯•å¯¹æˆ‘ä»¬çš„ä¾‹å­è®¾ç½®ä¸åŒçš„å€¼ï¼Œä½ å°±ä¼šå‘ç°æ ¹æœ¬æ²¡ä»»ä½•å½±å“ã€‚å› ä¸ºcontentsç”±äºè®¾ç½®äº†contentsGravity<br>å±æ€§ï¼Œæ‰€ä»¥å®ƒå·²ç»è¢«æ‹‰ä¼¸ä»¥é€‚åº”å›¾å±‚çš„è¾¹ç•Œã€‚</p>
<p>å¦‚æœä½ åªæ˜¯å•çº¯åœ°æƒ³æ”¾å¤§å›¾å±‚çš„contentså›¾ç‰‡ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å›¾å±‚çš„transformå’ŒaffineTransformå±æ€§æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼ˆè§ç¬¬äº”ç« ã€Transformsã€ï¼Œé‡Œé¢å¯¹æ­¤æœ‰è§£é‡Šï¼‰ï¼Œè¿™(æŒ‡æ”¾å¤§)ä¹Ÿä¸æ˜¯contengsScaleçš„ç›®çš„æ‰€åœ¨.</p>
<p>contentsScaleå±æ€§å…¶å®å±äºæ”¯æŒé«˜åˆ†è¾¨ç‡ï¼ˆåˆç§°Hi-DPIæˆ–Retinaï¼‰å±å¹•æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚å®ƒç”¨æ¥åˆ¤æ–­åœ¨ç»˜åˆ¶å›¾å±‚çš„æ—¶å€™åº”è¯¥ä¸ºå¯„å®¿å›¾åˆ›å»ºçš„ç©ºé—´å¤§å°ï¼Œå’Œéœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡çš„æ‹‰ä¼¸åº¦ï¼ˆå‡è®¾å¹¶æ²¡æœ‰è®¾contentsGravity<br>å±æ€§ï¼‰ã€‚UIViewæœ‰ä¸€ä¸ªç±»ä¼¼åŠŸèƒ½ä½†æ˜¯éå¸¸å°‘ç”¨åˆ°contentScaleFactor<br>å±æ€§ã€‚</p>
<p>å¦‚æœcontentsScaleè®¾ç½®ä¸º1.0ï¼Œå°†ä¼šä»¥æ¯ä¸ªç‚¹1ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ï¼Œå¦‚æœè®¾ç½®ä¸º2.0ï¼Œåˆ™ä¼šä»¥æ¯ä¸ªç‚¹2ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„Retinaå±å¹•ã€‚ï¼ˆå¦‚æœä½ å¯¹åƒç´ å’Œç‚¹çš„æ¦‚å¿µä¸æ˜¯å¾ˆæ¸…æ¥šçš„è¯ï¼Œè¿™ä¸ªç« èŠ‚çš„åé¢éƒ¨åˆ†å°†ä¼šå¯¹æ­¤åšå‡ºè§£é‡Šï¼‰ã€‚</p>
<p>è¿™å¹¶ä¸ä¼šå¯¹æˆ‘ä»¬åœ¨ä½¿ç”¨kCAGravityResizeAspectæ—¶äº§ç”Ÿä»»ä½•å½±å“ï¼Œå› ä¸ºå®ƒå°±æ˜¯æ‹‰ä¼¸å›¾ç‰‡ä»¥é€‚åº”å›¾å±‚è€Œå·²ï¼Œæ ¹æœ¬ä¸ä¼šè€ƒè™‘åˆ°åˆ†è¾¨ç‡é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠcontentsGravityè®¾ç½®ä¸ºkCAGravityCenterï¼ˆè¿™ä¸ªå€¼å¹¶ä¸ä¼šæ‹‰ä¼¸å›¾ç‰‡ï¼‰ï¼Œé‚£å°†ä¼šæœ‰å¾ˆæ˜æ˜¾çš„å˜åŒ–ï¼ˆå¦‚å›¾2.3ï¼‰<br><img src="http://upload-images.jianshu.io/upload_images/1694376-e88c0aaf84f3b8e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.3.png"></p>
<pre><code>ç”¨é”™è¯¯çš„contentsScaleå±æ€§æ˜¾ç¤ºRetinaå›¾ç‰‡
</code></pre><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬çš„é›ªäººä¸ä»…æœ‰ç‚¹å¤§è¿˜æœ‰ç‚¹åƒç´ çš„é¢—ç²’æ„Ÿã€‚é‚£æ˜¯å› ä¸ºå’ŒUIImageä¸åŒï¼ŒCGImageæ²¡æœ‰æ‹‰ä¼¸çš„æ¦‚å¿µã€‚å½“æˆ‘ä»¬ä½¿ç”¨UIImageç±»å»è¯»å–æˆ‘ä»¬çš„é›ªäººå›¾ç‰‡çš„æ—¶å€™ï¼Œä»–è¯»å–äº†é«˜è´¨é‡çš„Retinaç‰ˆæœ¬çš„å›¾ç‰‡ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ç”¨CGImageæ¥è®¾ç½®æˆ‘ä»¬çš„å›¾å±‚çš„å†…å®¹æ—¶ï¼Œæ‹‰ä¼¸è¿™ä¸ªå› ç´ åœ¨è½¬æ¢çš„æ—¶å€™å°±ä¸¢å¤±äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®contentsScaleæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼ˆå¦‚2.2æ¸…å•ï¼‰ï¼Œå›¾2.4æ˜¯ç»“æœ</p>
<p>#####æ¸…å•2.4<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line">    </div><div class="line">    - (void)viewDidLoad</div><div class="line">    &#123;</div><div class="line">        [super viewDidLoad]; //load an image</div><div class="line">        UIImage *image = [UIImage imageNamed:@&quot;Snowman.png&quot;]; //add it directly to our view&apos;s layer</div><div class="line">        self.layerView.layer.contents = (__bridge id)image.CGImage; //center the image</div><div class="line">        self.layerView.layer.contentsGravity = kCAGravityCenter;</div><div class="line">        </div><div class="line">        //set the contentsScale to match image</div><div class="line">        self.layerView.layer.contentsScale = image.scale;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-d6cc02bde6e0ac3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.4.æ­£ç¡®çš„contentsScaleä¹‹å"><br>å½“ç”¨ä»£ç çš„æ–¹å¼æ¥å¤„ç†å¯„å®¿å›¾çš„æ—¶å€™ï¼Œä¸€å®šè¦è®°ä½è¦æ‰‹åŠ¨çš„è®¾ç½®å›¾å±‚çš„contentsScaleå±æ€§ï¼Œå¦åˆ™ï¼Œä½ çš„å›¾ç‰‡åœ¨Retinaè®¾å¤‡ä¸Šå°±æ˜¾ç¤ºå¾—ä¸æ­£ç¡®å•¦ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><code>layer.contentsScale = [UIScreen mainScreen].scale;</code></p>
<ul>
<li>####<strong>maskToBoundså±æ€§</strong></li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬çš„é›ªäººæ€»ç®—æ˜¯æ˜¾ç¤ºäº†æ­£ç¡®çš„å¤§å°ï¼Œä¸è¿‡ä½ ä¹Ÿè®¸å·²ç»å‘ç°äº†å¦å¤–ä¸€äº›äº‹æƒ…ï¼šä»–è¶…å‡ºäº†è§†å›¾çš„è¾¹ç•Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒUIViewä»ç„¶ä¼šç»˜åˆ¶è¶…è¿‡è¾¹ç•Œçš„å†…å®¹æˆ–æ˜¯å­è§†å›¾ï¼Œåœ¨CALayerä¸‹ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</p>
<p>UIViewæœ‰ä¸€ä¸ªå«åšclipsToBoundsçš„å±æ€§å¯ä»¥ç”¨æ¥å†³å®šæ˜¯å¦æ˜¾ç¤ºè¶…å‡ºè¾¹ç•Œçš„å†…å®¹ï¼ŒCALayerå¯¹åº”çš„å±æ€§å«åšmasksToBoundsï¼ŒæŠŠå®ƒè®¾ç½®ä¸ºYESï¼Œé›ªäººå°±åœ¨è¾¹ç•Œé‡Œå•¦ï½ï¼ˆå¦‚å›¾2.5ï¼‰<br><img src="http://upload-images.jianshu.io/upload_images/1694376-f3fe22588c2a354e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.5.png"></p>
<ul>
<li>####<strong>contentsRectå±æ€§</strong></li>
</ul>
<p>CALayerçš„contentsRectå±æ€§å…è®¸æˆ‘ä»¬åœ¨å›¾å±‚è¾¹æ¡†é‡Œæ˜¾ç¤ºå¯„å®¿å›¾çš„ä¸€ä¸ªå­åŸŸã€‚è¿™æ¶‰åŠåˆ°å›¾ç‰‡æ˜¯å¦‚ä½•æ˜¾ç¤ºå’Œæ‹‰ä¼¸çš„ï¼Œæ‰€ä»¥è¦contentsGravity<br>çµæ´»å¤šäº†å’Œboundsï¼Œframeä¸åŒï¼ŒcontentsRectä¸æ˜¯æŒ‰ç‚¹æ¥è®¡ç®—çš„ï¼Œå®ƒä½¿ç”¨äº†å•ä½åæ ‡ï¼Œå•ä½åæ ‡æŒ‡å®šåœ¨0åˆ°1ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼ˆåƒç´ å’Œç‚¹å°±æ˜¯ç»å¯¹å€¼ï¼‰ã€‚æ‰€ä»¥ä»–ä»¬æ˜¯ç›¸å¯¹ä¸å¯„å®¿å›¾çš„å°ºå¯¸çš„ã€‚iOSä½¿ç”¨äº†ä»¥ä¸‹çš„åæ ‡ç³»ç»Ÿï¼š</p>
<ul>
<li>ç‚¹ â€”â€” åœ¨iOSå’ŒMac OSä¸­æœ€å¸¸è§çš„åæ ‡ä½“ç³»ã€‚ç‚¹å°±åƒæ˜¯è™šæ‹Ÿçš„åƒç´ ï¼Œä¹Ÿè¢«ç§°ä½œé€»è¾‘åƒç´ ã€‚åœ¨æ ‡å‡†è®¾å¤‡ä¸Šï¼Œä¸€ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªåƒç´ ï¼Œä½†æ˜¯åœ¨Retinaè®¾å¤‡ä¸Šï¼Œä¸€ä¸ªç‚¹ç­‰äº2*2ä¸ªåƒç´ ã€‚iOSç”¨ç‚¹ä½œä¸ºå±å¹•çš„åæ ‡æµ‹ç®—ä½“ç³»å°±æ˜¯ä¸ºäº†åœ¨Retinaè®¾å¤‡å’Œæ™®é€šè®¾å¤‡ä¸Šèƒ½æœ‰ä¸€è‡´çš„è§†è§‰æ•ˆæœã€‚</li>
<li>åƒç´  â€”â€” ç‰©ç†åƒç´ åæ ‡å¹¶ä¸ä¼šç”¨æ¥å±å¹•å¸ƒå±€ï¼Œä½†æ˜¯ä»ç„¶ä¸å›¾ç‰‡æœ‰ç›¸å¯¹å…³ç³»ã€‚UIImageæ˜¯ä¸€ä¸ªå±å¹•åˆ†è¾¨ç‡è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æŒ‡å®šç‚¹æ¥åº¦é‡å¤§å°ã€‚ä½†æ˜¯ä¸€äº›åº•å±‚çš„å›¾ç‰‡è¡¨ç¤ºå¦‚CGImageå°±ä¼šä½¿ç”¨åƒç´ ï¼Œæ‰€ä»¥ä½ è¦æ¸…æ¥šåœ¨Retinaè®¾å¤‡å’Œæ™®é€šè®¾å¤‡ä¸Šï¼Œä»–ä»¬è¡¨ç°å‡ºæ¥äº†ä¸åŒçš„å¤§å°ã€‚</li>
<li>å•ä½ â€”â€” å¯¹äºä¸å›¾ç‰‡å¤§å°æˆ–æ˜¯å›¾å±‚è¾¹ç•Œç›¸å…³çš„æ˜¾ç¤ºï¼Œå•ä½åæ ‡æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„åº¦é‡æ–¹å¼ï¼Œ å½“å¤§å°æ”¹å˜çš„æ—¶å€™ï¼Œä¹Ÿä¸éœ€è¦å†æ¬¡è°ƒæ•´ã€‚å•ä½åæ ‡åœ¨OpenGLè¿™ç§çº¹ç†åæ ‡ç³»ç»Ÿä¸­ç”¨å¾—å¾ˆå¤šï¼ŒCore Animationä¸­ä¹Ÿç”¨åˆ°äº†å•ä½åæ ‡ã€‚</li>
</ul>
<p>é»˜è®¤çš„contentsRectæ˜¯{0, 0, 1, 1}ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªå¯„å®¿å›¾é»˜è®¤éƒ½æ˜¯å¯è§çš„ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªå°ä¸€ç‚¹çš„çŸ©å½¢ï¼Œå›¾ç‰‡å°±ä¼šè¢«è£å‰ªï¼ˆå¦‚å›¾2.6ï¼‰<br><img src="http://upload-images.jianshu.io/upload_images/1694376-d1c60386893f5477.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.6.png"></p>
<p>äº‹å®ä¸Šç»™contentsRectè®¾ç½®ä¸€ä¸ªè´Ÿæ•°çš„åŸç‚¹æˆ–æ˜¯å¤§äº{1, 1}çš„å°ºå¯¸ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¤–é¢çš„åƒç´ ä¼šè¢«æ‹‰ä¼¸ä»¥å¡«å……å‰©ä¸‹çš„åŒºåŸŸã€‚</p>
<p>contentsRectåœ¨appä¸­æœ€æœ‰è¶£çš„åœ°æ–¹åœ¨äºä¸€ä¸ªå«åšimage spritesï¼ˆå›¾ç‰‡æ‹¼åˆï¼‰çš„ç”¨æ³•ã€‚å¦‚æœä½ æœ‰æ¸¸æˆç¼–ç¨‹çš„ç»éªŒï¼Œé‚£ä¹ˆä½ ä¸€å®šå¯¹å›¾ç‰‡æ‹¼åˆçš„æ¦‚å¿µå¾ˆç†Ÿæ‚‰ï¼Œå›¾ç‰‡èƒ½å¤Ÿåœ¨å±å¹•ä¸Šç‹¬ç«‹åœ°å˜æ›´ä½ç½®ã€‚æŠ›å¼€æ¸¸æˆç¼–ç¨‹ä¸è°ˆï¼Œè¿™ä¸ªæŠ€æœ¯å¸¸ç”¨æ¥æŒ‡ä»£è½½å…¥æ‹¼åˆçš„å›¾ç‰‡ï¼Œè·Ÿç§»åŠ¨å›¾ç‰‡ä¸€ç‚¹å…³ç³»ä¹Ÿæ²¡æœ‰ã€‚</p>
<p>å…¸å‹åœ°ï¼Œå›¾ç‰‡æ‹¼åˆåå¯ä»¥æ‰“åŒ…æ•´åˆåˆ°ä¸€å¼ å¤§å›¾ä¸Šä¸€æ¬¡æ€§è½½å…¥ã€‚ç›¸æ¯”å¤šæ¬¡è½½å…¥ä¸åŒçš„å›¾ç‰‡ï¼Œè¿™æ ·åšèƒ½å¤Ÿå¸¦æ¥å¾ˆå¤šæ–¹é¢çš„å¥½å¤„ï¼šå†…å­˜ä½¿ç”¨ï¼Œè½½å…¥æ—¶é—´ï¼Œæ¸²æŸ“æ€§èƒ½ç­‰ç­‰</p>
<p>2Dæ¸¸æˆå¼•æ“å…¥Cocos2Dä½¿ç”¨äº†æ‹¼åˆæŠ€æœ¯ï¼Œå®ƒä½¿ç”¨OpenGLæ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‹¼åˆåœ¨ä¸€ä¸ªæ™®é€šçš„UIKitåº”ç”¨ä¸­ï¼Œå¯¹ï¼å°±æ˜¯ä½¿ç”¨contentsRect</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‹¼åˆåçš„å›¾è¡¨ â€”â€” ä¸€ä¸ªåŒ…å«å°ä¸€äº›çš„æ‹¼åˆå›¾çš„å¤§å›¾ç‰‡ã€‚å¦‚å›¾2.7æ‰€ç¤ºï¼š<br><img src="http://upload-images.jianshu.io/upload_images/1694376-064197033685be51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.7.png"></p>
<p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åœ¨appä¸­è½½å…¥å¹¶æ˜¾ç¤ºè¿™äº›æ‹¼åˆå›¾ã€‚è§„åˆ™å¾ˆç®€å•ï¼šåƒå¹³å¸¸ä¸€æ ·è½½å…¥æˆ‘ä»¬çš„å¤§å›¾ï¼Œç„¶åæŠŠå®ƒèµ‹å€¼ç»™å››ä¸ªç‹¬ç«‹çš„å›¾å±‚çš„contentsï¼Œç„¶åè®¾ç½®æ¯ä¸ªå›¾å±‚çš„contentsRectæ¥å»æ‰æˆ‘ä»¬ä¸æƒ³æ˜¾ç¤ºçš„éƒ¨åˆ†ã€‚</p>
<p>æˆ‘ä»¬çš„å·¥ç¨‹ä¸­éœ€è¦ä¸€äº›é¢å¤–çš„è§†å›¾ã€‚ï¼ˆä¸ºäº†é¿å…å¤ªå¤šä»£ç ã€‚æˆ‘ä»¬å°†ä½¿ç”¨Interface Builderæ¥æ‹œè®¿ä»–ä»¬çš„ä½ç½®ï¼Œå¦‚æœä½ æ„¿æ„è¿˜æ˜¯å¯ä»¥ç”¨ä»£ç çš„æ–¹å¼æ¥å®ç°çš„ï¼‰ã€‚æ¸…å•2.3æœ‰éœ€è¦çš„ä»£ç ï¼Œå›¾2.8å±•ç¤ºäº†ç»“æœ</p>
<p>#####æ¸…å•2.3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">@interface ViewController ()</div><div class="line">@property (nonatomic, weak) IBOutlet UIView *coneView;</div><div class="line">@property (nonatomic, weak) IBOutlet UIView *shipView;</div><div class="line">@property (nonatomic, weak) IBOutlet UIView *iglooView;</div><div class="line">@property (nonatomic, weak) IBOutlet UIView *anchorView;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)addSpriteImage:(UIImage *)image withContentRect:(CGRect)rect ï¿¼toLayer:(CALayer *)layer //set image</div><div class="line">&#123;</div><div class="line">    layer.contents = (__bridge id)image.CGImage;</div><div class="line">    </div><div class="line">    //scale contents to fit</div><div class="line">    layer.contentsGravity = kCAGravityResizeAspect;</div><div class="line">    </div><div class="line">    //set contentsRect</div><div class="line">    layer.contentsRect = rect;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad]; //load sprite sheet</div><div class="line">    UIImage *image = [UIImage imageNamed:@&quot;Sprites.png&quot;];</div><div class="line">    //set igloo sprite</div><div class="line">    [self addSpriteImage:image withContentRect:CGRectMake(0, 0, 0.5, 0.5) toLayer:self.iglooView.layer];</div><div class="line">    //set cone sprite</div><div class="line">    [self addSpriteImage:image withContentRect:CGRectMake(0.5, 0, 0.5, 0.5) toLayer:self.coneView.layer];</div><div class="line">    //set anchor sprite</div><div class="line">    [self addSpriteImage:image withContentRect:CGRectMake(0, 0.5, 0.5, 0.5) toLayer:self.anchorView.layer];</div><div class="line">    //set spaceship sprite</div><div class="line">    [self addSpriteImage:image withContentRect:CGRectMake(0.5, 0.5, 0.5, 0.5) toLayer:self.shipView.layer];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-df8cb36dcbaefaa1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾2.8.png"></p>
<p>æ‹¼åˆä¸ä»…ç»™appæä¾›äº†ä¸€ä¸ªæ•´æ´çš„è½½å…¥æ–¹å¼ï¼Œè¿˜æœ‰æ•ˆåœ°æé«˜äº†è½½å…¥æ€§èƒ½ï¼ˆå•å¼ å¤§å›¾æ¯”å¤šå¼ å°å›¾è½½å…¥åœ°æ›´å¿«ï¼‰ï¼Œä½†æ˜¯å¦‚æœæœ‰æ‰‹åŠ¨å®‰æ’çš„è¯ï¼Œä»–ä»¬è¿˜æ˜¯æœ‰ä¸€äº›ä¸æ–¹ä¾¿çš„ï¼Œå¦‚æœä½ éœ€è¦åœ¨ä¸€ä¸ªå·²ç»åˆ›å»ºå¥½çš„å“å’Œå›¾ä¸Šåšä¸€äº›å°ºå¯¸ä¸Šçš„ä¿®æ”¹æˆ–è€…å…¶ä»–å˜åŠ¨ï¼Œæ— ç–‘æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚<br>Macä¸Šæœ‰ä¸€äº›å•†ä¸šè½¯ä»¶å¯ä»¥ä¸ºä½ è‡ªåŠ¨æ‹¼åˆå›¾ç‰‡ï¼Œè¿™äº›å·¥å…·è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‹¼åˆåçš„åæ ‡çš„XMLæˆ–è€…plistæ–‡ä»¶ï¼Œæ‹¼åˆå›¾ç‰‡çš„ä½¿ç”¨å¤§å¤§ç®€åŒ–ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥å’Œå›¾ç‰‡ä¸€åŒè½½å…¥ï¼Œå¹¶ç»™æ¯ä¸ªæ‹¼åˆçš„å›¾å±‚è®¾ç½®contentsRectï¼Œè¿™æ ·å¼€å‘è€…å°±ä¸ç”¨æ‰‹åŠ¨å†™ä»£ç æ¥æ‘†æ”¾ä½ç½®äº†ã€‚<br>è¿™äº›æ–‡ä»¶é€šå¸¸åœ¨OpenGLæ¸¸æˆä¸­ä½¿ç”¨ï¼Œä¸è¿‡å‘¢ï¼Œä½ è¦æ˜¯æœ‰å…´è¶£åœ¨ä¸€äº›å¸¸è§çš„appä¸­ä½¿ç”¨æ‹¼åˆæŠ€æœ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªå«åšLayerSpritesçš„å¼€æºåº“ï¼ˆ<a href="https://github.com/nicklockwood/LayerSprites" target="_blank" rel="noopener">https://github.com/nicklockwood/LayerSprites</a>)ï¼Œå®ƒèƒ½å¤Ÿè¯»å–Cocos2Dæ ¼å¼ä¸­çš„æ‹¼åˆå›¾å¹¶åœ¨æ™®é€šçš„Core Animationå±‚ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<ul>
<li>####<strong>contentsCenterå±æ€§</strong></li>
</ul>
<p> æœ¬ç« æˆ‘ä»¬ä»‹ç»çš„æœ€åä¸€ä¸ªå’Œå†…å®¹æœ‰å…³çš„å±æ€§æ˜¯contentsCenterï¼Œçœ‹åå­—ä½ å¯èƒ½ä¼šä»¥ä¸ºå®ƒå¯èƒ½è·Ÿå›¾ç‰‡çš„ä½ç½®æœ‰å…³ï¼Œä¸è¿‡è¿™åå­—ç€å®è¯¯å¯¼äº†ä½ ã€‚contentsCenterå…¶å®æ˜¯ä¸€ä¸ªCGRectï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå›ºå®šçš„è¾¹æ¡†å’Œä¸€ä¸ªåœ¨å›¾å±‚ä¸Šå¯æ‹‰ä¼¸çš„åŒºåŸŸã€‚ æ”¹å˜contentsCenterçš„å€¼å¹¶ä¸ä¼šå½±å“åˆ°å¯„å®¿å›¾çš„æ˜¾ç¤ºï¼Œé™¤éè¿™ä¸ªå›¾å±‚çš„å¤§å°æ”¹å˜äº†ï¼Œä½ æ‰çœ‹å¾—åˆ°æ•ˆæœã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒcontentsCenteræ˜¯{0, 0, 1, 1}ï¼Œè¿™æ„å‘³ç€å¦‚æœå¤§å°ï¼ˆç”±conttensGravityå†³å®šï¼‰æ”¹å˜äº†,é‚£ä¹ˆå¯„å®¿å›¾å°†ä¼šå‡åŒ€åœ°æ‹‰ä¼¸å¼€ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¢åŠ åŸç‚¹çš„å€¼å¹¶å‡å°å°ºå¯¸ã€‚æˆ‘ä»¬ä¼šåœ¨å›¾ç‰‡çš„å‘¨å›´åˆ›é€ ä¸€ä¸ªè¾¹æ¡†ã€‚å›¾2.9å±•ç¤ºäº†contentsCenterè®¾ç½®ä¸º{0.25, 0.25, 0.5, 0.5}çš„æ•ˆæœã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-ba74d68cdfe19927.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.9.png"><br>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éšæ„é‡è®¾å°ºå¯¸ï¼Œè¾¹æ¡†ä»ç„¶ä¼šæ˜¯è¿ç»­çš„ã€‚ä»–å·¥ä½œèµ·æ¥çš„æ•ˆæœå’ŒUIImageé‡Œçš„-resizableImageWithCapInsets: æ–¹æ³•æ•ˆæœéå¸¸ç±»ä¼¼ï¼Œåªæ˜¯å®ƒå¯ä»¥è¿ç”¨åˆ°ä»»ä½•å¯„å®¿å›¾ï¼Œç”šè‡³åŒ…æ‹¬åœ¨Core Graphicsè¿è¡Œæ—¶ç»˜åˆ¶çš„å›¾å½¢ï¼ˆæœ¬ç« ç¨åä¼šè®²åˆ°ï¼‰ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/1694376-d062cb97b49f705c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.10.png"></p>
<p> æ¸…å•2.4 æ¼”ç¤ºäº†å¦‚ä½•ç¼–å†™è¿™äº›å¯æ‹‰ä¼¸è§†å›¾ã€‚ä¸è¿‡ï¼ŒcontentsCenterçš„å¦ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§å°±æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨Interface Builderé‡Œé¢é…ç½®ï¼Œæ ¹æœ¬ä¸ç”¨å†™ä»£ç ã€‚å¦‚å›¾2.11</p>
<p>####æ¸…å•2.4</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-ba4b083cc0841e22.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.11.png"></p>
<ul>
<li>####<strong>Custome Drawingå±æ€§</strong></li>
</ul>
<p> ç»™contentsèµ‹CGImageçš„å€¼ä¸æ˜¯å”¯ä¸€çš„è®¾ç½®å¯„å®¿å›¾çš„æ–¹æ³•ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç”¨Core Graphicsç›´æ¥ç»˜åˆ¶å¯„å®¿å›¾ã€‚èƒ½å¤Ÿé€šè¿‡ç»§æ‰¿UIViewå¹¶å®ç°-drawRect:æ–¹æ³•æ¥è‡ªå®šä¹‰ç»˜åˆ¶ã€‚</p>
<p>-drawRect: æ–¹æ³•æ²¡æœ‰é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºå¯¹UIViewæ¥è¯´ï¼Œå¯„å®¿å›¾å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒä¸åœ¨æ„é‚£åˆ°åº•æ˜¯å•è°ƒçš„é¢œè‰²è¿˜æ˜¯æœ‰ä¸€ä¸ªå›¾ç‰‡çš„å®ä¾‹ã€‚å¦‚æœUIViewæ£€æµ‹åˆ°-drawRect: æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œå®ƒå°±ä¼šä¸ºè§†å›¾åˆ†é…ä¸€ä¸ªå¯„å®¿å›¾ï¼Œè¿™ä¸ªå¯„å®¿å›¾çš„åƒç´ å°ºå¯¸ç­‰äºè§†å›¾å¤§å°ä¹˜ä»¥ contentsScaleçš„å€¼ã€‚</p>
<p>å¦‚æœä½ ä¸éœ€è¦å¯„å®¿å›¾ï¼Œé‚£å°±ä¸è¦åˆ›å»ºè¿™ä¸ªæ–¹æ³•äº†ï¼Œè¿™ä¼šé€ æˆCPUèµ„æºå’Œå†…å­˜çš„æµªè´¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè‹¹æœå»ºè®®ï¼šå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ç»˜åˆ¶çš„ä»»åŠ¡å°±ä¸è¦åœ¨å­ç±»ä¸­å†™ä¸€ä¸ªç©ºçš„-drawRect:æ–¹æ³•ã€‚</p>
<p>å½“è§†å›¾åœ¨å±å¹•ä¸Šå‡ºç°çš„æ—¶å€™ -drawRect:æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚-drawRect:æ–¹æ³•é‡Œé¢çš„ä»£ç åˆ©ç”¨Core Graphicså»ç»˜åˆ¶ä¸€ä¸ªå¯„å®¿å›¾ï¼Œç„¶åå†…å®¹å°±ä¼šè¢«ç¼“å­˜èµ·æ¥ç›´åˆ°å®ƒéœ€è¦è¢«æ›´æ–°ï¼ˆé€šå¸¸æ˜¯å› ä¸ºå¼€å‘è€…è°ƒç”¨äº†-setNeedsDisplayæ–¹æ³•ï¼Œå°½ç®¡å½±å“åˆ°è¡¨ç°æ•ˆæœçš„å±æ€§å€¼è¢«æ›´æ”¹æ—¶ï¼Œä¸€äº›è§†å›¾ç±»å‹ä¼šè¢«è‡ªåŠ¨é‡ç»˜ï¼Œå¦‚boundså±æ€§ï¼‰ã€‚è™½ç„¶-drawRect:æ–¹æ³•æ˜¯ä¸€ä¸ªUIViewæ–¹æ³•ï¼Œäº‹å®ä¸Šéƒ½æ˜¯åº•å±‚çš„CALayerå®‰æ’äº†é‡ç»˜å·¥ä½œå’Œä¿å­˜äº†å› æ­¤äº§ç”Ÿçš„å›¾ç‰‡ã€‚</p>
<p>CALayeræœ‰ä¸€ä¸ªå¯é€‰çš„delegateå±æ€§ï¼Œå®ç°äº†CALayerDelegateåè®®ï¼Œå½“CALayeréœ€è¦ä¸€ä¸ªå†…å®¹ç‰¹å®šçš„ä¿¡æ¯æ—¶ï¼Œå°±ä¼šä»åè®®ä¸­è¯·æ±‚ã€‚CALayerDelegateæ˜¯ä¸€ä¸ªéæ­£å¼åè®®ï¼Œå…¶å®å°±æ˜¯è¯´æ²¡æœ‰CALayerDelegate @protocolå¯ä»¥è®©ä½ åœ¨ç±»é‡Œé¢å¼•ç”¨å•¦ã€‚ä½ åªéœ€è¦è°ƒç”¨ä½ æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼ŒCALayerä¼šå¸®ä½ åšå‰©ä¸‹çš„ã€‚ï¼ˆdelegateå±æ€§è¢«å£°æ˜ä¸ºidç±»å‹ï¼Œæ‰€æœ‰çš„ä»£ç†æ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ï¼‰ã€‚</p>
<p>å½“éœ€è¦è¢«é‡ç»˜æ—¶ï¼ŒCALayerä¼šè¯·æ±‚å®ƒçš„ä»£ç†ç»™ä»–ä¸€ä¸ªå¯„å®¿å›¾æ¥æ˜¾ç¤ºã€‚å®ƒé€šè¿‡è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•åšåˆ°çš„:<br><code>(void)displayLayer:(CALayerCALayer *)layer;</code></p>
<p>è¶ç€è¿™ä¸ªæœºä¼šï¼Œå¦‚æœä»£ç†æƒ³ç›´æ¥è®¾ç½®contentså±æ€§çš„è¯ï¼Œå®ƒå°±å¯ä»¥è¿™ä¹ˆåšï¼Œä¸ç„¶æ²¡æœ‰åˆ«çš„æ–¹æ³•å¯ä»¥è°ƒç”¨äº†ã€‚å¦‚æœä»£ç†ä¸å®ç°-displayLayer:æ–¹æ³•ï¼ŒCALayerå°±ä¼šè½¬è€Œå°è¯•è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š<br><code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;</code></p>
<p> åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼ŒCALayeråˆ›å»ºäº†ä¸€ä¸ªåˆé€‚å°ºå¯¸çš„ç©ºå¯„å®¿å›¾ï¼ˆå°ºå¯¸ç”±boundså’ŒcontentsScaleå†³å®šï¼‰å’Œä¸€ä¸ªCore Graphicsçš„ç»˜åˆ¶ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¸ºç»˜åˆ¶å¯„å®¿å›¾åšå‡†å¤‡ï¼Œä»–ä½œä¸ºctxå‚æ•°ä¼ å…¥ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥ç»§ç»­ç¬¬ä¸€ç« çš„é¡¹ç›®è®©å®ƒå®ç°CALayerDelegateå¹¶åšä¸€äº›ç»˜å›¾å·¥ä½œå§ï¼ˆè§æ¸…å•2.5ï¼‰.å›¾2.12æ˜¯ä»–çš„ç»“æœ</p>
<p>#####æ¸…å•2.5å®ç°CALayerDelegate<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line">    - (void)viewDidLoad</div><div class="line">    &#123;</div><div class="line">        [super viewDidLoad];</div><div class="line">        ï¿¼</div><div class="line">        //create sublayer</div><div class="line">        CALayer *blueLayer = [CALayer layer];</div><div class="line">        blueLayer.frame = CGRectMake(50.0f, 50.0f, 100.0f, 100.0f);</div><div class="line">        blueLayer.backgroundColor = [UIColor blueColor].CGColor;</div><div class="line">        </div><div class="line">        //set controller as layer delegate</div><div class="line">        blueLayer.delegate = self;</div><div class="line">        </div><div class="line">        //ensure that layer backing image uses correct scale</div><div class="line">        blueLayer.contentsScale = [UIScreen mainScreen].scale; //add layer to our view</div><div class="line">        [self.layerView.layer addSublayer:blueLayer];</div><div class="line">        </div><div class="line">        //force layer to redraw</div><div class="line">        [blueLayer display];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    - (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</div><div class="line">    &#123;</div><div class="line">        //draw a thick red circle</div><div class="line">        CGContextSetLineWidth(ctx, 10.0f);</div><div class="line">        CGContextSetStrokeColorWithColor(ctx, [UIColor redColor].CGColor);</div><div class="line">        CGContextStrokeEllipseInRect(ctx, layer.bounds);</div><div class="line">    &#125;</div><div class="line">    @end</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-0d39dd147e3b14af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.12.png"></p>
<p> æ³¨æ„ä¸€ä¸‹ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼š</p>
<ul>
<li>æˆ‘ä»¬åœ¨blueLayerä¸Šæ˜¾å¼åœ°è°ƒç”¨äº†-displayã€‚ä¸åŒäºUIViewï¼Œå½“å›¾å±‚æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼ŒCALayerä¸ä¼šè‡ªåŠ¨é‡ç»˜å®ƒçš„å†…å®¹ã€‚å®ƒæŠŠé‡ç»˜çš„å†³å®šæƒäº¤ç»™äº†å¼€å‘è€…ã€‚</li>
<li>å°½ç®¡æˆ‘ä»¬æ²¡æœ‰ç”¨masksToBoundså±æ€§ï¼Œç»˜åˆ¶çš„é‚£ä¸ªåœ†ä»ç„¶æ²¿è¾¹ç•Œè¢«è£å‰ªäº†ã€‚è¿™æ˜¯å› ä¸ºå½“ä½ ä½¿ç”¨CALayerDelegateç»˜åˆ¶å¯„å®¿å›¾çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å¯¹è¶…å‡ºè¾¹ç•Œå¤–çš„å†…å®¹æä¾›ç»˜åˆ¶æ”¯æŒã€‚</li>
</ul>
<p>ç°åœ¨ä½ ç†è§£äº†CALayerDelegateï¼Œå¹¶çŸ¥é“æ€ä¹ˆä½¿ç”¨å®ƒã€‚ä½†æ˜¯é™¤éä½ åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„å›¾å±‚ï¼Œä½ å‡ ä¹æ²¡æœ‰æœºä¼šç”¨åˆ°CALayerDelegateåè®®ã€‚å› ä¸ºå½“UIViewåˆ›å»ºäº†å®ƒçš„å®¿ä¸»å›¾å±‚æ—¶ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨åœ°æŠŠå›¾å±‚çš„delegateè®¾ç½®ä¸ºå®ƒè‡ªå·±ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª-displayLayer:çš„å®ç°ï¼Œé‚£æ‰€æœ‰çš„é—®é¢˜å°±éƒ½æ²¡äº†ã€‚</p>
<p>å½“ä½¿ç”¨å¯„å®¿äº†è§†å›¾çš„å›¾å±‚çš„æ—¶å€™ï¼Œä½ ä¹Ÿä¸å¿…å®ç°-displayLayer:å’Œ-drawLayer:inContext:æ–¹æ³•æ¥ç»˜åˆ¶ä½ çš„å¯„å®¿å›¾ã€‚é€šå¸¸åšæ³•æ˜¯å®ç°UIViewçš„-drawRect:æ–¹æ³•ï¼ŒUIViewå°±ä¼šå¸®ä½ åšå®Œå‰©ä¸‹çš„å·¥ä½œï¼ŒåŒ…æ‹¬åœ¨éœ€è¦é‡ç»˜çš„æ—¶å€™è°ƒç”¨-displayæ–¹æ³•ã€‚</p>
<p>####æ€»ç»“<br> æœ¬ç« ä»‹ç»äº†å¯„å®¿å›¾å’Œä¸€äº›ç›¸å…³çš„å±æ€§ã€‚ä½ å­¦åˆ°äº†å¦‚ä½•æ˜¾ç¤ºå’Œæ”¾ç½®å›¾ç‰‡ï¼Œ ä½¿ç”¨æ‹¼åˆæŠ€æœ¯æ¥æ˜¾ç¤ºï¼Œ ä»¥åŠç”¨CALayerDelegateå’ŒCore Graphicsæ¥ç»˜åˆ¶å›¾å±‚å†…å®¹ã€‚</p>
<p>åœ¨ç¬¬ä¸‰ç« ï¼Œâ€å›¾å±‚å‡ ä½•å­¦â€ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ¢è®¨ä¸€ä¸‹å›¾å±‚çš„å‡ ä½•ï¼Œè§‚å¯Ÿä»–ä»¬æ˜¯å¦‚ä½•æ”¾ç½®å’Œæ”¹å˜ç›¸äº’çš„å°ºå¯¸çš„ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="liuxinixn.github.io/2016/05/01/CAShapeLayerä¸UIBezierPathå®ç°æ³¨æ°´åŠ¨ç”»ä¸æ­£ä½™å¼¦æ°´æ³¢çº¹åŠ¨ç”»,é›·è¾¾æ‰©æ•£æ•ˆæœï¼Œæ·»åŠ è´­ç‰©è½¦åŠ¨ç”»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›ªæ™Ÿ">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é›ªæ™Ÿ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/01/CAShapeLayerä¸UIBezierPathå®ç°æ³¨æ°´åŠ¨ç”»ä¸æ­£ä½™å¼¦æ°´æ³¢çº¹åŠ¨ç”»,é›·è¾¾æ‰©æ•£æ•ˆæœï¼Œæ·»åŠ è´­ç‰©è½¦åŠ¨ç”»/" itemprop="url">CAShapeLayerä¸UIBezierPathå®ç°æ³¨æ°´åŠ¨ç”»ä¸æ­£ä½™å¼¦æ°´æ³¢çº¹åŠ¨ç”»ï¼Œé›·è¾¾æ‰©æ•£ï¼Œæ·»åŠ è´­ç‰©è½¦åŠ¨ç”»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-01T20:19:35+08:00">
                2016-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åˆæ­¥å­¦ä¹ äº†CoreAnimationæ¡†æ¶ï¼Œæ€»ç»“äº†å‡ ä¸ªåŠ¨ç”»æ•ˆæœï¼Œä¸»è¦æ˜¯é€šè¿‡CAShapeLayerä¸è´å¡å°”æ›²çº¿å®ç°ã€‚<br>æ¨èä¸€ä¸ªå¤§ç¥çš„åšå®¢ï¼š<a href="http://kittenyang.com/" target="_blank" rel="noopener">Kitten çš„æ—¶é—´èƒ¶å›Š</a>,çˆ±å¥½åŠ¨ç”»çš„å¯ä»¥çœ‹çœ‹ã€‚æ„Ÿè§‰æ•°å­¦å¥½æ¸£æ¸£ï¼Œæ˜¯æ—¶å€™æ¶è¡¥ä¸€ä¸‹äº†<br>å…ˆçœ‹ä¸‹æ•ˆæœ</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-729daa88f1ae1a23.gif?imageMogr2/auto-orient/strip" alt="gif.gif"></p>
<blockquote>
<p>#####<strong>æ‰‡å½¢ä¸‹è½½è¿›åº¦</strong></p>
</blockquote>
<p>è¦å®ç°æ‰‡å½¢çš„ä¸‹è½½è¿›åº¦ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œ è¿™é‡Œå…ˆä½¿ç”¨ç¬¬ä¸€ç§ï¼š<br>1.ä½¿ç”¨è®¾ç½®UIBezierPathçš„è§’åº¦<br>2.ä½¿ç”¨ CAShapeLayerçš„stokeEndå±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//è®¾ç½®ä¸­å¿ƒç‚¹</div><div class="line">  CGPoint point = CGPointMake(self.frame.size.width/2, self.frame.size.height/2);</div><div class="line">  </div><div class="line">  //èµ·ç‚¹ä½ç½®</div><div class="line">  CGFloat startAngle = - M_PI /2;</div><div class="line">  </div><div class="line">  //ç»“æŸä½ç½®</div><div class="line">  CGFloat endAngle = self.progress *M_PI *2 + startAngle;</div><div class="line">  </div><div class="line">  </div><div class="line">  UIBezierPath *path =[UIBezierPath bezierPathWithArcCenter:point radius:self.bounds.size.width/2 startAngle:startAngle endAngle:endAngle clockwise:1];</div><div class="line">  </div><div class="line">   //ç”»ä¸€æ ¹åˆ° åœ†å¿ƒçš„çº¿</div><div class="line">  [path addLineToPoint:point];</div><div class="line">  </div><div class="line">  </div><div class="line">  //é€šè¿‡layerç»˜åˆ¶</div><div class="line">  CAShapeLayer *layer =[CAShapeLayer layer];</div><div class="line">  </div><div class="line">  </div><div class="line">  layer.path = path.CGPath;</div><div class="line">  </div><div class="line">  layer.fillColor =[UIColor colorWithRed:0.47 green:0.83 blue:0.98 alpha:1].CGColor;</div><div class="line">  </div><div class="line">  [self.layer addSublayer:layer];</div></pre></td></tr></table></figure></p>
<blockquote>
<h5 id="åœ†å½¢è¿›åº¦"><a href="#åœ†å½¢è¿›åº¦" class="headerlink" title="åœ†å½¢è¿›åº¦"></a><strong>åœ†å½¢è¿›åº¦</strong></h5></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">é¦–å…ˆ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒŒæ™¯å±‚ ä¸€ä¸ªå‰æ™¯å±‚ï¼Œä¸€ä¸ªè·¯å¾„ä¾›ç»™ä¸¤ä¸ªlayerä½¿ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ”¹å˜stokeEnd æ¥æ”¹å˜åœ†å¼§çš„è¿›åº¦ï¼Œä»£ç é‡Œå¢åŠ äº†ä¸€ç‚¹æ¸å˜</div><div class="line">   self.backLayer =[CAShapeLayer layer];</div><div class="line">    self.backLayer.fillColor  =[UIColor clearColor].CGColor;</div><div class="line">    self.backLayer.frame = self.bounds;</div><div class="line">    self.backLayer.lineWidth = 4;</div><div class="line">    self.backLayer.strokeColor =[UIColor lightGrayColor].CGColor;</div><div class="line">    [self.layer addSublayer:self.backLayer];</div><div class="line">    </div><div class="line">    self.foreLayer =[CAShapeLayer layer];</div><div class="line">    self.foreLayer.fillColor  =[UIColor clearColor].CGColor;</div><div class="line">    self.foreLayer.frame = self.bounds;</div><div class="line">    self.foreLayer.strokeColor =[UIColor redColor].CGColor;</div><div class="line">    self.foreLayer.lineWidth = 4;</div><div class="line">    [self.layer addSublayer:self.foreLayer];</div><div class="line">    </div><div class="line">    </div><div class="line">    UIBezierPath *path=  [UIBezierPath bezierPathWithArcCenter:CGPointMake(self.bounds.size.width/2, self.bounds.size.height/2) radius:self.bounds.size.width/2-2 startAngle:-M_PI_2 endAngle:M_PI *1.5 clockwise:YES];</div><div class="line">    self.backPath = path;</div><div class="line">    </div><div class="line">    self.backLayer.path = self.backPath.CGPath;</div><div class="line">    self.foreLayer.path = self.backPath.CGPath;</div><div class="line">    self.foreLayer.strokeEnd = 0;</div><div class="line">    </div><div class="line">    </div><div class="line">    self.gradientLayerLeft =[CAGradientLayer layer];</div><div class="line">    self.gradientLayerLeft.frame = self.bounds;</div><div class="line">    </div><div class="line">    self.gradientLayerLeft.colors =@[(__bridge id)[UIColor redColor].CGColor,(__bridge id)[UIColor yellowColor].CGColor,(__bridge id)[UIColor blueColor].CGColor];</div><div class="line">    self.gradientLayerLeft.locations = @[@0,@0.5,@1];</div><div class="line">    self.gradientLayerLeft.startPoint = CGPointMake(0, 0);</div><div class="line">    self.gradientLayerLeft.endPoint = CGPointMake(0, 1);</div><div class="line">    [self.layer addSublayer:self.gradientLayerLeft];</div><div class="line">  </div><div class="line">    </div><div class="line">    //è®¾ç½®mask</div><div class="line">    [self.gradientLayerLeft setMask:self.foreLayer];</div><div class="line">-(void)setProgressValue:(CGFloat)progressValue</div><div class="line">&#123;</div><div class="line">    _progressValue = progressValue;</div><div class="line">    self.foreLayer.strokeEnd = progressValue;</div><div class="line">    self.label.text = [NSString stringWithFormat:@&quot;%.f%%&quot;,progressValue *100];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p> #####<strong>ä¸€ä¸ªåŠ è½½åŠ¨ç”»</strong></p>
</blockquote>
<p>å¼•è‡ªï¼š<a href="http://www.jianshu.com/p/447b0de110a7" target="_blank" rel="noopener">æ—‹è½¬åŠ è½½åŠ¨ç”»</a><br>å¯ä»¥é‡ç‚¹å­¦ä¹ ä¸‹åšåŠ¨ç”»çš„æ€è·¯ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//æ ¸å¿ƒä»£ç  åœ¨åŠ¨ç”»å¼€å§‹çš„æ—¶å€™åšä¸€äº›å¹³ç§»æ—‹è½¬</div><div class="line">- (void)animationDidStart:(CAAnimation *)anim&#123;</div><div class="line">    [UIView animateWithDuration:0.3 delay:0.1 options:UIViewAnimationOptionCurveEaseOut|UIViewAnimationOptionBeginFromCurrentState animations:^&#123;</div><div class="line">        </div><div class="line">        self.ball_1.transform = CGAffineTransformMakeTranslation(-BALL_RADIUS, 0);</div><div class="line">        self.ball_1.transform = CGAffineTransformScale(self.ball_1.transform, 0.7, 0.7);</div><div class="line">        </div><div class="line">        self.ball_3.transform = CGAffineTransformMakeTranslation(BALL_RADIUS, 0);</div><div class="line">        self.ball_3.transform = CGAffineTransformScale(self.ball_3.transform, 0.7, 0.7);</div><div class="line">        </div><div class="line">        </div><div class="line">        self.ball_2.transform = CGAffineTransformScale(self.ball_2.transform, 0.7, 0.7);</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        [UIView animateWithDuration:0.3 delay:0.1 options:UIViewAnimationOptionCurveEaseIn  | UIViewAnimationOptionBeginFromCurrentState animations:^&#123;</div><div class="line">            self.ball_1.transform = CGAffineTransformIdentity;</div><div class="line">            self.ball_3.transform = CGAffineTransformIdentity;</div><div class="line">            self.ball_2.transform = CGAffineTransformIdentity;</div><div class="line">        &#125; completion:NULL];</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>#####<strong>ä½¿ç”¨æ­£ä½™å¼¦åšçš„æ³¨æ°´åŠ¨ç”»</strong></p>
</blockquote>
<p>åœ¨ä½¿ç”¨æ­£ä½™å¼¦åšæ³¨æ°´åŠ¨ç”»æ—¶ï¼Œå…ˆäº†è§£ä¸‹æ­£ä½™å¼¦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> æ­£å¼¦æ›²çº¿å…¬å¼å¯è¡¨ç¤ºä¸ºy=Asin(Ï‰x+Ï†)+kï¼š</div><div class="line"> Aï¼ŒæŒ¯å¹…ï¼Œæœ€é«˜å’Œæœ€ä½çš„è·ç¦»</div><div class="line"> Wï¼Œè§’é€Ÿåº¦ï¼Œç”¨äºæ§åˆ¶å‘¨æœŸå¤§å°ï¼Œå•ä½xä¸­çš„èµ·ä¼ä¸ªæ•°</div><div class="line"> Kï¼Œåè·ï¼Œæ›²çº¿æ•´ä½“ä¸Šä¸‹åç§»é‡</div><div class="line"> Ï†ï¼Œåˆç›¸ï¼Œå·¦å³ç§»åŠ¨çš„å€¼</div><div class="line"> </div><div class="line"> è¿™ä¸ªæ•ˆæœä¸»è¦çš„æ€è·¯æ˜¯æ·»åŠ ä¸¤æ¡æ›²çº¿ ä¸€æ¡æ­£ç„æ›²çº¿ã€ä¸€æ¡ä½™å¼¦æ›²çº¿ ç„¶ååœ¨æ›²çº¿ä¸‹æ·»åŠ æ·±æµ…ä¸åŒçš„èƒŒæ™¯é¢œè‰²ï¼Œä»è€Œè¾¾åˆ°æ³¢æµªæ˜¾ç¤ºçš„æ•ˆæœ</div><div class="line"> */</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬è¦åšçš„ å°±æ˜¯ä½¿ç”¨ä¸¤æ¡æ­£ä½™å¼¦ï¼Œä½†æ˜¯è¿™ä¸¤æ¡æ­£ä½™å¼¦ï¼Œ æ³¢å³°éœ€è¦å¯¹åº”æ³¢è°·ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨forå¾ªç¯åˆ†åˆ«æ‹¼æ¥æ­£ä½™å¼¦çš„è·¯å¾„</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">-(void)updateWave</div><div class="line">&#123;</div><div class="line">    //æ³¢æµªå®½åº¦</div><div class="line">    CGFloat waterWaveWidth = self.bounds.size.width;</div><div class="line">    //åˆå§‹åŒ–è¿åŠ¨è·¯å¾„</div><div class="line">    CGMutablePathRef path = CGPathCreateMutable();</div><div class="line">    </div><div class="line">    CGMutablePathRef maskPath = CGPathCreateMutable();</div><div class="line">    //è®¾ç½®èµ·å§‹ä½ç½®</div><div class="line">    CGPathMoveToPoint(path, nil, 0, _waveY);</div><div class="line">    </div><div class="line">    //è®¾ç½®èµ·å§‹ä½ç½®</div><div class="line">    CGPathMoveToPoint(maskPath, nil, 0, _waveY);</div><div class="line">    //åˆå§‹åŒ–æ³¢æµªå…¶å®Yä¸ºåè·</div><div class="line">    CGFloat y = _waveY;</div><div class="line">  </div><div class="line">    //æ­£å¼¦æ›²çº¿å…¬å¼ä¸ºï¼š y=Asin(Ï‰x+Ï†)+k;</div><div class="line">    for (float x = 0.0f; x &lt;= waterWaveWidth ; x++) &#123;</div><div class="line">        y = _waveAmplitude * sin(_wavePalstance * x + _waveX) + _waveY;</div><div class="line">       </div><div class="line">        CGPathAddLineToPoint(path, nil, x, y);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    for (float x = 0.0f; x &lt;= waterWaveWidth ; x++) &#123;</div><div class="line">        y = _waveAmplitude * cos(_wavePalstance * x + _waveX) + _waveY;</div><div class="line">       </div><div class="line">        CGPathAddLineToPoint(maskPath, nil, x, y);</div><div class="line">    &#125;</div><div class="line">    [self updateLayer:_waveLayer1 path:path];</div><div class="line">    [self updateLayer:_waveLayer2 path:maskPath];</div><div class="line"></div><div class="line">&#125;</div><div class="line">-(void)updateLayer:(CAShapeLayer *)layer path:(CGMutablePathRef )path</div><div class="line">&#123;</div><div class="line">    //å¡«å……åº•éƒ¨é¢œè‰²</div><div class="line">    CGFloat waterWaveWidth = self.bounds.size.width;</div><div class="line">    CGPathAddLineToPoint(path, nil, waterWaveWidth, self.bounds.size.height);</div><div class="line">    CGPathAddLineToPoint(path, nil, 0, self.bounds.size.height);</div><div class="line">    CGPathCloseSubpath(path);</div><div class="line">    layer.path = path;</div><div class="line">     CGPathRelease(path);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨å•ä¸ªforå¾ªç¯åªæ˜¯ è®¾ç½® å¦ä¸€æ¡æ›²çº¿çš„yå€¼ç›¸åå³å¯å®ç°ä¸¤æ¡æ­£ä½™å¼¦çš„æ•ˆæœ ï¼Œæœ€åä¸€ä¸ªåŠ¨ç”»ä¸­ä¼šæœ‰è¯´æ˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">for (int x = 0; x&lt;WIDTH; x++) &#123;</div><div class="line">       y = waveHeight*sinf(0.01*waveCurvature*x+offSetValue*0.045);</div><div class="line">       CGPathAddLineToPoint(path, nil, x, y);</div><div class="line">       //é®ç½©å±‚çš„è·¯å¾„ä¸ä¹‹ç›¸å</div><div class="line">       masky = -y;</div><div class="line">       CGPathAddLineToPoint(maskPath, nil, x, masky);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p><strong>ä½†æ˜¯</strong>æˆ‘ä»¬æœ‰ä¸ªéœ€æ±‚å°±æ˜¯æ”¹å˜ æ³¢æµªçš„é«˜åº¦ï¼Œ å®ç°æ³¨æ°´çš„ç™¾åˆ†æ¯”ï¼Œå°±éœ€è¦è®¾ç½®æ³¢æµªçš„åè·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-(void)updateWaveY</div><div class="line">&#123;</div><div class="line">    CGFloat targetY = self.bounds.size.height - _progress * self.bounds.size.height;</div><div class="line">    if (_waveY &lt; targetY) &#123;</div><div class="line">        _waveY += 2;</div><div class="line">    &#125;</div><div class="line">    if (_waveY &gt; targetY ) &#123;</div><div class="line">        _waveY -= 2;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>#####<strong>æ­£ä½™å¼¦åŠ¨ç”»2</strong> </p>
</blockquote>
<p>å¦‚æœæœ‰ä¸ªéœ€æ±‚ ï¼Œæ¯”å¦‚ä¸€ä¸ªå°èˆ¹ éšç€æ³¢æµªçš„æ³¢åŠ¨è€Œèµ·ä¼<br>é‚£æˆ‘ä»¬å°±éœ€è¦è®¡ç®— æ³¢æµªçš„ä½ç½®ï¼Œç„¶åè®¾ç½®å°èˆ¹çš„frame<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//è¿™é‡Œä½¿ç”¨åˆ›å»ºæ­£ä½™å¼¦çš„ç¬¬äºŒç§æ–¹æ³•</div><div class="line">    for (int x = 0; x&lt;WIDTH; x++) &#123;</div><div class="line">        y = waveHeight*sinf(0.01*waveCurvature*x+offSetValue*0.045);</div><div class="line">        CGPathAddLineToPoint(path, nil, x, y);</div><div class="line">        //é®ç½©å±‚çš„è·¯å¾„ä¸ä¹‹ç›¸å</div><div class="line">        masky = -y;</div><div class="line">        CGPathAddLineToPoint(maskPath, nil, x, masky);</div><div class="line">    &#125;</div><div class="line">è®¡ç®—å‡ºå®æµªæ³¢åŠ¨æ—¶ï¼Œæœ€ä¸­é—´çš„ä½ç½®ï¼Œè®¾ç½®å°èˆ¹çš„frame</div><div class="line">  CGFloat CentY = waveHeight*sinf(0.01*waveCurvature*WIDTH/2+offSetValue*0.045);</div><div class="line">    CGRect boardViewFrame = [boardView frame];</div><div class="line">    boardViewFrame.origin.y = 100-waveHeight+CentY;</div><div class="line">    boardView.frame = boardViewFrame;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>é›·è¾¾åŠ¨ç”»</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-4dfc88e76fa8a370.gif?imageMogr2/auto-orient/strip" alt="gif.gif"></p>
<p>ç»™UIViewæ·»åŠ ä¸€ä¸ªåˆ†ç±»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface UIView (RadarAnimation)</div><div class="line"></div><div class="line">@property(nonatomic,strong)UIColor *radarColor; //æ‰©æ•£é¢œè‰²</div><div class="line">@property(nonatomic,assign)UIColor *radarBorderColor; //æ‰©æ•£è¾¹ç•Œé¢œè‰²</div><div class="line">-(void)addRadarAnimation;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è°ƒç”¨æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">button.radarColor = LBColor(237, 174, 130, 1);</div><div class="line">button.radarBorderColor = LBColor(237, 174, 130, 0.5);</div><div class="line"> [button addRadarAnimation];</div></pre></td></tr></table></figure></p>
<p>åŠ¨ç”»:æ·»åŠ åŠ¨ç”»çš„æ–¹æ³•,åˆ›å»ºä¸‰ä¸ªlayerï¼Œåªä¸è¿‡ï¼Œå¼€å§‹åŠ¨ç”»çš„æ—¶é—´è¦é”™å¼€å½¢æˆè¿™ä¸ªæ•ˆæœï¼šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">-(void)Animation&#123;</div><div class="line">    NSInteger pulsingCount = 3;</div><div class="line">    double animationDuration = 2;</div><div class="line"></div><div class="line">    CALayer * animationLayer = [[CALayer alloc]init];</div><div class="line"></div><div class="line">    for (int i = 0; i &lt; pulsingCount; i++) &#123;</div><div class="line">        CALayer * pulsingLayer = [[CALayer alloc]init];</div><div class="line">        pulsingLayer.frame = CGRectMake(0, 0, self.frame.size.width, self.frame.size.height);</div><div class="line">        pulsingLayer.backgroundColor = self.radarColor.CGColor;</div><div class="line">        pulsingLayer.borderColor = self.radarBorderColor.CGColor;</div><div class="line"></div><div class="line"></div><div class="line">        pulsingLayer.borderWidth = 1.0;</div><div class="line">        pulsingLayer.cornerRadius = self.frame.size.height/2;</div><div class="line"></div><div class="line">        CAMediaTimingFunction * defaultCurve = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];</div><div class="line"></div><div class="line">        CAAnimationGroup * animationGroup = [[CAAnimationGroup alloc]init];</div><div class="line">        animationGroup.fillMode = kCAFillModeBoth;</div><div class="line">        animationGroup.beginTime = CACurrentMediaTime() + (double)i * animationDuration/(double)pulsingCount;</div><div class="line">        animationGroup.duration = animationDuration;</div><div class="line">        animationGroup.repeatCount = HUGE_VAL;</div><div class="line">        animationGroup.timingFunction = defaultCurve;</div><div class="line"></div><div class="line">        CABasicAnimation * scaleAnimation = [CABasicAnimation animationWithKeyPath:@&quot;transform.scale&quot;];</div><div class="line">        scaleAnimation.autoreverses = NO;</div><div class="line">        scaleAnimation.fromValue = [NSNumber numberWithDouble:1];</div><div class="line">        scaleAnimation.toValue = [NSNumber numberWithDouble:1.5];</div><div class="line"></div><div class="line">        CAKeyframeAnimation * opacityAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;opacity&quot;];</div><div class="line">        opacityAnimation.values = @[[NSNumber numberWithDouble:1.0],[NSNumber numberWithDouble:0.5],[NSNumber numberWithDouble:0.3],[NSNumber numberWithDouble:0.0]];</div><div class="line">        opacityAnimation.keyTimes = @[[NSNumber numberWithDouble:0.0],[NSNumber numberWithDouble:0.25],[NSNumber numberWithDouble:0.5],[NSNumber numberWithDouble:1.0]];</div><div class="line">        animationGroup.animations = @[scaleAnimation,opacityAnimation];</div><div class="line"></div><div class="line">        [pulsingLayer addAnimation:animationGroup forKey:@&quot;pulsing&quot;];</div><div class="line">        [animationLayer addSublayer:pulsingLayer];</div><div class="line">    &#125;</div><div class="line">        animationLayer.zPosition = -1;//é‡æ–°åŠ è½½æ—¶ï¼Œä½¿åŠ¨ç”»è‡³åº•å±‚</div><div class="line">    [self.layer addSublayer:animationLayer];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>çˆ±å¥‡è‰ºæ—‹è½¬åŠ¨ç”»ï¼Œè¯´ç™½äº†è¿˜æ˜¯ç›‘å¬stokeStart stokeEndåšåŠ¨ç”»æ•ˆæœã€‚</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1694376-2394fa45a2af03ef.gif?imageMogr2/auto-orient/strip" alt="  çˆ±å¥‡è‰ºåŠ¨ç”».gif"></p>
<p>ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">-(void)setUp&#123;</div><div class="line">    </div><div class="line">    CGPoint point =  CGPointMake(self.width/2, self.height/2);</div><div class="line">    UIBezierPath *path =[UIBezierPath bezierPathWithArcCenter:point radius:(self.width - 1)/2 startAngle:-0.5 *M_PI endAngle:1.5 *M_PI clockwise:YES];</div><div class="line"></div><div class="line">    self.shapeLayer =[[CAShapeLayer alloc]init];</div><div class="line">    self.shapeLayer.frame = self. bounds;</div><div class="line">    </div><div class="line">    self.shapeLayer.strokeColor = [UIColor hexStringToColor:@&quot;#94BF3F&quot;].CGColor;</div><div class="line">    self.shapeLayer.fillColor =[UIColor clearColor].CGColor;</div><div class="line">    self.shapeLayer.lineWidth = 1;</div><div class="line">    self.shapeLayer.lineCap = kCALineCapRound;</div><div class="line">    </div><div class="line"> </div><div class="line">    self.shapeLayer.path = path.CGPath;</div><div class="line">    </div><div class="line">    [self.layer addSublayer:self.shapeLayer];</div><div class="line">    </div><div class="line">    </div><div class="line">  </div><div class="line">    self.imageView =[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, 9, 9)];</div><div class="line">    self.imageView.center = point;</div><div class="line">    self.imageView.image =[UIImage imageNamed:@&quot;ä¸‰è§’å½¢&quot;];</div><div class="line">    </div><div class="line">    [self addSubview:self.imageView];</div><div class="line">    [self animationOne];</div><div class="line"></div><div class="line">&#125;</div><div class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</div><div class="line">    if ([[anim valueForKey:@&quot;animationName&quot;] isEqualToString:@&quot;AnimationEnd&quot;]) &#123;</div><div class="line">        </div><div class="line">        [self animationTwo];</div><div class="line">        [self rotationAnimation];</div><div class="line">    &#125;</div><div class="line">    if ([[anim valueForKey:@&quot;animationName&quot;] isEqualToString:@&quot;AnimationStart&quot;]) &#123;</div><div class="line">        </div><div class="line">   </div><div class="line">        [self.shapeLayer removeAllAnimations];</div><div class="line">        [self animationOne];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line">-(void)animationOne&#123;</div><div class="line">    </div><div class="line">    self.shapeLayer.strokeStart=0;</div><div class="line">    //è®¾ç½®strokeEndçš„æœ€ç»ˆå€¼ï¼ŒåŠ¨ç”»çš„fromValueä¸º0ï¼ŒstrokeEndçš„æœ€ç»ˆå€¼ä¸º0.98</div><div class="line">    self.shapeLayer.strokeEnd=0.98;</div><div class="line">    CABasicAnimation *basicAnimationOne=[CABasicAnimation animationWithKeyPath:@&quot;strokeEnd&quot;];</div><div class="line">    basicAnimationOne.fromValue=@(0);</div><div class="line">    </div><div class="line">    basicAnimationOne.duration= KAnimationDuration;</div><div class="line">    </div><div class="line">    basicAnimationOne.delegate=self;</div><div class="line">    [basicAnimationOne setValue:@&quot;AnimationEnd&quot; forKey:@&quot;animationName&quot;];</div><div class="line">    </div><div class="line">    [self.shapeLayer addAnimation:basicAnimationOne forKey:@&quot;animationName&quot;];</div><div class="line">&#125;</div><div class="line">-(void)animationTwo&#123;</div><div class="line">    </div><div class="line">    self.shapeLayer.strokeStart = 0.98;</div><div class="line">    CABasicAnimation *basicAnimationTwo=[CABasicAnimation animationWithKeyPath:@&quot;strokeStart&quot;];</div><div class="line">    basicAnimationTwo.fromValue=@(0);</div><div class="line">    </div><div class="line">    basicAnimationTwo.duration= KAnimationDuration;</div><div class="line">    </div><div class="line">    basicAnimationTwo.delegate=self;</div><div class="line">    [basicAnimationTwo setValue:@&quot;AnimationStart&quot; forKey:@&quot;animationName&quot;];</div><div class="line">    </div><div class="line"></div><div class="line">    [self.shapeLayer addAnimation:basicAnimationTwo forKey:@&quot;animationName&quot;];</div><div class="line">    </div><div class="line">&#125;</div><div class="line">-(void)rotationAnimation&#123;</div><div class="line">    CABasicAnimation *rotationAnimation=[CABasicAnimation animationWithKeyPath:@&quot;transform.rotation.z&quot;];</div><div class="line">    </div><div class="line">    rotationAnimation.toValue=@(M_PI*2);</div><div class="line">    rotationAnimation.duration= KAnimationDuration;</div><div class="line">    </div><div class="line">    rotationAnimation.delegate=self;</div><div class="line">    [rotationAnimation setValue:@&quot;AnimationRotation&quot; forKey:@&quot;animationName&quot;];</div><div class="line">    [self.imageView.layer addAnimation:rotationAnimation forKey:@&quot;AnimationRotation&quot;];</div><div class="line">    </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åˆå­¦åŠ¨ç”»ï¼Œå‚è€ƒå¾ˆå¤šæ–‡ç« ï¼Œåšä¸ªå°å°æ€»ç»“ã€‚<br>demoåœ°å€ <a href="https://github.com/liuxinixn/ProgressViewDemo" target="_blank" rel="noopener">demoé›†åˆ</a></p>
<p>å¦å¤–ä¸€ä¸ªåŠ å…¥è´­ç‰©è½¦çš„å°åŠ¨ç”»ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/1694376-37a8d72c7ff0562c.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.gif"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">-(void)startAnimation</div><div class="line">&#123;</div><div class="line">    //èµ·ç‚¹</div><div class="line">    </div><div class="line">    //æ§ç‚¹</div><div class="line">    CGPoint controlPoint = CGPointMake(_endPoint.x, _startPoint.y);</div><div class="line">    </div><div class="line">    UIBezierPath *path = [UIBezierPath bezierPath];</div><div class="line">    [path moveToPoint:_startPoint];</div><div class="line">    [path addQuadCurveToPoint:_endPoint controlPoint:controlPoint];</div><div class="line">    </div><div class="line">    CAShapeLayer *layer =[CAShapeLayer layer];</div><div class="line">    layer.path = path.CGPath;</div><div class="line">    layer.fillColor = [UIColor clearColor].CGColor;</div><div class="line">    layer.strokeColor = [UIColor redColor].CGColor;</div><div class="line">    layer.lineWidth = 3.0f;</div><div class="line">    layer.shouldRasterize = YES;//æŠ—é”¯é½¿</div><div class="line">    [_viewController.view.layer addSublayer:layer];</div><div class="line">    </div><div class="line">    //åˆ›å»ºå…³é”®å¸§</div><div class="line">    CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</div><div class="line">    </div><div class="line">    //åŠ¨ç”»æ—¶é—´</div><div class="line">    animation.duration = 1;</div><div class="line">    animation.path = path.CGPath</div><div class="line">    ;</div><div class="line">    //å½“åŠ¨ç”»å®Œæˆï¼Œåœç•™åˆ°ç»“æŸä½ç½®</div><div class="line">    animation.removedOnCompletion = YES;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">    [_shopView.layer addAnimation:animation forKey:nil];</div><div class="line">    path = nil;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://www.jianshu.com/p/a9a4c51aef13" target="_blank" rel="noopener">è´å¡å°”æ›²çº¿ï¼ˆåŠ å…¥è´­ç‰©è½¦åŠ¨ç”»ï¼‰</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="http://upload.jianshu.io/users/upload_avatars/1694376/4b7e25bd43ee.jpg"
              alt="é›ªæ™Ÿ" />
          
            <p class="site-author-name" itemprop="name">é›ªæ™Ÿ</p>
            <p class="site-description motion-element" itemprop="description">å¤šå»å°è¯•ä½ ä»æœªå°è¯•çš„ã€‚</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/liuxinixn" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/3d7c50f31b88" target="_blank" title="Jianshu">
                  
                    <i class="fa fa-fw fa-flag"></i>Jianshu</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">é›ªæ™Ÿ</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

  <div class="powered-by">ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/three/three.min.js"></script>

  
  <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
